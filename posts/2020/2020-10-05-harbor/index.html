<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Harbor is an open source trusted cloud native registry project that stores, signs, and scans content. Harbor extends the open source Docker Distribution by adding the functionalities usually required by users such as security, identity and management. Having a registry closer to the build and run environment can improve the image transfer efficiency. Harbor supports replication of images between registries, and also offers advanced security features such as user management, access control and activity auditing.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Harbor" />
<meta property="og:description" content="Harbor is an open source trusted cloud native registry project that stores, signs, and scans content. Harbor extends the open source Docker Distribution by adding the functionalities usually required by users such as security, identity and management. Having a registry closer to the build and run environment can improve the image transfer efficiency. Harbor supports replication of images between registries, and also offers advanced security features such as user management, access control and activity auditing." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2020/2020-10-05-harbor/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-24T19:59:50+02:00" />

<title>Harbor | Blog Marcel Widmer </title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css" >
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.6d9040acb89aff39f832a0b8623fad42fa664a32ef333ca95112d6156a809515.js" ></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/avatar.png" alt="Logo" /><span>Blog Marcel Widmer </span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



  



  
    
  



<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </label>

    <ul>
      
      <li>
        <a href="/de/">
          Deutsch
        </a>
      </li>
      
    </ul>
  </li>
</ul>











  












  
<ul>
  
  <li>
    <a href="/posts/" >
        Blog
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Harbor</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#install-cert-manager">Install cert-manager</a></li>
        <li><a href="#install-harbor">Install Harbor</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/2020/2020-10-05-harbor/">Harbor</a>
  </h1>
  
  <h5>October 25, 2020</h5>



  
  <div>
    
      <a href="/categories/Kubernetes/">Kubernetes</a>
  </div>
  

  
  <div>
    
      <a href="/tags/k8s/">k8s</a>, 
      <a href="/tags/harbor/">harbor</a>
  </div>
  



<p>Harbor is an open source trusted cloud native registry project that stores, signs, and scans content. Harbor extends the open source Docker Distribution by adding the functionalities usually required by users such as security, identity and management. Having a registry closer to the build and run environment can improve the image transfer efficiency. Harbor supports replication of images between registries, and also offers advanced security features such as user management, access control and activity auditing.</p>
<p>Harbor is hosted by the Cloud Native Computing Foundation (CNCF). If you are an organization that wants to help shape the evolution of cloud native technologies, consider joining the CNCF. For details about who&rsquo;s involved and how Harbor plays a role, read the CNCF announcement.</p>
<p>
  <a href="https://github.com/goharbor/harbor">Harbor GitHub</a>

  <a href="https://medium.com/@Devopscontinens/alongside-harbor-berth-with-minikube-b31e487974f4">Melvin medium.com</a></p>
<pre tabindex="0"><code>helm repo add harbor https://helm.goharbor.io
git clone https://github.com/goharbor/harbor-helm.git
helm install harbor harbor/harbor -n harbor



k get ingress
Warning: extensions/v1beta1 Ingress is deprecated in v1.14+, unavailable in v1.22+; use networking.k8s.io/v1 Ingress
NAME                           CLASS    HOSTS                  ADDRESS        PORTS     AGE
harbor-harbor-ingress          &lt;none&gt;   core.harbor.domain     192.168.64.6   80, 443   5m34s
harbor-harbor-ingress-notary   &lt;none&gt;   notary.harbor.domain   192.168.64.6   80, 443   5m34s
nginx-ingress                  &lt;none&gt;   test.minikube.me       192.168.64.6   80        5m34s


sudo vi /etc/hosts

192.168.64.6 core.harbor.domain

http://core.harbor.domain

username: admin 
password: Harbor12345
</code></pre><p>First thing we need to create a new project inside Harbor.
This will be where we will be storing all the project related Docker images.

  <img src="/static/harbor/img.png" alt="img.png" /></p>
<p>Then we move over to create a new user within Harbor.

  <img src="/static/harbor/img_1.png" alt="img_1.png" /></p>
<p>Lastly we need to add the newly created user into our project member.

  <img src="/static/harbor/img_2.png" alt="img_2.png" />

  <img src="/static/harbor/img_3.png" alt="img_3.png" /></p>
<p>On a terminal, we will log in Harbor repository</p>
<pre tabindex="0"><code>docker login -udevops core.harbor.domain
Password:
Error response from daemon: Get https://core.harbor.domain/v2/: x509: certificate signed by unknown authority
</code></pre><p>This is a known issue with Docker private repository. We can resolve this simply by instruct our mac OS to trust the Harbor repository self signed ca cert.
First we need to get the Harbor ca cert. This can be downloaded from our Project -&gt; Repositories tag, click on the “Registry Certificate”. This will download the ca.crt file.

  <img src="/static/harbor/img_4.png" alt="img_4.png" /></p>
<p>Execute the following command.</p>
<pre tabindex="0"><code>security add-trusted-cert -d -r trustRoot -k ~/Library/Keychains/login.keychain ./ca.crt
</code></pre><p>Restart Docker process after the operation.</p>
<pre tabindex="0"><code>docker login -udevops core.harbor.domain
Password:
Login Succeeded
</code></pre><p>We will proceed to tag the Docker image (e.g. openpolicyagent/opa) according to Harbor convention format
core.harbor.domain/<Harbor project>/<Image name>:<version></p>
<pre tabindex="0"><code>docker tag openpolicyagent/opa:latest  core.harbor.domain/devops/openpolicyagent/opa:latest
</code></pre><p>We will finally push the image into our Harbor repository</p>
<pre tabindex="0"><code>docker push core.harbor.domain/devops/openpolicyagent/opa:latest
</code></pre><h2 id="install-cert-manager">
  Install cert-manager
  <a class="anchor" href="#install-cert-manager">#</a>
</h2>
<p>[https://ruzickap.github.io/k8s-harbor/part-03/#install-cert-manager](install cert-manager)</p>
<p>Create <code>cert-manager</code> namespace and label.</p>
<pre tabindex="0"><code>kubectl create namespace cert-manager
kubectl label namespace cert-manager certmanager.k8s.io/disable-validation=true
</code></pre><p>Add Helm Repository and install it.</p>
<pre tabindex="0"><code>helm repo add jetstack https://charts.jetstack.io
helm repo update
helm install cert-manager \
    --namespace cert-manager \
    --wait jetstack/cert-manager \
    --version v0.10.0
</code></pre><p>Verifying the installation</p>
<pre tabindex="0"><code>kubectl get pods --namespace cert-manager
NAME                                      READY   STATUS    RESTARTS   AGE
cert-manager-556549df9-bjr5v              1/1     Running   0          2m2s
cert-manager-cainjector-69d7cb5d4-bnngd   1/1     Running   0          2m2s
cert-manager-webhook-c5bdf945c-zmwz5      1/1     Running   0          2m2s
</code></pre><h2 id="install-harbor">
  Install Harbor
  <a class="anchor" href="#install-harbor">#</a>
</h2>
<p>[https://ruzickap.github.io/k8s-harbor/part-04/#install-harbor-using-helm](Harbor Helm installation)</p>
<p>Create <code>harbor-system</code> namespace if not exist already and label namespace.</p>
<pre tabindex="0"><code>kubectl get namespace harbor-system &amp;&gt; /dev/null || kubectl create namespace harbor-system
kubectl label namespace --overwrite harbor-system app=kubed
</code></pre></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/alex-shpak/hugo-book/commit/105658c016e4439ee80b5b34802d4fbe26fb2571" title='Last modified by Marcel Widmer | September 24, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>September 24, 2022</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#install-cert-manager">Install cert-manager</a></li>
        <li><a href="#install-harbor">Install Harbor</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












