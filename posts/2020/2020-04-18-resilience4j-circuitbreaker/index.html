<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Create Project # Let&rsquo;s create a Sample Application with Kotlin and Reactive Spring Boot with the spring inializr Rest Endpoint. We will take the latest and greates Spring Boot version 2.3.0.M4 and language kotlin with the following dependencies:
actuator webflux cloud-resilience4j http https://start.spring.io/starter.tgz \ dependencies==actuator,webflux,cloud-resilience4j \ description==&#34;Demo project Kotlin Spring Boot with Resilience4j&#34; \ applicationName==Resilience4jApplication \ name==kboot-resilience4j \ groupId==ch.keepcalm \ artifactId==kboot-resilience4j \ packageName==ch.keepcalm.demo \ javaVersion==11 \ language==kotlin \ baseDir==kboot-resilience4j| tar -xzvf - Add Customer Banner">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Reactive Spring Boot with Resilience4j CircuitBreaker" />
<meta property="og:description" content="Create Project # Let&rsquo;s create a Sample Application with Kotlin and Reactive Spring Boot with the spring inializr Rest Endpoint. We will take the latest and greates Spring Boot version 2.3.0.M4 and language kotlin with the following dependencies:
actuator webflux cloud-resilience4j http https://start.spring.io/starter.tgz \ dependencies==actuator,webflux,cloud-resilience4j \ description==&#34;Demo project Kotlin Spring Boot with Resilience4j&#34; \ applicationName==Resilience4jApplication \ name==kboot-resilience4j \ groupId==ch.keepcalm \ artifactId==kboot-resilience4j \ packageName==ch.keepcalm.demo \ javaVersion==11 \ language==kotlin \ baseDir==kboot-resilience4j| tar -xzvf - Add Customer Banner" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2020/2020-04-18-resilience4j-circuitbreaker/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-24T17:34:12+02:00" />

<title>Reactive Spring Boot with Resilience4j CircuitBreaker | Blog Marcel Widmer </title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css" >
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.6d9040acb89aff39f832a0b8623fad42fa664a32ef333ca95112d6156a809515.js" ></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/avatar.png" alt="Logo" /><span>Blog Marcel Widmer </span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



  



  
    
  



<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </label>

    <ul>
      
      <li>
        <a href="/de/">
          Deutsch
        </a>
      </li>
      
    </ul>
  </li>
</ul>











  












  
<ul>
  
  <li>
    <a href="/posts/" >
        Blog
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Reactive Spring Boot with Resilience4j CircuitBreaker</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#create-project">Create Project</a></li>
        <li><a href="#domain-model">Domain Model</a></li>
        <li><a href="#service">Service</a></li>
        <li><a href="#rest-api">Rest API</a></li>
        <li><a href="#test-rest-api">Test Rest API</a>
          <ul>
            <li><a href="#get-all-movies">Get all Movies</a></li>
            <li><a href="#get-a-random-list-of-movies">Get a random list of Movies</a></li>
            <li><a href="#get-a-movie-by-his-name">Get a Movie by his name</a></li>
            <li><a href="#get-a-movie-by-his-id">Get a Movie by his ID</a></li>
            <li><a href="#search-for-a-not-existing-movie">Search for a not existing Movie</a></li>
          </ul>
        </li>
        <li><a href="#configure-circuitbreaker">Configure CircuitBreaker</a>
          <ul>
            <li><a href="#to-be-continued-">to be continued ..</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/2020/2020-04-18-resilience4j-circuitbreaker/">Reactive Spring Boot with Resilience4j CircuitBreaker</a>
  </h1>
  
  <h5>April 18, 2020</h5>



  
  <div>
    
      <a href="/categories/Development/">Development</a>
  </div>
  

  
  <div>
    
      <a href="/tags/Spring-Boot/">Spring Boot</a>, 
      <a href="/tags/Kotlin/">Kotlin</a>
  </div>
  



<h2 id="create-project">
  Create Project
  <a class="anchor" href="#create-project">#</a>
</h2>
<p>Let&rsquo;s create a Sample Application with Kotlin and Reactive Spring Boot with the 
  <a href="https://start.spring.io/">spring inializr</a> Rest Endpoint. We will take the latest and greates Spring Boot version <code>2.3.0.M4</code> and language <code>kotlin</code> with the following dependencies:</p>
<ul>
<li>actuator</li>
<li>webflux</li>
<li>cloud-resilience4j</li>
</ul>
<pre tabindex="0"><code>http https://start.spring.io/starter.tgz \
    dependencies==actuator,webflux,cloud-resilience4j \
    description==&#34;Demo project Kotlin Spring Boot with Resilience4j&#34; \
    applicationName==Resilience4jApplication \
    name==kboot-resilience4j \
    groupId==ch.keepcalm \
    artifactId==kboot-resilience4j \
    packageName==ch.keepcalm.demo \
    javaVersion==11 \
    language==kotlin \
    baseDir==kboot-resilience4j| tar -xzvf -
</code></pre><p>Add Customer Banner</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http https://raw.githubusercontent.com/marzelwidmer/marzelwidmer.github.io/master/img/banner.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    &gt; kboot-resilience4j/src/main/resources/banner.txt
</span></span></code></pre></div><p>Configure <code>spring.applicatin.name</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;spring:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  application:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: kboot-resilience4j&#34;</span> | &gt; kboot-resilience4j/src/main/resources/application.yaml
</span></span></code></pre></div><p>Remove <code>application.properties</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>rm kboot-resilience4j/src/main/resources/application.properties
</span></span></code></pre></div><p>See also my other post 
  <a href="https://blog.marcelwidmer.org/spring-initializr/">Spring Initializr and HTTPie</a></p>
<h2 id="domain-model">
  Domain Model
  <a class="anchor" href="#domain-model">#</a>
</h2>
<p>Let&rsquo;s start with the <code>Movie</code> domain class with the following properties.</p>
<ul>
<li>name</li>
<li>year</li>
<li>description</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">data</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Movie</span>(<span style="color:#66d9ef">val</span> id: String? = UUID.randomUUID().toString(), <span style="color:#66d9ef">val</span> name: String, <span style="color:#66d9ef">val</span> year: Year, <span style="color:#66d9ef">val</span> description: String)
</span></span></code></pre></div><h2 id="service">
  Service
  <a class="anchor" href="#service">#</a>
</h2>
<p>Now we create the service class <code>MovieService</code> who hold some hard coded movies in a list.
The amazing functions:</p>
<ul>
<li>Get all Movies</li>
<li>Get a random list of Movies</li>
<li>Get a Movie by his name</li>
<li>Get a Movie by his ID</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MovieService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> movies = listOf(
</span></span><span style="display:flex;"><span>        Movie(name = <span style="color:#e6db74">&#34;Matrix&#34;</span>,
</span></span><span style="display:flex;"><span>            year = Year.of(<span style="color:#ae81ff">1999</span>),
</span></span><span style="display:flex;"><span>            description = <span style="color:#e6db74">&#34;A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.&#34;</span>),
</span></span><span style="display:flex;"><span>        Movie(name = <span style="color:#e6db74">&#34;The Godfather&#34;</span>,
</span></span><span style="display:flex;"><span>            year = Year.of(<span style="color:#ae81ff">1972</span>),
</span></span><span style="display:flex;"><span>            description = <span style="color:#e6db74">&#34;The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.&#34;</span>),
</span></span><span style="display:flex;"><span>        Movie(name = <span style="color:#e6db74">&#34;Casablanca&#34;</span>,
</span></span><span style="display:flex;"><span>            year = Year.of(<span style="color:#ae81ff">1942</span>),
</span></span><span style="display:flex;"><span>            description = <span style="color:#e6db74">&#34;A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.&#34;</span>),
</span></span><span style="display:flex;"><span>        Movie(name = <span style="color:#e6db74">&#34;Rocky&#34;</span>,
</span></span><span style="display:flex;"><span>            year = Year.of(<span style="color:#ae81ff">1976</span>),
</span></span><span style="display:flex;"><span>            description = <span style="color:#e6db74">&#34;A small-time boxer gets a supremely rare chance to fight a heavy-weight champion in a bout in which he strives to go the distance for his self-respect.&#34;</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">randomMovie</span>() = Mono.just(movies[kotlin.random.Random.nextInt(movies.size)])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">movies</span>() = Flux.just(movies)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">movieById</span>(id: String) = Mono.just(movies.first { <span style="color:#66d9ef">it</span>.id <span style="color:#f92672">==</span> id })
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">movieByName</span>(name: String?): Mono&lt;Movie&gt; {
</span></span><span style="display:flex;"><span>            name<span style="color:#f92672">?.</span>map {
</span></span><span style="display:flex;"><span>                movies.firstOrNull() { <span style="color:#66d9ef">it</span>.name.toLowerCase() <span style="color:#f92672">==</span> name.toLowerCase() }<span style="color:#f92672">?.</span>let {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> Mono.just(<span style="color:#66d9ef">it</span>)
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }.isNullOrEmpty().apply {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> Mono.error(IllegalArgumentException(<span style="color:#e6db74">&#34;Movie was not found.&#34;</span>))
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="rest-api">
  Rest API
  <a class="anchor" href="#rest-api">#</a>
</h2>
<p>I think now is time to create a REST API <code>/movies/random</code> with the 
  <a href="https://docs.spring.io/spring-framework/docs/current/kdoc-api/spring-framework/org.springframework.web.reactive.function.server/-router-function-dsl/index.html">Reactive router Kotlin DSL</a>.
A easy way to create a <code>WebFlux.fn</code> 
  <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/reactive/function/server/RouterFunctions.html">RouterFunction</a>
Because we have more then one endpoint under <code>/movies</code> we use the <code>&quot;/movies&quot;.nest</code> router function.</p>
<p>We use also our service <code>MovieService</code> so we need a 
  <a href="https://docs.spring.io/spring/docs/current/kdoc-api/spring-framework/org.springframework.context.support/-bean-definition-dsl/-bean-supplier-context/ref.html">Bean Reference</a> to it.</p>
<p><code>val service = ref&lt;MovieService&gt;()</code></p>
<blockquote>
<p>ðŸ’¡: Take care of the order in the Route definiton &ldquo;/&rdquo; have to be at latest position.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>(args: Array&lt;String&gt;) {
</span></span><span style="display:flex;"><span>    runApplication&lt;Resilience4jApplication&gt;(*args) {
</span></span><span style="display:flex;"><span>        addInitializers(
</span></span><span style="display:flex;"><span>            beans {
</span></span><span style="display:flex;"><span>                bean {
</span></span><span style="display:flex;"><span>                    router {
</span></span><span style="display:flex;"><span>                         <span style="color:#e6db74">&#34;movies&#34;</span>.nest {
</span></span><span style="display:flex;"><span>                             <span style="color:#66d9ef">val</span> service = ref&lt;MovieService&gt;()
</span></span><span style="display:flex;"><span>                             <span style="color:#75715e">//http :8080/movies/random
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                             GET(<span style="color:#e6db74">&#34;/random&#34;</span>) {
</span></span><span style="display:flex;"><span>                                 ok().body(service.randomMovie())
</span></span><span style="display:flex;"><span>                             }
</span></span><span style="display:flex;"><span>                             <span style="color:#75715e">//http :8080/movies/ name==&#34;Rocky&#34; -vv
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                             queryParam(<span style="color:#e6db74">&#34;name&#34;</span>, { <span style="color:#66d9ef">true</span> }) {
</span></span><span style="display:flex;"><span>                                 ok().body(service.movieByName(name = <span style="color:#66d9ef">it</span>.queryParam(<span style="color:#e6db74">&#34;name&#34;</span>).<span style="color:#66d9ef">get</span>()))
</span></span><span style="display:flex;"><span>                             }
</span></span><span style="display:flex;"><span>                             <span style="color:#75715e">//http :8080/movies/c7f399bc-ff4c-4a2f-bddf-d92d53a96df2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                             GET(<span style="color:#e6db74">&#34;/{id}&#34;</span>) {
</span></span><span style="display:flex;"><span>                                 ok().body(service.movieById(id = <span style="color:#66d9ef">it</span>.pathVariable(<span style="color:#e6db74">&#34;id&#34;</span>)))
</span></span><span style="display:flex;"><span>                             }
</span></span><span style="display:flex;"><span>                             <span style="color:#75715e">//http :8080/movies/random
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                             GET(<span style="color:#e6db74">&#34;/&#34;</span>) {
</span></span><span style="display:flex;"><span>                                 ok().body(service.movies())
</span></span><span style="display:flex;"><span>                             }
</span></span><span style="display:flex;"><span>                         }
</span></span><span style="display:flex;"><span>                     }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="test-rest-api">
  Test Rest API
  <a class="anchor" href="#test-rest-api">#</a>
</h2>
<p>No is time to make some calls from the terminal with the <code>HTTPie</code> or in a Browser.
First start the application e.g. with <code>mvn spring-boot:run</code>.</p>
<p>Then lets call our amazing endpoints with the <code>HTTPie</code> or Browser.</p>
<h3 id="get-all-movies">
  Get all Movies
  <a class="anchor" href="#get-all-movies">#</a>
</h3>
<p>
  <a href="http://localhost:8080/movies">http://localhost:8080/movies</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http :8080/movies/
</span></span><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>transfer-encoding: chunked
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;c7f399bc-ff4c-4a2f-bddf-d92d53a96df2&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Matrix&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1999&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;0c7a74fc-b735-41a3-a383-72b9dad7d608&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;The Godfather&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1972&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;15a9e15d-4a5e-4b8a-a7c5-d34b0d5d0879&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Casablanca&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1942&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A small-time boxer gets a supremely rare chance to fight a heavy-weight champion in a bout in which he strives to go the distance for his self-respect.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;f6fb4a62-6d84-434e-8e2c-70e4c1e7ab2c&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Rocky&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1976&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><h3 id="get-a-random-list-of-movies">
  Get a random list of Movies
  <a class="anchor" href="#get-a-random-list-of-movies">#</a>
</h3>
<p>
  <a href="http://localhost:8080/movies/random">http://localhost:8080/movies/random</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> http :8080/movies/random
</span></span><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Content-Length: <span style="color:#ae81ff">240</span>
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;5dd310b8-8d51-4a1e-a20c-790fec00029f&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Casablanca&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1942&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="get-a-movie-by-his-name">
  Get a Movie by his name
  <a class="anchor" href="#get-a-movie-by-his-name">#</a>
</h3>
<p>
  <a href="http://localhost:8080/movies/?name=Rocky">http://localhost:8080/movies/?name=Rocky</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http :8080/movies name<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;Rocky&#34;</span> -v
</span></span><span style="display:flex;"><span>GET /movies?name<span style="color:#f92672">=</span>Rocky HTTP/1.1
</span></span><span style="display:flex;"><span>Accept: */*
</span></span><span style="display:flex;"><span>Accept-Encoding: gzip, deflate
</span></span><span style="display:flex;"><span>Connection: keep-alive
</span></span><span style="display:flex;"><span>Host: localhost:8080
</span></span><span style="display:flex;"><span>User-Agent: HTTPie/2.0.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Content-Length: <span style="color:#ae81ff">242</span>
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A small-time boxer gets a supremely rare chance to fight a heavy-weight champion in a bout in which he strives to go the distance for his self-respect.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;5cae75c6-d18a-495b-a80f-60bdd0763eb1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Rocky&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1976&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="get-a-movie-by-his-id">
  Get a Movie by his ID
  <a class="anchor" href="#get-a-movie-by-his-id">#</a>
</h3>
<p>
  <a href="http://localhost:8080/movies/5dd310b8-8d51-4a1e-a20c-790fec00029f">http://localhost:8080/movies/5dd310b8-8d51-4a1e-a20c-790fec00029f</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http :8080/movies/5dd310b8-8d51-4a1e-a20c-790fec00029f
</span></span><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Content-Length: <span style="color:#ae81ff">240</span>
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;5dd310b8-8d51-4a1e-a20c-790fec00029f&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Casablanca&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1942&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="search-for-a-not-existing-movie">
  Search for a not existing Movie
  <a class="anchor" href="#search-for-a-not-existing-movie">#</a>
</h3>
<p>Now let&rsquo;s also search for <code>http://localhost:8080/movies/?name=Creed</code> is also a great movie but this one is not yet in our <code>MovieService</code> included
we will get the following exception.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http :8080/movies name<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;Creed&#34;</span> -v
</span></span><span style="display:flex;"><span>GET /movies?name<span style="color:#f92672">=</span>Creed HTTP/1.1
</span></span><span style="display:flex;"><span>Accept: */*
</span></span><span style="display:flex;"><span>Accept-Encoding: gzip, deflate
</span></span><span style="display:flex;"><span>Connection: keep-alive
</span></span><span style="display:flex;"><span>Host: localhost:8080
</span></span><span style="display:flex;"><span>User-Agent: HTTPie/2.0.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">500</span> Internal Server Error
</span></span><span style="display:flex;"><span>Content-Length: <span style="color:#ae81ff">165</span>
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;Internal Server Error&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;Movie was not found.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/movies&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;requestId&#34;</span>: <span style="color:#e6db74">&#34;61569a89-3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;status&#34;</span>: 500,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;timestamp&#34;</span>: <span style="color:#e6db74">&#34;2020-04-19T21:13:10.403+00:00&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="configure-circuitbreaker">
  Configure CircuitBreaker
  <a class="anchor" href="#configure-circuitbreaker">#</a>
</h2>
<p>ðŸ˜Ž Cool stuff ðŸ˜Ž let&rsquo;s implement the <code>CircuitBreaker</code> with <code>Resilinece4j</code>.
Let&rsquo;s configure the <code>ReactiveCircuitBreaker</code> Bean from <code>ReactiveResilience4JCircuitBreakerFactory</code> with a name <code>movie-service</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>bean {
</span></span><span style="display:flex;"><span>    ReactiveResilience4JCircuitBreakerFactory()
</span></span><span style="display:flex;"><span>        .create(<span style="color:#e6db74">&#34;movie-service&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="to-be-continued-">
  to be continued ..
  <a class="anchor" href="#to-be-continued-">#</a>
</h3>
<p>The example source code can be found here 
  <a href="https://github.com/marzelwidmer/kboot-resilience4j">GitHub</a></p>
<blockquote>
<p>ðŸ’¡ <strong>Logger Configuration</strong>:
logging.pattern.console: &ldquo;%clr(%d{yyyy-MM-dd E HH:mm:ss.SSS}){blue} %clr(%-40.40logger{0}){magenta} - %clr(%m){green}%n&rdquo;</p>
</blockquote>
<hr>
<p><em>References:</em></p>
<blockquote>
<p>
  <a href="https://resilience4j.readme.io/docs">Resilience4j docs</a></p>
</blockquote>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/alex-shpak/hugo-book/commit/9d1b03010fbfd224f40589882876b41f43461748" title='Last modified by Marcel Widmer | September 24, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>September 24, 2022</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#create-project">Create Project</a></li>
        <li><a href="#domain-model">Domain Model</a></li>
        <li><a href="#service">Service</a></li>
        <li><a href="#rest-api">Rest API</a></li>
        <li><a href="#test-rest-api">Test Rest API</a>
          <ul>
            <li><a href="#get-all-movies">Get all Movies</a></li>
            <li><a href="#get-a-random-list-of-movies">Get a random list of Movies</a></li>
            <li><a href="#get-a-movie-by-his-name">Get a Movie by his name</a></li>
            <li><a href="#get-a-movie-by-his-id">Get a Movie by his ID</a></li>
            <li><a href="#search-for-a-not-existing-movie">Search for a not existing Movie</a></li>
          </ul>
        </li>
        <li><a href="#configure-circuitbreaker">Configure CircuitBreaker</a>
          <ul>
            <li><a href="#to-be-continued-">to be continued ..</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












