<!DOCTYPE html>
<html lang="en-us">
<head>





<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Apache Camel with Kotlin and Spring Boot - c3smonkey&#39;s blog</title>
<meta name="description" content="This is my personal blog where I will mostly post about development.">

<meta name="author" content="">

<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?c=20014eb6bfbcb89c0d020d328f96b37b27a7dcfe">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?c=20014eb6bfbcb89c0d020d328f96b37b27a7dcfe">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?c=20014eb6bfbcb89c0d020d328f96b37b27a7dcfe">
<link rel="alternate" href="/index.xml?c=20014eb6bfbcb89c0d020d328f96b37b27a7dcfe" type="application/rss+xml" title="RSS" />
<meta property="og:title" content="Apache Camel with Kotlin and Spring Boot - c3smonkey&#39;s blog">
</meta>
<meta property="og:url" content="https://blog.marcelwidmer.org/posts/2020/2020-05-04-camel-kotlin-spring-boot/">
<meta property="og:type" content="article">
<meta property="og:site_name" content="c3smonkey&#39;s blog">
<meta property="og:description" content="This is my personal blog where I will mostly post about development.">

<meta property="og:image" content="https://blog.marcelwidmer.org/images/featured_image.jpg">

<meta name="twitter:card" content="summary_large_image" /></meta>
<meta name="twitter:site" content="@"></meta>
<meta name="twitter:creator" content="@"></meta>
<meta name="twitter:title" content="Apache Camel with Kotlin and Spring Boot - c3smonkey&#39;s blog"></meta>
<meta name="twitter:url" content="https://blog.marcelwidmer.org/posts/2020/2020-05-04-camel-kotlin-spring-boot/"></meta>
<meta name="twitter:description" content="This is my personal blog where I will mostly post about development."></meta>

<meta property="og:image" content="https://blog.marcelwidmer.org/images/featured_image.jpg">


<link rel="stylesheet" href="/css/main.css?c=20014eb6bfbcb89c0d020d328f96b37b27a7dcfe">
<link rel="stylesheet" href="/css/color.css?c=20014eb6bfbcb89c0d020d328f96b37b27a7dcfe">




</head>

<body >


<div id="content-header" class="title">
  
  <a class="site-title" href="/">c3smonkey&#39;s blog</a>
  
  <span class="site-sub-title"></span>

  

  <div id="main-menu-nav">
    <div id="main-menu-nav-items">
      
        <div class="nav-item"><a href="/tags/">Tags</a></div>
      
        <div class="nav-item"><a href="/categories/">Categories</a></div>
      
    </div>
  </div>
</div>
<div id="content" class="main">




<h2>Apache Camel with Kotlin and Spring Boot</h2>

<span class="sub">2020-05-04</span>








<p>Apache Camel is an open source integration framework that empowers you to quickly and easily integrate various systems consuming or producing data.</p>
<ul>
<li><a href="#precondition">Precondition on OSX</a></li>
<li><a href="#createProject">Create Project</a></li>
<li><a href="#checkCamelContext">Check Camel Context</a></li>
<li><a href="#fileRoute">File Route</a></li>
<li><a href="#ftpRoute">FTP Route</a></li>
<li><a href="#choiceRoute">Choice Route</a></li>
</ul>
<h3 id="precondition">Precondition on OSX</h3>
<p>We will also use command line <code>ftp</code> commands for this you need the <code>ftp</code>
command line tool this can be installed with :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew install inetutils
</span></span></code></pre></div><h2 id="createProject">Create Project</h2>
<p>Run the following commands :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export KBOOT_NAME<span style="color:#f92672">=</span>kboot-camel
</span></span><span style="display:flex;"><span>export KBOOT_APPL_NAME<span style="color:#f92672">=</span>KbootCamel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>http https://start.spring.io/starter.tgz <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    dependencies<span style="color:#f92672">==</span>camel,actuator,webflux <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    description<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;Demo project Spring Boot&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    applicationName<span style="color:#f92672">==</span>$KBOOT_APPL_NAME <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    name<span style="color:#f92672">==</span>$KBOOT_NAME <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    groupId<span style="color:#f92672">==</span>ch.keepcalm <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    artifactId<span style="color:#f92672">==</span>$KBOOT_NAME <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    packageName<span style="color:#f92672">==</span>ch.keepcalm.demo <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    javaVersion<span style="color:#f92672">==</span><span style="color:#ae81ff">11</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    language<span style="color:#f92672">==</span>kotlin <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    baseDir<span style="color:#f92672">==</span>$KBOOT_NAME| tar -xzvf -
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd $KBOOT_NAME
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>http https://raw.githubusercontent.com/marzelwidmer/marzelwidmer.github.io/master/img/banner.txt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    &gt; src/main/resources/banner.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rm src/main/resources/application.properties
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;spring:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  application:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    name: </span>$KBOOT_NAME<span style="color:#e6db74">&#34;</span> | &gt; src/main/resources/application.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>idea .
</span></span></code></pre></div><h3 id="change-maven-dependencies">Change Maven Dependencies</h3>
<p>When working with <code>Camel</code> best practice is to change the generated Maven <code>pom.xml</code> from the <code>start.spring.io</code>
Like in the official description of <code>Apache Camel</code> <a href="https://camel.apache.org/camel-spring-boot/latest/">camel-spring-boot</a>
So lets refactor our <code>pom.xml</code></p>
<p>We take the version from the <code>camel-spring-boot-starter</code> move it up to the <code>properties</code> section with the property name <code>camel.version</code>.
Add the <code>Camel</code> <code>BOM</code> <code>dependencieManagement</code> section to it.</p>
<h4 id="properties-section">Properties Section</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;properties&gt;</span>`
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;camel.version&gt;</span>3.2.0<span style="color:#f92672">&lt;/camel.version&gt;</span>
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/properties&gt;</span>
</span></span></code></pre></div><h4 id="dependency-section">Dependency Section</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- Camel --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.camel.springboot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>camel-spring-boot-starter<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h4 id="dependency-management-section">Dependency Management Section</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependencyManagement&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">&lt;!-- Camel BOM --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.camel.springboot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>camel-spring-boot-dependencies<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;version&gt;</span>${camel.version}<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;type&gt;</span>pom<span style="color:#f92672">&lt;/type&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;scope&gt;</span>import<span style="color:#f92672">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependencyManagement&gt;</span>
</span></span></code></pre></div><h2 id="checkCamelContext">Check CamelContext</h2>
<p>Let&rsquo;s check if <code>Camel</code> is loading in out Spring Boot application for this let`s start the application</p>
<p>Run the following command :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mvn spring-boot:run
</span></span></code></pre></div><p>Verify the console output you should see something like <code>AbstractCamelContext - Apache Camel 3.2.0 (CamelContext: camel-1) is starting</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>   _    ____              _
</span></span><span style="display:flex;"><span>   | | __ __ <span style="color:#f92672">)</span>  ___   ___ | |_
</span></span><span style="display:flex;"><span>   | |/ /  _ <span style="color:#ae81ff">\ </span>/ _ <span style="color:#ae81ff">\ </span>/ _ <span style="color:#ae81ff">\|</span> __|
</span></span><span style="display:flex;"><span>   |   &lt;| |_<span style="color:#f92672">)</span> | <span style="color:#f92672">(</span>_<span style="color:#f92672">)</span> | <span style="color:#f92672">(</span>_<span style="color:#f92672">)</span> | |_
</span></span><span style="display:flex;"><span>   |_|<span style="color:#ae81ff">\_\_</span>___/ <span style="color:#ae81ff">\_</span>__/ <span style="color:#ae81ff">\_</span>__/ <span style="color:#ae81ff">\_</span>_|
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:: kboot-camel: :: Running Spring Boot: <span style="color:#f92672">(</span>v2.3.0.RC1<span style="color:#f92672">)</span> :: Active Profiles: default ::
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:57.489 KbootCamelKt                             - Starting KbootCamelKt on MacBookPro with PID <span style="color:#ae81ff">20731</span> <span style="color:#f92672">(</span>/Users/morpheus/dev/kboot-camel/target/classes started by morpheus in /Users/morpheus/dev/kboot-camel<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:57.493 KbootCamelKt                             - No active profile set, falling back to default profiles: default
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:58.261 trationDelegate$BeanPostProcessorChecker - Bean <span style="color:#e6db74">&#39;org.apache.camel.spring.boot.CamelAutoConfiguration&#39;</span> of type <span style="color:#f92672">[</span>org.apache.camel.spring.boot.CamelAutoConfiguration<span style="color:#f92672">]</span> is not eligible <span style="color:#66d9ef">for</span> getting processed by all BeanPostProcessors <span style="color:#f92672">(</span><span style="color:#66d9ef">for</span> example: not eligible <span style="color:#66d9ef">for</span> auto-proxying<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:58.548 LRUCacheFactory                          - Detected and using LURCacheFactory: camel-caffeine-lrucache
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:58.739 EndpointLinksResolver                    - Exposing <span style="color:#ae81ff">2</span> endpoint<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> beneath base path <span style="color:#e6db74">&#39;/actuator&#39;</span>
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:58.971 SpringBootRoutesCollector                - Loading additional Camel XML routes from: classpath:camel/*.xml
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:58.971 SpringBootRoutesCollector                - Loading additional Camel XML rests from: classpath:camel-rest/*.xml
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:58.985 DefaultManagementStrategy                - JMX is enabled
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:58.987 AbstractCamelContext                     - Apache Camel 3.2.0 <span style="color:#f92672">(</span>CamelContext: camel-1<span style="color:#f92672">)</span> is starting
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:58.989 AbstractCamelContext                     - StreamCaching is not in use. If using streams <span style="color:#66d9ef">then</span> its recommended to enable stream caching. See more details at http://camel.apache.org/stream-caching.html
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:58.989 AbstractCamelContext                     - Total <span style="color:#ae81ff">0</span> routes, of which <span style="color:#ae81ff">0</span> are started
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:58.989 AbstractCamelContext                     - Apache Camel 3.2.0 <span style="color:#f92672">(</span>CamelContext: camel-1<span style="color:#f92672">)</span> started in 0.002 seconds
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:59.139 NettyWebServer                           - Netty started on port<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>: <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>2020-05-05 Tue 07:50:59.142 KbootCamelKt                             - Started KbootCamelKt in 1.965 seconds <span style="color:#f92672">(</span>JVM running <span style="color:#66d9ef">for</span> 2.195<span style="color:#f92672">)</span>
</span></span></code></pre></div><h2 id="fileRoute">File Route</h2>
<h3 id="file-builder-route">File Builder Route</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FileRouteBuilder</span> : RouteBuilder() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> workDir =System.getenv(<span style="color:#e6db74">&#34;PWD&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> input = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$workDir</span><span style="color:#e6db74">/orders/in?include=order.xml&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> output = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$workDir</span><span style="color:#e6db74">/orders/out?fileExist=Fail&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Throws</span>(Exception<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">configure</span>() {
</span></span><span style="display:flex;"><span>        from(<span style="color:#e6db74">&#34;file:</span><span style="color:#e6db74">$input</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            .process(HeaderProcessor())
</span></span><span style="display:flex;"><span>            .to(<span style="color:#e6db74">&#34;file:</span><span style="color:#e6db74">$output</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            .log(<span style="color:#e6db74">&#34;Camel body: </span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{body.class} </span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{body}&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>To test the <code>FileBuilderRoute</code> you can copy the test <code>XML</code> files from my sample application on <a href="https://github.com/marzelwidmer/kboot-camel">GitHub</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── files
</span></span><span style="display:flex;"><span>│   ├── order-2.xml
</span></span><span style="display:flex;"><span>│   └── order.xml
</span></span></code></pre></div><p>in the folder <code>orders/in</code> after application start. The proceeded files will be then in the hidden folder <code>.camel</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>orders
</span></span><span style="display:flex;"><span>├── in
</span></span><span style="display:flex;"><span>│   └── .camel
</span></span><span style="display:flex;"><span>│       ├── order-2.xml
</span></span><span style="display:flex;"><span>│       └── order.xml
</span></span><span style="display:flex;"><span>└── out
</span></span><span style="display:flex;"><span>    ├── 2019-01-28-order-2.xml
</span></span><span style="display:flex;"><span>    └── order.xml
</span></span></code></pre></div><h3 id="processor">Processor</h3>
<p>Creat a <code>HeaderProcessor</code> that implement the function <code>process</code> from the interface <code>org.apache.camel.Processor</code>.
there we parse the date with <code>XPath</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HeaderProcessor</span> : Processor {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">val</span> XPATH_DATE = <span style="color:#e6db74">&#34;/order/orderDate/text()&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">process</span>(exchange: Exchange?) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> oderXml = exchange<span style="color:#f92672">?.</span>`in`<span style="color:#f92672">?.</span>body
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> orderDateTime = XPathBuilder.xpath(XPATH_DATE).evaluate(exchange<span style="color:#f92672">?.</span>context, oderXml)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> formattedOrderDate = getFormattedData(orderDateTime = orderDateTime)
</span></span><span style="display:flex;"><span>        exchange<span style="color:#f92672">?.</span>`in`<span style="color:#f92672">?.</span>setHeader(<span style="color:#e6db74">&#34;orderDate&#34;</span>, formattedOrderDate)
</span></span><span style="display:flex;"><span>        exchange<span style="color:#f92672">?.</span>`in`<span style="color:#f92672">?.</span>setHeader(<span style="color:#e6db74">&#34;uuid&#34;</span>, UUID.randomUUID().toString().take(<span style="color:#ae81ff">4</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: 05.05.20 DirtyHarry Implementation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">getFormattedData</span>(orderDateTime: String) = DateTimeFormatter.ofPattern(<span style="color:#e6db74">&#34;yyyy-MM-dd&#34;</span>)
</span></span><span style="display:flex;"><span>        .format(LocalDateTime.ofInstant(Instant.parse(orderDateTime), ZoneOffset.UTC))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Add <code>HeaderProcessor</code> class to our <code>FileRouteBuilder</code> with <code>.process(HeaderProcessor())</code>
We also change the filename in the <code>to</code> section with <code>.to(&quot;file:$workDir/orders/out?fileName=\${header.orderDate}-\${header.CamelFileName}&quot;)</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FileRouteBuilder</span> : RouteBuilder() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> workDir =System.getenv(<span style="color:#e6db74">&#34;PWD&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> input = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$workDir</span><span style="color:#e6db74">/orders/in?include=order.xml&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> output = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$workDir</span><span style="color:#e6db74">/orders/out?fileExist=Fail&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Throws</span>(Exception<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">configure</span>() {
</span></span><span style="display:flex;"><span>        from(<span style="color:#e6db74">&#34;file:</span><span style="color:#e6db74">$input</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            .to(<span style="color:#e6db74">&#34;file:</span><span style="color:#e6db74">$output</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            .log(<span style="color:#e6db74">&#34;Camel body: </span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{body.class} </span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{body}&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        from(<span style="color:#e6db74">&#34;file:</span><span style="color:#e6db74">$workDir</span><span style="color:#e6db74">/orders/in?include=order-.*xml&#34;</span>)
</span></span><span style="display:flex;"><span>            .process(HeaderProcessor())
</span></span><span style="display:flex;"><span>            .to(<span style="color:#e6db74">&#34;file:</span><span style="color:#e6db74">$workDir</span><span style="color:#e6db74">/orders/out?fileName=</span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{header.orderDate}-</span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{header.uuid}-</span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{header.CamelFileName}&#34;</span>)
</span></span><span style="display:flex;"><span>            .log(<span style="color:#e6db74">&#34;Camel body: </span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{body.class} </span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{body}&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="ftpRoute">FTP Route</h2>
<h3 id="ftp-route-builder">FTP Route Builder</h3>
<p>Let&rsquo;s update our <code>pom</code> file with the <code>camel-ftp</code> dependency.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- camel-ftp  --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.camel<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>camel-ftp<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FtpRouteBuilder</span> : RouteBuilder() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> ftpEndpoint =<span style="color:#e6db74">&#34;ftp.walkerit.ch&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> username =<span style="color:#e6db74">&#34;public&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> password =<span style="color:#e6db74">&#34;Public8852&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> workDir =System.getenv(<span style="color:#e6db74">&#34;PWD&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> output = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$workDir</span><span style="color:#e6db74">/orders/out?fileExist=Fail&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Throws</span>(Exception<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">configure</span>() {
</span></span><span style="display:flex;"><span>         from(<span style="color:#e6db74">&#34;ftp://</span><span style="color:#e6db74">$ftpEndpoint</span><span style="color:#e6db74">?username=</span><span style="color:#e6db74">$username</span><span style="color:#e6db74">&amp;password=</span><span style="color:#e6db74">$password</span><span style="color:#e6db74">&amp;delete=true&amp;include=order.*xml&#34;</span>)
</span></span><span style="display:flex;"><span>             .log(<span style="color:#e6db74">&#34;New File </span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{header.CamleFileName} picked up from </span><span style="color:#ae81ff">\$</span><span style="color:#e6db74">{header.CamleFileHost}&#34;</span>)
</span></span><span style="display:flex;"><span>             .process(ExchangePrinter())
</span></span><span style="display:flex;"><span>             .to(<span style="color:#e6db74">&#34;file://</span><span style="color:#e6db74">$output</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="processor-1">Processor</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExchangePrinter</span> : Processor {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> log = LoggerFactory.getLogger(javaClass)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Throws</span>(Exception<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">process</span>(exchange: Exchange?) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> body = exchange<span style="color:#f92672">?.</span>`in`<span style="color:#f92672">?.</span>body
</span></span><span style="display:flex;"><span>        log.info(<span style="color:#e6db74">&#34;Body: </span><span style="color:#e6db74">$body</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="ftp-server">FTP Server</h2>
<p>Upload test <code>xml</code> file to public <code>FTP</code> server <a href="https://www.walkerit.ch/public-ftp">https://www.walkerit.ch/public-ftp</a>
with the script <code>ftp-upload.sh</code>.</p>
<p>Run the following command :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./ftp-upload.sh
</span></span></code></pre></div><h2 id="start-application">Start Application</h2>
<p>When you start the Application <code>mvn spring-boot:run</code> check the console output for <code>New File  picked up from</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>2020-05-06 Wed 07:32:39.101 KbootCamelKt    - Started KbootCamelKt in 2.055 seconds <span style="color:#f92672">(</span>JVM running <span style="color:#66d9ef">for</span> 2.265<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>2020-05-06 Wed 07:32:40.099 route3          - New File  picked up from
</span></span><span style="display:flex;"><span>2020-05-06 Wed 07:32:40.099 ExchangePrinter - Body: RemoteFile<span style="color:#f92672">[</span>order-ftp.xml<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>and the files will be downloaded in the <code>out</code> folder.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> tree
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── in
</span></span><span style="display:flex;"><span>└── out
</span></span><span style="display:flex;"><span>    └── order-ftp.xml
</span></span></code></pre></div><h2 id="choiceRoute">Choice Route </h2>
<h3 id="choice-route-builder">Choice Route Builder</h3>
<p>Lets creat a choice route aka <code>switch</code>.</p>
<p>This route will put the files in a folder of the publisher name. We will do this with <code>xPATH</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">val</span> XPATH_SEARCH_ORLY = <span style="color:#e6db74">&#34;order/orderItems/orderItem/orderItemPublisherName/text() = &#39;ORly&#39;&#34;</span>
</span></span></code></pre></div><p>This will parse the xml file and deliver the files in the correct folder. For this you can put the sample files from the <code>files</code> folder in the <code>in/publisher/</code> folder.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> tree
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── in
</span></span><span style="display:flex;"><span>│   └── publisher
</span></span><span style="display:flex;"><span>│       ├── pub-foo.xml
</span></span><span style="display:flex;"><span>│       ├── pub-orly.xml
</span></span><span style="display:flex;"><span>│       └── pub-packt.xml
</span></span><span style="display:flex;"><span>└── out
</span></span><span style="display:flex;"><span>    └── publisher
</span></span><span style="display:flex;"><span>        ├── orly
</span></span><span style="display:flex;"><span>        ├── others
</span></span><span style="display:flex;"><span>        └── packt
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChoiceRouteBuilder</span> : RouteBuilder() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> workDir = System.getenv(<span style="color:#e6db74">&#34;PWD&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> input = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$workDir</span><span style="color:#e6db74">/orders/in/publisher?include=pub-.*xml&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> output = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$workDir</span><span style="color:#e6db74">/orders/out/publisher&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">val</span> XPATH_SEARCH_ORLY = <span style="color:#e6db74">&#34;order/orderItems/orderItem/orderItemPublisherName/text() = &#39;ORly&#39;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">val</span> XPATH_SEARCH_PACKT = <span style="color:#e6db74">&#34;order/orderItems/orderItem/orderItemPublisherName/text() = &#39;Packt&#39;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Throws</span>(Exception<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">configure</span>() {
</span></span><span style="display:flex;"><span>        from(<span style="color:#e6db74">&#34;file:</span><span style="color:#e6db74">$input</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            .to(<span style="color:#e6db74">&#34;log:ordersReceived&#34;</span>)
</span></span><span style="display:flex;"><span>            .choice()
</span></span><span style="display:flex;"><span>                .`when`(xpath(XPATH_SEARCH_ORLY))
</span></span><span style="display:flex;"><span>                .log(<span style="color:#e6db74">&#34;ORly received&#34;</span>)
</span></span><span style="display:flex;"><span>                .to(<span style="color:#e6db74">&#34;file:</span><span style="color:#e6db74">$output</span><span style="color:#e6db74">/orly&#34;</span>)
</span></span><span style="display:flex;"><span>            .`when`(xpath(XPATH_SEARCH_PACKT))
</span></span><span style="display:flex;"><span>                .log(<span style="color:#e6db74">&#34;Packt received&#34;</span>)
</span></span><span style="display:flex;"><span>                .to(<span style="color:#e6db74">&#34;file:</span><span style="color:#e6db74">$output</span><span style="color:#e6db74">/packt&#34;</span>)
</span></span><span style="display:flex;"><span>            .otherwise()
</span></span><span style="display:flex;"><span>                .log(<span style="color:#e6db74">&#34;Other received&#34;</span>)
</span></span><span style="display:flex;"><span>                .to(<span style="color:#e6db74">&#34;file:</span><span style="color:#e6db74">$output</span><span style="color:#e6db74">/others&#34;</span>)
</span></span><span style="display:flex;"><span>            .end()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tree
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── in
</span></span><span style="display:flex;"><span>│   └── publisher
</span></span><span style="display:flex;"><span>└── out
</span></span><span style="display:flex;"><span>    └── publisher
</span></span><span style="display:flex;"><span>        ├── orly
</span></span><span style="display:flex;"><span>        │   └── pub-orly.xml
</span></span><span style="display:flex;"><span>        ├── others
</span></span><span style="display:flex;"><span>        │   └── pub-foo.xml
</span></span><span style="display:flex;"><span>        └── packt
</span></span><span style="display:flex;"><span>            └── pub-packt.xml
</span></span></code></pre></div><hr>
<p><em>References:</em></p>
<blockquote>
<p><a href="https://github.com/marzelwidmer/kboot-camel">GitHub Sample Project</a>
| <a href="https://spring.io/blog/2018/05/23/spring-tips-apache-camel">Spring Tips Apache Camel</a>
| <a href="https://camel.apache.org/camel-spring-boot/latest/">Camel Apache Spring Boot</a>
| <a href="https://www.walkerit.ch/public-ftp">Public FTP</a></p>
</blockquote>






<hr class="block-separater">




<div class="content-footer-item">
	Tags for this post:
	
	<a class="post-tag" href="/tags/spring-boot/">Spring Boot</a>
	
</div>







<div class="content-footer-item neighbor">
	
	<div class="prev-post">Prev: <a href="/posts/2020/2020-05-01-minikube-ingress-controller/">Kubernetes Ingress with Ngnix Ingress Controller</a></div>
	
	
	<div class="next-post">Next: <a href="/posts/2020/2020-05-10-kboot-flux-meets-soap/">Kboot Flux Meets Soap</a></div>
	
</div>











    
    
    
    <div class="related-tag-category-list">
        <h4>Other posts tagged by "Spring Boot"</h3>
        <ul class="post-list">
          
          <li class="post-item">
  <div class="post-date sub">2022-09-24</div>
  <div class="post-title"><a href="/posts/2022/2022-24-09-axon-mongodb-extention/">Axon Framework - MongoDB extension</a></div>
  
</li>
          
          <li class="post-item">
  <div class="post-date sub">2020-10-04</div>
  <div class="post-title"><a href="/posts/2020/2020-10-04-hazelcast-k8s/">Kubernetes Hazelcast Distributed Caching</a></div>
  
</li>
          
          <li class="post-item">
  <div class="post-date sub">2020-05-04</div>
  <div class="post-title"><a href="/posts/2020/2020-05-04-camel-kotlin-spring-boot/">Apache Camel with Kotlin and Spring Boot</a></div>
  
</li>
          
        </ul>
        <div class="more-area">
          
          <a class="more" href='/tags/spring-boot/'>more ...</a>
          
      </div>
        </div>
    




<script src="/js/single.js"></script>


	</div><div id="content-footer" class="sub">
  
  <div class="credit">
    Power by <a href="https://gohugo.io">Hugo</a> /
    Theme <a href="https://github.com/michimani/simplog/">simplog</a> by <a href="https://github.com/michimani/">michimani</a>
  </div>
</div></body>

</html>