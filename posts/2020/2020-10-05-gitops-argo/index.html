<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. Application definitions, configurations, and environments should be declarative and version controlled. Application deployment and lifecycle management should be automated, auditable, and easy to understand.
Minikube Setup Monitoring - Grafana-Prometheus Install Argo CD Create App on Argo CD Minikube Setup # Local Development Environment with minikube.
Brew Installation Packages # brew install hyperkit brew install minikube brew install helm brew install httpie brew install stern brew install argocd brew install sops OSX Minikube Test Cluster # Hyperkit # Setup first minikube hyperkit driver.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="GitOps with Argo CD" />
<meta property="og:description" content="Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. Application definitions, configurations, and environments should be declarative and version controlled. Application deployment and lifecycle management should be automated, auditable, and easy to understand.
Minikube Setup Monitoring - Grafana-Prometheus Install Argo CD Create App on Argo CD Minikube Setup # Local Development Environment with minikube.
Brew Installation Packages # brew install hyperkit brew install minikube brew install helm brew install httpie brew install stern brew install argocd brew install sops OSX Minikube Test Cluster # Hyperkit # Setup first minikube hyperkit driver." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2020/2020-10-05-gitops-argo/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-24T18:38:37+02:00" />

<title>GitOps with Argo CD | Blog Marcel Widmer </title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css" >
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.6d9040acb89aff39f832a0b8623fad42fa664a32ef333ca95112d6156a809515.js" ></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/avatar.png" alt="Logo" /><span>Blog Marcel Widmer </span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



  



  
    
  



<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </label>

    <ul>
      
      <li>
        <a href="/de/">
          Deutsch
        </a>
      </li>
      
    </ul>
  </li>
</ul>











  












  
<ul>
  
  <li>
    <a href="/posts/" >
        Blog
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>GitOps with Argo CD</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#minikube">Minikube Setup</a>
      <ul>
        <li><a href="#brew-installation-packages">Brew Installation Packages</a></li>
        <li><a href="#osx-minikube-test-cluster">OSX Minikube Test Cluster</a>
          <ul>
            <li><a href="#hyperkit">Hyperkit</a></li>
            <li><a href="#minikube-addons">Minikube Addons</a></li>
            <li><a href="#start-minikube">Start Minikube</a></li>
          </ul>
        </li>
        <li><a href="#monitoring">Install Monitoring </a>
          <ul>
            <li><a href="#forward-grafana">Forward Grafana</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#argoCD">Install ARGO CD</a>
      <ul>
        <li><a href="#port-forwarding-to-argo-server">Port Forwarding to ARGO Server</a></li>
        <li><a href="#change-argo-admin-password">Change Argo Admin Password</a></li>
      </ul>
    </li>
    <li><a href="#argoCreatApp">Create App with directory-recurse</a>
      <ul>
        <li><a href="#synch-app">Synch App</a></li>
        <li><a href="#test-contracts-inside-k8s">Test Contracts inside K8s</a></li>
        <li><a href="#test-contracts-over-ingress">Test Contracts over Ingress</a></li>
      </ul>
    </li>
    <li><a href="#comming-soon">Comming soon&hellip;</a>
      <ul>
        <li><a href="#sealed-secrets">Sealed Secrets</a>
          <ul>
            <li><a href="#install-client-side-tool-into-usrlocalbin">Install client-side tool into /usr/local/bin/</a></li>
            <li><a href="#create-a-sealed-secret-file-for-redis">Create a sealed secret file for Redis</a></li>
            <li><a href="#apply-the-sealed-secret">Apply the sealed secret</a></li>
            <li><a href="#get-secret">Get Secret</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/2020/2020-10-05-gitops-argo/">GitOps with Argo CD</a>
  </h1>
  
  <h5>October 25, 2020</h5>



  
  <div>
    
      <a href="/categories/Kubernetes/">Kubernetes</a>
  </div>
  

  
  <div>
    
      <a href="/tags/k8s/">k8s</a>, 
      <a href="/tags/argocd/">argocd</a>, 
      <a href="/tags/gitops/">gitops</a>
  </div>
  



<p>
  <a href="https://argoproj.github.io/argo-cd/">Argo CD</a> is a declarative, GitOps continuous delivery tool for Kubernetes.
Application definitions, configurations, and environments should be declarative and version controlled.
Application deployment and lifecycle management should be automated, auditable, and easy to understand.</p>
<ul>
<li>
  <a href="#minikube">Minikube Setup</a>
<ul>
<li>
  <a href="#monitoring">Monitoring - Grafana-Prometheus</a></li>
</ul>
</li>
<li>
  <a href="#argoCD">Install Argo CD</a></li>
<li>
  <a href="#argoCreatApp">Create App on Argo CD</a></li>
</ul>
<h1 id="minikube">
  Minikube Setup
  <a class="anchor" href="#minikube">#</a>
</h1>
<p>Local Development Environment with minikube.</p>
<h2 id="brew-installation-packages">
  Brew Installation Packages
  <a class="anchor" href="#brew-installation-packages">#</a>
</h2>
<pre tabindex="0"><code>brew install hyperkit
brew install minikube
brew install helm
brew install httpie
brew install stern
brew install argocd
brew install sops
</code></pre><h2 id="osx-minikube-test-cluster">
  OSX Minikube Test Cluster
  <a class="anchor" href="#osx-minikube-test-cluster">#</a>
</h2>
<h3 id="hyperkit">
  Hyperkit
  <a class="anchor" href="#hyperkit">#</a>
</h3>
<p>Setup first minikube hyperkit driver.</p>
<pre tabindex="0"><code>minikube config set driver hyperkit
</code></pre><h3 id="minikube-addons">
  Minikube Addons
  <a class="anchor" href="#minikube-addons">#</a>
</h3>
<p>Configure some addons for the test cluster.</p>
<pre tabindex="0"><code>minikube addons enable dashboard -p test
minikube addons enable metrics-server -p test
minikube addons enable ingress -p test
minikube addons enable registry -p test
</code></pre><h3 id="start-minikube">
  Start Minikube
  <a class="anchor" href="#start-minikube">#</a>
</h3>
<p>Now start the minikube test cluster with some memory and cpu settings.</p>
<pre tabindex="0"><code>minikube start --memory 6144 --cpus 4 -p test
</code></pre><h2 id="monitoring">
  Install Monitoring 
  <a class="anchor" href="#monitoring">#</a>
</h2>
<p>Let&rsquo;s install Prometheus and Grafana with Helm. Add Repository and install it on the <code>monitoring</code> namespace.</p>
<pre tabindex="0"><code>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm install --namespace monitoring --create-namespace prometheus prometheus-community/kube-prometheus-stack
</code></pre><h3 id="forward-grafana">
  Forward Grafana
  <a class="anchor" href="#forward-grafana">#</a>
</h3>
<p>Search for the Pod.</p>
<pre tabindex="0"><code>kubectl get pod -n monitoring  | grep prometheus-grafana
prometheus-grafana-bd89cc787-snlk6                       2/2     Running   0          9m34s
</code></pre><p>Forward it port <code>http://localhost:3000</code> log in with the <code>admin</code> username and <code>prom-operator</code> password and youâ€™ll see a lot of ready for user graphs</p>
<pre tabindex="0"><code>kubectl -n monitoring port-forward prometheus-grafana-bd89cc787-snlk6 3000:3000
</code></pre><h1 id="argoCD">
  Install ARGO CD
  <a class="anchor" href="#argoCD">#</a>
</h1>
<p>Create a separate namespace <code>argocd</code> to install argo.</p>
<pre tabindex="0"><code>kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
</code></pre><h2 id="port-forwarding-to-argo-server">
  Port Forwarding to ARGO Server
  <a class="anchor" href="#port-forwarding-to-argo-server">#</a>
</h2>
<pre tabindex="0"><code>kubectl port-forward svc/argocd-server -n argocd 8080:443
</code></pre><h2 id="change-argo-admin-password">
  Change Argo Admin Password
  <a class="anchor" href="#change-argo-admin-password">#</a>
</h2>
<p>The default Password is the Argo Server name.</p>
<pre tabindex="0"><code>kubectl get pod -n argocd | grep argocd-server
argocd-server-5bc896856-xvt92                    1/1     Running   0          71m
</code></pre><p>Use the Argo CLI to login with user <code>admin</code> and change the password.</p>
<pre tabindex="0"><code>argocd login localhost:8080
argocd account update-password
</code></pre><p>
  <img src="/static/gitops-argo/argo.png" alt="Argo" /></p>
<h1 id="argoCreatApp">
  Create App with directory-recurse
  <a class="anchor" href="#argoCreatApp">#</a>
</h1>
<pre tabindex="0"><code>argocd app create kboot --repo https://github.com/marzelwidmer/argo-demo.git \
    --path manifest \
    --directory-recurse \
    --dest-server https://kubernetes.default.svc \
    --dest-namespace default
</code></pre><h2 id="synch-app">
  Synch App
  <a class="anchor" href="#synch-app">#</a>
</h2>
<p>Argo will be sync every 5 min. You can force it via AdminUI <code>https://localhost:8080</code> or  with the following command :</p>
<pre tabindex="0"><code>argocd app sync kboot
</code></pre><h2 id="test-contracts-inside-k8s">
  Test Contracts inside K8s
  <a class="anchor" href="#test-contracts-inside-k8s">#</a>
</h2>
<pre tabindex="0"><code>kubectl run -i --rm --restart=Never curl-client \
    --image=tutum/curl:alpine \
    --command -- curl -s &#39;http://contracts/api/persons&#39; -H &#39;Content-Type: application/json&#39; -w &#34;\n&#34;

[{&#34;firstName&#34;:&#34;John&#34;}]
pod &#34;curl-client&#34; deleted
</code></pre><h2 id="test-contracts-over-ingress">
  Test Contracts over Ingress
  <a class="anchor" href="#test-contracts-over-ingress">#</a>
</h2>
<p>You can edit the <code>/etc/hosts</code> file for details please check my other Blog 
  <a href="https://blog.marcelwidmer.org/posts/2020-05-01-minikube-ingress-controller">Minikube Ingress Controller</a></p>
<pre tabindex="0"><code>http -j http://test.minikube.me/api/persons

HTTP/1.1 200 OK
Connection: keep-alive
Content-Encoding: gzip
Content-Type: application/json
Date: Sun, 25 Oct 2020 08:34:33 GMT
Matched-Stub-Id: e6546194-eda5-4d86-b644-9694fd421ed6
Server: nginx/1.19.1
Transfer-Encoding: chunked
Vary: Accept-Encoding, User-Agent

[
    {
        &#34;firstName&#34;: &#34;John&#34;
    }
]
</code></pre><h1 id="comming-soon">
  Comming soon&hellip;
  <a class="anchor" href="#comming-soon">#</a>
</h1>
<p>Manage Secrets with <code>SealedSecrets</code></p>
<p>See:

  <a href="https://github.com/bitnami-labs/sealed-secrets">https://github.com/bitnami-labs/sealed-secrets</a></p>
<h2 id="sealed-secrets">
  Sealed Secrets
  <a class="anchor" href="#sealed-secrets">#</a>
</h2>
<p>Install Sealed Secrets with Helm to manage Secrets.
see: 
  <a href="https://hub.kubeapps.com/charts/stable/sealed-secrets">https://hub.kubeapps.com/charts/stable/sealed-secrets</a></p>
<pre tabindex="0"><code>helm install sealed --namespace kube-system stable/sealed-secrets
</code></pre><h3 id="install-client-side-tool-into-usrlocalbin">
  Install client-side tool into /usr/local/bin/
  <a class="anchor" href="#install-client-side-tool-into-usrlocalbin">#</a>
</h3>
<pre tabindex="0"><code>GOOS=$(go env GOOS)
GOARCH=$(go env GOARCH)
wget https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.12.4/kubeseal-$GOOS-$GOARCH
sudo install -m 755 kubeseal-$GOOS-$GOARCH /usr/local/bin/kubeseal
</code></pre><h3 id="create-a-sealed-secret-file-for-redis">
  Create a sealed secret file for Redis
  <a class="anchor" href="#create-a-sealed-secret-file-for-redis">#</a>
</h3>
<pre tabindex="0"><code>kubectl create secret generic redis --dry-run=client --from-literal=database-password=verySecurePassword -o yaml | \
 kubeseal \
 --controller-name=sealed-sealed-secrets \
 --controller-namespace=kube-system \
 --format yaml &gt; sealed-redis-secret.yaml
</code></pre><h3 id="apply-the-sealed-secret">
  Apply the sealed secret
  <a class="anchor" href="#apply-the-sealed-secret">#</a>
</h3>
<pre tabindex="0"><code>kubectl create -f sealed-redis-secret.yaml
</code></pre><h3 id="get-secret">
  Get Secret
  <a class="anchor" href="#get-secret">#</a>
</h3>
<p>Running <code>kubectl get secret redis -o yaml</code> will show the decrypted secret that was generated from the sealed secret.
Both the SealedSecret and generated Secret must have the same name and namespace.</p>
<pre tabindex="0"><code>kubectl get secret redis -o yaml
</code></pre><p><em>References:</em></p>
<blockquote>
<p>
  <a href="https://blog.marcelwidmer.org/posts/2020-05-01-minikube-ingress-controller/">Blog Minikube Ingress Controller</a>

  <a href="https://kubernetes.io/docs/tasks/access-application-cluster/ingress-minikube/">ingress-minikube</a></p>
</blockquote>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/alex-shpak/hugo-book/commit/363e3378e469dc2b9bc40321e93a7af0092d3da0" title='Last modified by Marcel Widmer | September 24, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>September 24, 2022</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#minikube">Minikube Setup</a>
      <ul>
        <li><a href="#brew-installation-packages">Brew Installation Packages</a></li>
        <li><a href="#osx-minikube-test-cluster">OSX Minikube Test Cluster</a>
          <ul>
            <li><a href="#hyperkit">Hyperkit</a></li>
            <li><a href="#minikube-addons">Minikube Addons</a></li>
            <li><a href="#start-minikube">Start Minikube</a></li>
          </ul>
        </li>
        <li><a href="#monitoring">Install Monitoring </a>
          <ul>
            <li><a href="#forward-grafana">Forward Grafana</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#argoCD">Install ARGO CD</a>
      <ul>
        <li><a href="#port-forwarding-to-argo-server">Port Forwarding to ARGO Server</a></li>
        <li><a href="#change-argo-admin-password">Change Argo Admin Password</a></li>
      </ul>
    </li>
    <li><a href="#argoCreatApp">Create App with directory-recurse</a>
      <ul>
        <li><a href="#synch-app">Synch App</a></li>
        <li><a href="#test-contracts-inside-k8s">Test Contracts inside K8s</a></li>
        <li><a href="#test-contracts-over-ingress">Test Contracts over Ingress</a></li>
      </ul>
    </li>
    <li><a href="#comming-soon">Comming soon&hellip;</a>
      <ul>
        <li><a href="#sealed-secrets">Sealed Secrets</a>
          <ul>
            <li><a href="#install-client-side-tool-into-usrlocalbin">Install client-side tool into /usr/local/bin/</a></li>
            <li><a href="#create-a-sealed-secret-file-for-redis">Create a sealed secret file for Redis</a></li>
            <li><a href="#apply-the-sealed-secret">Apply the sealed secret</a></li>
            <li><a href="#get-secret">Get Secret</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












