<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="This sample show how easy you can put on an existing API the Spring Cloud Gateway as kind of SideCar where you can manage your Security, Logging etc. Or just provide an other Endpoint URL like in this sample.
Let&rsquo;s create a Service with a Reactive Spring Boot Application and MongoDB and a Rest Endpoint.
We start with the MongoDB document class Customer and a ReactiveCrudRepository interface CustomerRepository
@Document data class Customer(@Id val id: String = UUID.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Spring Cloud Gateway" />
<meta property="og:description" content="This sample show how easy you can put on an existing API the Spring Cloud Gateway as kind of SideCar where you can manage your Security, Logging etc. Or just provide an other Endpoint URL like in this sample.
Let&rsquo;s create a Service with a Reactive Spring Boot Application and MongoDB and a Rest Endpoint.
We start with the MongoDB document class Customer and a ReactiveCrudRepository interface CustomerRepository
@Document data class Customer(@Id val id: String = UUID." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2020/2020-04-12-cloud-gateway-sidecar/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-25T16:26:41+02:00" />

<title>Spring Cloud Gateway | Blog Marcel Widmer </title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css" >
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.6d9040acb89aff39f832a0b8623fad42fa664a32ef333ca95112d6156a809515.js" ></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/avatar.png" alt="Logo" /><span>Blog Marcel Widmer </span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



  



  
    
  



<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </label>

    <ul>
      
      <li>
        <a href="/de/">
          Deutsch
        </a>
      </li>
      
    </ul>
  </li>
</ul>











  












  
<ul>
  
  <li>
    <a href="/posts/" >
        Blog
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Spring Cloud Gateway</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents"></nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/2020/2020-04-12-cloud-gateway-sidecar/">Spring Cloud Gateway</a>
  </h1>
  
  <h5>April 16, 2020</h5>



  

  
  <div>
    
      <a href="/tags/SpringBoot/">SpringBoot</a>, 
      <a href="/tags/Kotlin/">Kotlin</a>, 
      <a href="/tags/WebFlux/">WebFlux</a>
  </div>
  



<p>This sample show how easy you can put on an existing <code>API</code> the <code>Spring Cloud Gateway</code> as kind of <code>SideCar</code> where you can manage your Security, Logging etc.
Or just provide an other <code>Endpoint</code> <code>URL</code> like in this sample.</p>
<p>Let&rsquo;s create a Service with a Reactive Spring Boot Application and MongoDB and a Rest Endpoint.</p>
<p>We start with the <code>MongoDB</code> document class <code>Customer</code> and a <code>ReactiveCrudRepository</code> interface <code>CustomerRepository</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#a6e22e">@Document</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">data</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Customer</span>(<span style="color:#a6e22e">@Id</span> <span style="color:#66d9ef">val</span> id: String = UUID.randomUUID().toString(), <span style="color:#66d9ef">val</span> name: String)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">CustomerRepository</span> : ReactiveCrudRepository&lt;Customer, String&gt;
</span></span></code></pre></div><p>Now let&rsquo;s also create a service class <code>CustomerService</code> for it where we provide the following functionality.</p>
<ul>
<li>save</li>
<li>findAll</li>
<li>deleteAll</li>
<li>findById</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomerService</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> customerRepository: CustomerRepository) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">save</span>(customer: Customer) = customerRepository.save(customer)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">findAll</span>() = customerRepository.findAll()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">deleteAll</span>() = customerRepository.deleteAll()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">findById</span>(id: String) = customerRepository.findById(id)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>That we have some data we create a little functionality on application start with the <code>ApplicationRunner</code> from Spring Boot.<br>
Let&rsquo;s create a Bean definition for the <code>ApplicationRunner</code> that delete first all entries and then save some sample values to it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">main</span>(args: Array&lt;String&gt;) {
</span></span><span style="display:flex;"><span>    runApplication&lt;SidecarGatewayApplication&gt;(*args) {
</span></span><span style="display:flex;"><span>        addInitializers(
</span></span><span style="display:flex;"><span>            beans {
</span></span><span style="display:flex;"><span>                bean {
</span></span><span style="display:flex;"><span>                    ApplicationRunner {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">val</span> customerService = ref&lt;CustomerService&gt;()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>                        customerService
</span></span><span style="display:flex;"><span>                            <span style="color:#75715e">// first cleanUp Database
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                            .deleteAll()
</span></span><span style="display:flex;"><span>                            <span style="color:#75715e">// create a list of Customers 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                            .thenMany(  
</span></span><span style="display:flex;"><span>                                listOf(<span style="color:#e6db74">&#34;John&#34;</span>, <span style="color:#e6db74">&#34;Jane&#34;</span>, <span style="color:#e6db74">&#34;Jack&#34;</span>)
</span></span><span style="display:flex;"><span>                                    .toFlux()
</span></span><span style="display:flex;"><span>                                    .map { Customer(name = <span style="color:#66d9ef">it</span>) })
</span></span><span style="display:flex;"><span>                            <span style="color:#75715e">// Save it to the Database
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                            .flatMap { customerService.save(<span style="color:#66d9ef">it</span>) } 
</span></span><span style="display:flex;"><span>                             <span style="color:#75715e">// Search all entries
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                            .thenMany(customerService.findAll()) 
</span></span><span style="display:flex;"><span>                            <span style="color:#75715e">// subscribe - let`s do the work...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                            .subscribe { log.info(<span style="color:#e6db74">&#34;--&gt; </span><span style="color:#e6db74">$it</span><span style="color:#e6db74">&#34;</span>) } 
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now we have some data in our MongoDB I think now is time to create a other Bean with the Kotlin DSL that provide a Rest endpoint.
For this we create an <code>Router</code> that will provide the following endpoints.</p>
<ul>
<li><code>/customers</code></li>
<li><code>/customers/{id}</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// Rest API
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>bean {
</span></span><span style="display:flex;"><span>    router {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">val</span> customerService = ref&lt;CustomerService&gt;()
</span></span><span style="display:flex;"><span>        GET(<span style="color:#e6db74">&#34;/customers&#34;</span>) { 
</span></span><span style="display:flex;"><span>            ok().body(customerService.findAll()) 
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        GET(<span style="color:#e6db74">&#34;/customers/{id}&#34;</span>) { 
</span></span><span style="display:flex;"><span>            ok().body(customerService.findById(<span style="color:#66d9ef">it</span>.pathVariable(<span style="color:#e6db74">&#34;id&#34;</span>))) 
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When we start now our application we can call the endpoint and hopefully we get a result like below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mvn spring-boot:run
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http :8080/customers
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>transfer-encoding: chunked
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;a16c9582-0f40-4a7b-a566-372a56c3d5c8&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;John&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;944c3752-55c5-4ede-bc09-e02a5e47b390&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Jane&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;478ce3f9-0eff-4018-a056-0656cd2c5ad4&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Jack&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Now let&rsquo;s create a sidecar with <code>Spring cloud Gateway</code> that provide another Rest API <code>/api/customers</code> and <code>/api/customers/{id}</code>
Let&rsquo;s create an additional response header <code>X-AnotherHeader</code> with the value <code>SideCar</code> as well.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#75715e">// Gateway Sidecar API
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// http -v :8080/api/customers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Gateway - Sidecar
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>bean {
</span></span><span style="display:flex;"><span>    ref&lt;RouteLocatorBuilder&gt;()
</span></span><span style="display:flex;"><span>        .routes {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// http -v :8080/api/customers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            route(<span style="color:#e6db74">&#34;sidecar-api&#34;</span>) {
</span></span><span style="display:flex;"><span>                path(<span style="color:#e6db74">&#34;/api/**&#34;</span>)
</span></span><span style="display:flex;"><span>                filters {
</span></span><span style="display:flex;"><span>                    rewritePath(<span style="color:#e6db74">&#34;api(?&lt;segment&gt;/?.*)&#34;</span>, <span style="color:#e6db74">&#34;/$</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">{segment}&#34;</span>)
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                uri(<span style="color:#e6db74">&#34;http://localhost:8080&#34;</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When we call now the EndPoint <code>/api/customers</code> we expect that we get the result from before and the additional <code>ResponsHeader</code>
with <code>X-AnotherHeader: SideCar</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http -v :8080/api/customers
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>GET /api/customers HTTP/1.1
</span></span><span style="display:flex;"><span>Accept: */*
</span></span><span style="display:flex;"><span>Accept-Encoding: gzip, deflate
</span></span><span style="display:flex;"><span>Connection: keep-alive
</span></span><span style="display:flex;"><span>Host: localhost:8080
</span></span><span style="display:flex;"><span>User-Agent: HTTPie/2.0.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>X-AnotherHeader: SideCar
</span></span><span style="display:flex;"><span>transfer-encoding: chunked
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;a36f75ae-a97f-41ba-9b38-59a5a6d38055&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;John&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;c0b25559-13ad-4b6b-ae25-adbcd898db82&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Jane&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;2a3a1350-4bea-4504-b732-5b7c97602ebb&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Jack&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>With the Kotlin DSL Route definition is it also easy to create routes only for specifics Spring profiles.</p>
<p>The following command will start the application with the <code>default</code> profile.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mvn spring-boot:run
</span></span></code></pre></div><p><code>Spring Cloud Gateway</code> provide with the <code>Actuator</code> library an endpoint to check the configured routes.
Also let&rsquo;s check first our Routing Table whe we start the application with the default Spring Profile.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http :8080/actuator/gateway/routes
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>transfer-encoding: chunked
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;filters&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;[[RewritePath api(?&lt;segment&gt;/?.*) = &#39;/</span><span style="color:#e6db74">${</span>segment<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;], order = 0]&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;order&#34;</span>: 0,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;predicate&#34;</span>: <span style="color:#e6db74">&#34;Paths: [/api/**], match trailing slash: true&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;route_id&#34;</span>: <span style="color:#e6db74">&#34;sidecar-api&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;uri&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:8080&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Now create a Route just for a specific Spring Profile <code>foo</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>    runApplication&lt;SidecarGatewayApplication&gt;(*args) {
</span></span><span style="display:flex;"><span>        addInitializers(
</span></span><span style="display:flex;"><span>            beans {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Profile
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                profile(<span style="color:#e6db74">&#34;foo&#34;</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Gateway - Sidecar
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    bean {
</span></span><span style="display:flex;"><span>                        ref&lt;RouteLocatorBuilder&gt;()
</span></span><span style="display:flex;"><span>                            .routes {
</span></span><span style="display:flex;"><span>                                <span style="color:#75715e">// http -v :8080/
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                                route(<span style="color:#e6db74">&#34;sidecar-root-to-customers-api&#34;</span>) {
</span></span><span style="display:flex;"><span>                                    path(<span style="color:#e6db74">&#34;/**&#34;</span>)
</span></span><span style="display:flex;"><span>                                    filters {
</span></span><span style="display:flex;"><span>                                        rewritePath(<span style="color:#e6db74">&#34;/(?&lt;segment&gt;/?.*)&#34;</span>, <span style="color:#e6db74">&#34;/customers/$</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">{segment}&#34;</span>)
</span></span><span style="display:flex;"><span>                                    }
</span></span><span style="display:flex;"><span>                                    uri(<span style="color:#e6db74">&#34;http://localhost:8080/&#34;</span>)
</span></span><span style="display:flex;"><span>                                }
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Start the application with the <code>foo</code> profile with <code>-Dspring-boot.run.profiles=foo</code> and check again the Routing Table.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mvn spring-boot:run -Dspring-boot.run.profiles<span style="color:#f92672">=</span>foo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http :8080/actuator/gateway/routes
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Content-Type: application/json
</span></span><span style="display:flex;"><span>transfer-encoding: chunked
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;filters&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;[[RewritePath api(?&lt;segment&gt;/?.*) = &#39;/</span><span style="color:#e6db74">${</span>segment<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;], order = 0]&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;order&#34;</span>: 0,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;predicate&#34;</span>: <span style="color:#e6db74">&#34;Paths: [/api/**], match trailing slash: true&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;route_id&#34;</span>: <span style="color:#e6db74">&#34;sidecar-api&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;uri&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:8080&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;filters&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;[[RewritePath /(?&lt;segment&gt;/?.*) = &#39;/customers/</span><span style="color:#e6db74">${</span>segment<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;], order = 0]&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;order&#34;</span>: 0,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;predicate&#34;</span>: <span style="color:#e6db74">&#34;Paths: [/**], match trailing slash: true&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;route_id&#34;</span>: <span style="color:#e6db74">&#34;sidecar-root-to-customers-api&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;uri&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:8080/&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>The example source code can be found here 
  <a href="https://github.com/marzelwidmer/kotlin-sidecar-gateway">GitHub kotlin-sidecar-gateway</a></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/alex-shpak/hugo-book/commit/a4b0a938c2eb3daee3d881291b70203bb4c13719" title='Last modified by Marcel Widmer | September 25, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>September 25, 2022</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents"></nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












