<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Semantic Release Delivery Pipeline | c3smonkey's blog</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Table of contents Setup Deployment Jenkins Pipeline WebHooks Private Repository Semantic Release Jenkins Pipeline Setup Deployment $ oc new-project development --display-nam e=&#34;Development Environment&#34; Deploy application with the maven.fabric8.io plugin in development stage from local machine.
$ ./mvnw fabric8:deploy -Dfabric8.namespace=development $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n development Create testing project and setup the roles.
$ oc new-project testing --display-name=&#34;Testing Environment&#34; $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n testing $ oc policy add-role-to-group system:image-puller system:serviceaccounts:testing \ -n development Create DeploymentConfiguration in testing stage."><meta name=author content="Marcel Widmer"><link rel=canonical href=https://blog.marcelwidmer.org/blog/2019/2019-09-08-semantic-release-delivery-pipeline/><link rel=stylesheet href=https://blog.marcelwidmer.org/sass/main.min.css><link rel=stylesheet href=https://blog.marcelwidmer.org/sass/nav.min.css><link rel=stylesheet href=https://blog.marcelwidmer.org/plugins/css/pico.min.css><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=apple-touch-icon href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=mask-icon href=https://blog.marcelwidmer.org/static/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.104.0"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.marcelwidmer.org/static"><meta name=twitter:title content="Semantic Release Delivery Pipeline"><meta name=twitter:description content="Table of contents Setup Deployment Jenkins Pipeline WebHooks Private Repository Semantic Release Jenkins Pipeline Setup Deployment $ oc new-project development --display-nam e=&#34;Development Environment&#34; Deploy application with the maven.fabric8.io plugin in development stage from local machine.
$ ./mvnw fabric8:deploy -Dfabric8.namespace=development $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n development Create testing project and setup the roles.
$ oc new-project testing --display-name=&#34;Testing Environment&#34; $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n testing $ oc policy add-role-to-group system:image-puller system:serviceaccounts:testing \ -n development Create DeploymentConfiguration in testing stage."><meta property="og:title" content="Semantic Release Delivery Pipeline"><meta property="og:description" content="Table of contents Setup Deployment Jenkins Pipeline WebHooks Private Repository Semantic Release Jenkins Pipeline Setup Deployment $ oc new-project development --display-nam e=&#34;Development Environment&#34; Deploy application with the maven.fabric8.io plugin in development stage from local machine.
$ ./mvnw fabric8:deploy -Dfabric8.namespace=development $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n development Create testing project and setup the roles.
$ oc new-project testing --display-name=&#34;Testing Environment&#34; $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n testing $ oc policy add-role-to-group system:image-puller system:serviceaccounts:testing \ -n development Create DeploymentConfiguration in testing stage."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.marcelwidmer.org/blog/2019/2019-09-08-semantic-release-delivery-pipeline/"><meta property="og:image" content="https://blog.marcelwidmer.org/static"><meta property="article:section" content="blog"><meta property="article:published_time" content="2019-09-08T00:00:00+00:00"><meta property="article:modified_time" content="2019-09-08T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.marcelwidmer.org/static"><meta name=twitter:title content="Semantic Release Delivery Pipeline"><meta name=twitter:description content="Table of contents Setup Deployment Jenkins Pipeline WebHooks Private Repository Semantic Release Jenkins Pipeline Setup Deployment $ oc new-project development --display-nam e=&#34;Development Environment&#34; Deploy application with the maven.fabric8.io plugin in development stage from local machine.
$ ./mvnw fabric8:deploy -Dfabric8.namespace=development $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n development Create testing project and setup the roles.
$ oc new-project testing --display-name=&#34;Testing Environment&#34; $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n testing $ oc policy add-role-to-group system:image-puller system:serviceaccounts:testing \ -n development Create DeploymentConfiguration in testing stage."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blog","item":"https://blog.marcelwidmer.org/blog/"},{"@type":"ListItem","position":3,"name":"Semantic Release Delivery Pipeline","item":"https://blog.marcelwidmer.org/blog/2019/2019-09-08-semantic-release-delivery-pipeline/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Semantic Release Delivery Pipeline","name":"Semantic Release Delivery Pipeline","description":"Table of contents Setup Deployment Jenkins Pipeline WebHooks Private Repository Semantic Release Jenkins Pipeline Setup Deployment $ oc new-project development --display-nam e=\u0026#34;Development Environment\u0026#34; Deploy application with the maven.fabric8.io plugin in development stage from local machine.\n$ ./mvnw fabric8:deploy -Dfabric8.namespace=development $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n development Create testing project and setup the roles.\n$ oc new-project testing --display-name=\u0026#34;Testing Environment\u0026#34; $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n testing $ oc policy add-role-to-group system:image-puller system:serviceaccounts:testing \\ -n development Create DeploymentConfiguration in testing stage.","keywords":["k8s","CI/CD"],"articleBody":"Table of contents Setup Deployment Jenkins Pipeline WebHooks Private Repository Semantic Release Jenkins Pipeline Setup Deployment $ oc new-project development --display-nam e=\"Development Environment\" Deploy application with the maven.fabric8.io plugin in development stage from local machine.\n$ ./mvnw fabric8:deploy -Dfabric8.namespace=development $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n development Create testing project and setup the roles.\n$ oc new-project testing --display-name=\"Testing Environment\" $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n testing $ oc policy add-role-to-group system:image-puller system:serviceaccounts:testing \\ -n development Create DeploymentConfiguration in testing stage.\n$ oc create dc customer-service --image=docker-registry.default.svc:5000/development/customer-service:promoteQA -n testing $ oc patch dc/customer-service -p \\ '{\"spec\":{\"template\":{\"spec\":{\"containers\":[{\"name\":\"default-container\",\"imagePullPolicy\":\"Always\"}]}}}}' -n testing $ oc expose dc customer-service -n testing --port=8080 $ oc expose svc/customer-service -n testing Create production project and setup the roles.\n$ oc new-project production --display-name=\"Production Environment\" $ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n production $ oc policy add-role-to-group system:image-puller system:serviceaccounts:production \\ -n development Create DeploymentConfiguration in production stage.\n$ oc create dc customer-service --image=docker-registry.default.svc:5000/development/customer-service:promotePROD -n production $ oc patch dc/customer-service -p \\ '{\"spec\":{\"template\":{\"spec\":{\"containers\":[{\"name\":\"default-container\",\"imagePullPolicy\":\"Always\"}]}}}}' -n production $ oc expose dc customer-service -n production --port=8080 $ oc expose svc/customer-service -n production Jenkins Pipeline Let‚Äôs creat a Jenkins Pipeline for the customer-service in the project jenkins.\n$ oc create -n jenkins -f \\ https://blog.marcelwidmer.org/semantic-release-delivery-pipeline/deploy/customer-service-pipeline.yaml WebHooks How we can create a GitHub WebHook for a public Git repository take a look at the following post there we created already a\nWebHook for the catalog-service but here some oc commands for the customer-service.\n$ oc set triggers bc/customer-service-pipeline --from-github -n jenkins Grab the Secret.\n$ oc get bc/customer-service-pipeline -n jenkins -o json | jq '.spec.triggers[].github.secret' Grab Webhook GitHub URL.\n$ oc describe bc/customer-service-pipeline -n jenkins Private Repository access with secrets Create a generic secret link this secret with the builder. Annotate and label it for the Jenkins sync PlugIn. And finally update the bc/customer-service-pipeline with this secret. First you have to create an AccessToken in your GitHub Tokens Settings let it named like openshift-source-builder add repo and user access because this token will be used for Semantic Release\n$ oc create secret generic ci-user-at-github \\ --from-literal=username=machineuser \\ --from-literal=password= \\ --type=kubernetes.io/basic-auth \\ -n jenkins $ oc secrets link builder ci-user-at-github \\ -n jenkins $ oc annotate secret/ci-user-at-github \\ 'build.openshift.io/source-secret-match-uri-1=https://github.com/marzelwidmer/*' \\ -n jenkins $ oc label secret ci-user-at-github credential.sync.jenkins.openshift.io=true \\ -n jenkins $ oc set build-secret bc/customer-service-pipeline ci-user-at-github --source When you check now the Jenkins you will see the ci-user-at-github under credentials https:///credentials/\nYou will also find the a secret ci-user-at-github in the jenkins project in the OpenShift console.\nSemantic Release Jenkins Pipeline First I want say the inspiration I get from the semantic-release automates the whole package release workflow including: determining the next version number, generating the release notes and publishing the package.\nüòé This removes the immediate connection between human emotions and version numbers, strictly following the Semantic Versioning specification.\nIn the case I don‚Äôt found any Maven PlugIn who works in my setup out-of-the-box and I am running here in a Maven Slave and don‚Äôt want create a Maven-Node Slave I chose to follow a setup with just Git commands and a combination with the jgitver-maven-plugin.\nAfter pushing some code in the customer-service repository the Jenkins pipeline start run. It will be tag the source repository if needed based on the commit message inspired on the follow commit message format.\n‚ö†Ô∏è Commit Message Format: Current version 1.0.0 will change the version like:\nMajor version (2.0.0) üëâüèº breaking:|major:|BREAKING CHANGE:\nMinor version (1.1.0) üëâüèº feature:|minor:|feat:\nPatch version (1.0.1) üëâüèº fix:|patch:|docs:|style:|refactor:|perf:|test:|chore:\nIt will also create the image tags if needed.\nTake also a look at the Jenkins BlueOcean pipeline.\nOr at the deployed customer-service.\nCustomer Service Swagger The changelog you can find under Changelog\nI know the above pipeline is a bit chatty because of this I explain my steps here a bit compromised in some pipeline steps. Ok let‚Äôs create a Jenkinsfile in your project repository I prefer to put the Jenkinsfile in a folder jenkins.\nFirst we configure a Maven Slave for this we configure the agent node with the laben maven because our porject is a Maven project.\npipeline { // Agent Maven agent { node { label 'maven' } } } Now lets define some environment variables we can parameterize the pipeline also for other projects later.\n// Environment environment { REPOSITORY = \"github.com/marzelwidmer/customer-service.git\" BRANCHES = \"[[name: '*/master']]\" GIT_TAG_MESSAGE = 'ci-release-bot' GIT_TAG_USER_EMAIL = \"jenkins@c3smonkey.ch\" GIT_TAG_USER_NAME = \"Jenkins\" DEV_ENVIRONMENT = 'development' TEST_ENVIRONMENT = 'testing' PROD_ENVIRONMENT = 'production' APP_NAME = 'customer-service' } (1) The following step will first check the last GIT_COMMIT ID and download a ci-semver.sh script who is hosted in a other central repository who can used for central CI/CD scripts across different project Git repositories.\n(2) This shell script will then check the Git history if there a commit message who match our Semantic Version naming convention to compute the next version.\n(3) The next command will then call the Maven build and test lifecycle and use the jgitver plugin to pass the version we get before from the ci-semver.sh script.\nüí° jgitver: https://www.youtube.com/watch?v=mQmH_Ws9GFI\n(4) This section will store our JUnit test results in the Jenkins.\n(5) Tag Git repository if needed.\n// Stages stages { // Setup stage('build and test application') { steps { script { // Last Git commit LAST_GIT_COMMIT = sh( script: 'git --no-pager show -s --format=\\'%Cblue %h %Creset %s %Cgreen %an %Creset (%ae)\\'', returnStdout: true ).trim() echo \"Last Git commit: ${LAST_GIT_COMMIT}\" // Download script (1) sh ''' echo download ci-semver.sh script from remote repository curl https://raw.githubusercontent.com/marzelwidmer/git-semantic-commits/master/ci-semver.sh --output ./jenkins/ci-semver.sh chmod +x ./jenkins/ci-semver.sh ''' // Compute next version (2) NEXT_VERSION = sh( script: \"./jenkins/ci-semver.sh\", returnStdout: true ).trim() echo \"NEXT_VERSION : ${NEXT_VERSION}\" withCredentials([usernamePassword(credentialsId: 'jenkins-ci-user-at-github', usernameVariable: 'USERNAME', passwordVariable: 'TOKEN')]) { git(branches: \"$BRANCHES\", changelog: true, url: \"https://$TOKEN:x-oauth-basic@$REPOSITORY\") } // Maven build and test (3) sh(\"\"\" echo next version will be $NEXT_VERSION ./mvnw validate ./mvnw validate -Djgitver.use-version=$NEXT_VERSION ./mvnw package -DskipTests -Djgitver.use-version=$NEXT_VERSION echo \"run tests\" sh './mvnw test' \"\"\") // Store Junit results (4) post { always { junit 'target/surefire-reports/*.xml' } } // Tag Git Repository (5) echo \"Create tag with version: ${NEXT_VERSION}\" sh(\"\"\" echo set git config for tagging git config --global user.email '${GIT_TAG_USER_EMAIL}' git config --global user.name '${GIT_TAG_USER_NAME}' if [ \\$(git tag -l $NEXT_VERSION) ]; then echo tag exist already else git tag -a -m '${GIT_TAG_MESSAGE}' ${NEXT_VERSION} git push --follow-tags fi \"\"\") } } } } References and inspiration:\nJenkins Client Plugin Best Practices for Managing Docker Versions CI/CD - A/B - OpenShift - Jenkins GitLab Private Repository Personal Access Tokens - Private Repository Pipelines with git tags jgitver - goal jgitver-maven-plugin\nSemantic commits for git git-semantic-commits Jenkins - semantic-versioning-plugin Jenkins - Git+Parameter+Plugin wilsonmar - jenkins2-pipeline Get Jenkins GDSL working with IntelliJ IDEA\n","wordCount":"1100","inLanguage":"en","datePublished":"2019-09-08T00:00:00Z","dateModified":"2019-09-08T00:00:00Z","author":{"@type":"Person","name":"Marcel Widmer"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.marcelwidmer.org/blog/2019/2019-09-08-semantic-release-delivery-pipeline/"},"publisher":{"@type":"Organization","name":"c3smonkey's blog","logo":{"@type":"ImageObject","url":"https://blog.marcelwidmer.org/static/favicon.ico"}}}</script></head><body><nav class=desktop><ul><li><a class=logo href=https://blog.marcelwidmer.org accesskey=h title="Welcome to my blog (Alt + h)"><img src=/static/favicon.ico alt="Welcome to my blog" width=35 height=35></img><h3 style=margin-bottom:0><strong><em>c3smonkey&rsquo;s blog</em></strong></h3></a></li><li class=toggle-container><input type=checkbox id=switch>
<label for=switch><i id=darkIcon data-feather=moon></i>
<i id=lightIcon data-feather=sun></i></label></li></ul><ul class=desktop-navigation><li><a href=/blog title=Blog><i data-feather=pen-tool></i>
<span>Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><i data-feather=search></i>
<span>Search</span></a></li><li><a href=/contact title=Contact><i data-feather=mail></i>
<span>Contact</span></a></li><li><a href=https://github.com/marzelwidmer title=Github><i data-feather=github></i>
<span></span></a></li></ul><ul class=mobile-navigation><li><button id=menuOpen onclick=openMobile() aria-label="Menu closed">
<i data-feather=menu></i></button>
<button id=menuClose onclick=openMobile() aria-label="Menu opened">
<i data-feather=x></i></button></li></ul></nav><aside class=sidebar id=mobileNav style=display:none><nav><ul><li><a href=/blog title=Blog><span><i data-feather=pen-tool></i>
Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><span><i data-feather=search></i>
Search</span></a></li><li><a href=/contact title=Contact><span><i data-feather=mail></i>
Contact</span></a></li><li><a href=https://github.com/marzelwidmer title=Github><span><i data-feather=github></i></span></a></li></ul></nav></aside><main><div class=container><hgroup><div><a href=https://blog.marcelwidmer.org>Home</a>&nbsp;¬ª&nbsp;<a href=https://blog.marcelwidmer.org/blog/>Blog</a></div><h1>Semantic Release Delivery Pipeline</h1><time datetime='2019-09-08 00:00:00 +0000 UTC'>September 8, 2019</time>&nbsp;¬∑&nbsp;6 min&nbsp;¬∑&nbsp;Marcel Widmer<p></p></hgroup><a href=https://blog.marcelwidmer.org/tags/k8s/><kbd>k8s</kbd></a>
<a href=https://blog.marcelwidmer.org/tags/ci/cd/><kbd>CI/CD</kbd></a><div class="grid grid-main"><div><div class=post><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on twitter" href="https://twitter.com/intent/tweet/?text=Semantic%20Release%20Delivery%20Pipeline&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f&hashtags=k8s%2cCI%2fCD"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f&title=Semantic%20Release%20Delivery%20Pipeline&summary=Semantic%20Release%20Delivery%20Pipeline&source=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f&title=Semantic%20Release%20Delivery%20Pipeline"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on whatsapp" href="https://api.whatsapp.com/send?text=Semantic%20Release%20Delivery%20Pipeline%20-%20https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on telegram" href="https://telegram.me/share/url?text=Semantic%20Release%20Delivery%20Pipeline&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><h1 id=table-of-contents>Table of contents<a class=anchor aria-hidden=true href=#table-of-contents>#</a></h1><ul><li><a href=#SetupDeployment>Setup Deployment</a></li><li><a href=#JenkinsPipeline>Jenkins Pipeline</a></li><li><a href=#WebHooks>WebHooks</a></li><li><a href=#privateRepo>Private Repository</a></li><li><a href=#SemanticReleaseJenkinsPipeline>Semantic Release Jenkins Pipeline</a></li></ul><h2 id=SetupDeployment>Setup Deployment <a class=anchor aria-hidden=true href=#SetupDeployment>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc new-project development --display-nam  e<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Development Environment&#34;</span>
</span></span></code></pre></div><p>Deploy application with the <code>maven.fabric8.io</code> plugin in <code>development</code> stage from local machine.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./mvnw fabric8:deploy -Dfabric8.namespace<span style=color:#f92672>=</span>development
</span></span><span style=display:flex><span>$ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n development
</span></span></code></pre></div><p>Create <code>testing</code> project and setup the roles.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc new-project testing --display-name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Testing Environment&#34;</span> 
</span></span><span style=display:flex><span>$ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n testing
</span></span><span style=display:flex><span>$ oc policy add-role-to-group system:image-puller system:serviceaccounts:testing  <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>          -n development
</span></span></code></pre></div><p>Create <code>DeploymentConfiguration</code> in <code>testing</code> stage.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc create dc customer-service --image<span style=color:#f92672>=</span>docker-registry.default.svc:5000/development/customer-service:promoteQA -n testing
</span></span><span style=display:flex><span>$ oc patch dc/customer-service  -p <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>     <span style=color:#e6db74>&#39;{&#34;spec&#34;:{&#34;template&#34;:{&#34;spec&#34;:{&#34;containers&#34;:[{&#34;name&#34;:&#34;default-container&#34;,&#34;imagePullPolicy&#34;:&#34;Always&#34;}]}}}}&#39;</span> -n testing
</span></span><span style=display:flex><span>$ oc expose dc customer-service -n testing --port<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span> 
</span></span><span style=display:flex><span>$ oc expose svc/customer-service -n testing
</span></span></code></pre></div><p>Create <code>production</code> project and setup the roles.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc new-project production --display-name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Production Environment&#34;</span> 
</span></span><span style=display:flex><span>$ oc policy add-role-to-user edit system:serviceaccount:jenkins:jenkins -n production
</span></span><span style=display:flex><span>$ oc policy add-role-to-group system:image-puller system:serviceaccounts:production  <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>          -n development
</span></span></code></pre></div><p>Create <code>DeploymentConfiguration</code> in <code>production</code> stage.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc create dc customer-service --image<span style=color:#f92672>=</span>docker-registry.default.svc:5000/development/customer-service:promotePROD -n production
</span></span><span style=display:flex><span>$ oc patch dc/customer-service  -p <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>     <span style=color:#e6db74>&#39;{&#34;spec&#34;:{&#34;template&#34;:{&#34;spec&#34;:{&#34;containers&#34;:[{&#34;name&#34;:&#34;default-container&#34;,&#34;imagePullPolicy&#34;:&#34;Always&#34;}]}}}}&#39;</span> -n production
</span></span><span style=display:flex><span>$ oc expose dc customer-service -n production --port<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>$ oc expose svc/customer-service -n production
</span></span></code></pre></div><h2 id=JenkinsPipeline>Jenkins Pipeline <a class=anchor aria-hidden=true href=#JenkinsPipeline>#</a></h2><p>Let&rsquo;s creat a Jenkins Pipeline for the <code>customer-service</code> in the project <code>jenkins</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc create -n jenkins -f <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    https://blog.marcelwidmer.org/semantic-release-delivery-pipeline/deploy/customer-service-pipeline.yaml
</span></span></code></pre></div><h2 id=WebHooks>WebHooks<a class=anchor aria-hidden=true href=#WebHooks>#</a></h2><p>How we can create a <a href=https://github.com/marzelwidmer/customer-service/settings/hooks target=_blank rel=noopener>GitHub WebHook</a> for a public Git repository take a look at the following post there we created already a<br><a href=http://blog.marcelwidmer.org/openshift-delivey-pipeline/#WebHooks target=_blank rel=noopener>WebHook</a> for the <code>catalog-service</code> but here some <code>oc</code> commands
for the <code>customer-service</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc set triggers bc/customer-service-pipeline --from-github  -n jenkins 
</span></span></code></pre></div><p>Grab the <code>Secret</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc get bc/customer-service-pipeline -n jenkins -o json | jq <span style=color:#e6db74>&#39;.spec.triggers[].github.secret&#39;</span>
</span></span></code></pre></div><p>Grab <code>Webhook GitHub URL</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc describe bc/customer-service-pipeline -n jenkins
</span></span></code></pre></div><h2 id=privateRepo>Private Repository access with secrets<a class=anchor aria-hidden=true href=#privateRepo>#</a></h2><p>Create a <code>generic secret</code> link this secret with the <code>builder</code>.
Annotate and label it for the Jenkins sync PlugIn. And finally update the <code>bc/customer-service-pipeline</code> with this secret.
First you have to create an <code>AccessToken</code> in your <a href=https://github.com/settings/tokens target=_blank rel=noopener>GitHub Tokens Settings</a> let it named like <code>openshift-source-builder</code>
add <code>repo</code> and <code>user</code> access because this token will be used for <code>Semantic Release</code></p><p><img src=/static/semantic-release-delivery-pipeline/openshift-source-builder-github-token.png alt=openshift-source-builder-github-token></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc create secret generic ci-user-at-github <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      --from-literal<span style=color:#f92672>=</span>username<span style=color:#f92672>=</span>machineuser <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      --from-literal<span style=color:#f92672>=</span>password<span style=color:#f92672>=</span>&lt;accesstoken&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      --type<span style=color:#f92672>=</span>kubernetes.io/basic-auth <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      -n jenkins
</span></span><span style=display:flex><span>$ oc secrets link builder ci-user-at-github <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -n jenkins
</span></span><span style=display:flex><span>$ oc annotate secret/ci-user-at-github <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>      <span style=color:#e6db74>&#39;build.openshift.io/source-secret-match-uri-1=https://github.com/marzelwidmer/*&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -n jenkins
</span></span><span style=display:flex><span>$ oc label secret ci-user-at-github credential.sync.jenkins.openshift.io<span style=color:#f92672>=</span>true <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -n jenkins
</span></span><span style=display:flex><span>$ oc set build-secret bc/customer-service-pipeline ci-user-at-github --source
</span></span></code></pre></div><p>When you check now the Jenkins you will see the <code>ci-user-at-github</code> under credentials <code>https://&lt;jenkins-url>/credentials/</code></p><p><img src=/static/semantic-release-delivery-pipeline/sync.jenkins.openshift.io.png alt=sync.jenkins></p><p>You will also find the a secret <code>ci-user-at-github</code> in the <code>jenkins</code> project in the OpenShift console.</p><p><img src=/static/semantic-release-delivery-pipeline/secret-ci-user-at-github.png alt=secret-ci-user-at-github></p><h2 id=SemanticReleaseJenkinsPipeline>Semantic Release Jenkins Pipeline <a class=anchor aria-hidden=true href=#SemanticReleaseJenkinsPipeline>#</a></h2><p>First I want say the inspiration I get from the <a href=https://github.com/semantic-release/semantic-release target=_blank rel=noopener>semantic-release</a> automates the whole package
release workflow including: determining the next version number, generating the release notes and publishing the package.</p><blockquote><p>üòé This removes the immediate connection between human emotions and version numbers, strictly following the Semantic Versioning specification.</p></blockquote><p>In the case I don&rsquo;t found any Maven PlugIn who works in my setup <em>out-of-the-box</em> and I am running here in a <code>Maven Slave</code> and don&rsquo;t want create a<code> Maven-Node Slave</code>
I chose to follow a setup with just Git commands and a combination with the <a href=https://github.com/jgitver/jgitver-maven-plugin target=_blank rel=noopener>jgitver-maven-plugin</a>.</p><p><img src=/static/semantic-release-delivery-pipeline/okd-customer-service-pipeline.png alt=okd-customer-service-pipeline></p><p>After pushing some code in the <code>customer-service</code> repository the Jenkins pipeline start run.
It will be tag the source repository if needed based on the commit message inspired on the follow <a href=https://github.com/semantic-release/semantic-release#commit-message-format target=_blank rel=noopener>commit message format</a>.</p><blockquote><p>‚ö†Ô∏è <strong>Commit Message Format</strong>: Current version 1.0.0 will change the version like:</p><p>Major version (2.0.0) üëâüèº breaking:|major:|BREAKING CHANGE:</p><p>Minor version (1.1.0) üëâüèº feature:|minor:|feat:</p><p>Patch version (1.0.1) üëâüèº fix:|patch:|docs:|style:|refactor:|perf:|test:|chore:</p></blockquote><p>It will also create the image tags if needed.</p><p><img src=/static/semantic-release-delivery-pipeline/okd-customer-service-image-tags.png alt=okd-customer-service-image-tags></p><p>Take also a look at the <a href=https://jenkins.io/projects/blueocean/ target=_blank rel=noopener>Jenkins BlueOcean</a> pipeline.</p><p><img src=/static/semantic-release-delivery-pipeline/blueocean-customer-service-pipeline.png alt=blueocean-customer-service-pipeline></p><p>Or at the deployed <em>customer-service</em>.</p><p><a href=http://customer-service-production.apps.c3smonkey.ch/swagger-ui.html target=_blank rel=noopener>Customer Service Swagger</a>
<img src=/static/semantic-release-delivery-pipeline/customer-service-swagger.png alt=customer-service-swagger.png></p><p>The <em>changelog</em> you can find under <a href=https://jenkins-jenkins.apps.c3smonkey.ch/job/jenkins/job/jenkins-customer-service-pipeline/lastSuccessfulBuild/artifact/target/changelog.html target=_blank rel=noopener>Changelog</a></p><p>I know the above pipeline is a bit chatty because of this I explain my steps here a bit compromised in some pipeline steps.
Ok let&rsquo;s create a <em>Jenkinsfile</em> in your project repository I prefer to put the <em>Jenkinsfile</em> in a folder <em>jenkins</em>.</p><p>First we configure a <em>Maven Slave</em> for this we configure the <em>agent node</em> with the laben <code>maven</code> because our porject is a Maven project.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>pipeline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Agent Maven
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    agent <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        node <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            label <span style=color:#e6db74>&#39;maven&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Now lets define some <em>environment</em> variables we can parameterize the pipeline also for other projects later.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>    <span style=color:#75715e>// Environment
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    environment <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        REPOSITORY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;github.com/marzelwidmer/customer-service.git&#34;</span>
</span></span><span style=display:flex><span>        BRANCHES <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;[[name: &#39;*/master&#39;]]&#34;</span>
</span></span><span style=display:flex><span>        GIT_TAG_MESSAGE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;ci-release-bot&#39;</span>
</span></span><span style=display:flex><span>        GIT_TAG_USER_EMAIL <span style=color:#f92672>=</span>  <span style=color:#e6db74>&#34;jenkins@c3smonkey.ch&#34;</span>
</span></span><span style=display:flex><span>        GIT_TAG_USER_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Jenkins&#34;</span>
</span></span><span style=display:flex><span>        DEV_ENVIRONMENT <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;development&#39;</span>
</span></span><span style=display:flex><span>        TEST_ENVIRONMENT <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;testing&#39;</span>
</span></span><span style=display:flex><span>        PROD_ENVIRONMENT <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;production&#39;</span>
</span></span><span style=display:flex><span>        APP_NAME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;customer-service&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>(1) The following step will first check the last <em>GIT_COMMIT ID</em> and download a <em>ci-semver.sh</em> script who is hosted in a other central repository who can used for central <code>CI/CD</code> scripts across different
project Git repositories.</p><p>(2) This shell script will then check the Git history if there a commit message who match our Semantic Version naming convention to compute the next version.</p><p>(3) The next command will then call the <em>Maven</em> build and test lifecycle and use the <a href=https://github.com/jgitver/jgitver target=_blank rel=noopener>jgitver</a> plugin to pass the version we get before from the
<em>ci-semver.sh</em> script.</p><blockquote><p>üí° <strong>jgitver</strong>: <a href="https://www.youtube.com/watch?v=mQmH_Ws9GFI" target=_blank rel=noopener>https://www.youtube.com/watch?v=mQmH_Ws9GFI</a></p></blockquote><p>(4) This section will store our <em>JUnit</em> test results in the Jenkins.</p><p>(5) Tag Git repository if needed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>    <span style=color:#75715e>// Stages
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    stages <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Setup
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        stage<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;build and test application&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            steps <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                script <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// Last Git commit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    LAST_GIT_COMMIT <span style=color:#f92672>=</span> sh<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                            script: <span style=color:#e6db74>&#39;git --no-pager show -s --format=\&#39;%Cblue %h %Creset %s %Cgreen %an %Creset (%ae)\&#39;&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                            returnStdout: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>).</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                    echo <span style=color:#e6db74>&#34;Last Git commit: ${LAST_GIT_COMMIT}&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// Download script  (1)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    sh <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        echo download ci-semver.sh script from remote repository
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        curl https://raw.githubusercontent.com/marzelwidmer/git-semantic-commits/master/ci-semver.sh  --output ./jenkins/ci-semver.sh
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        chmod +x ./jenkins/ci-semver.sh
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// Compute next version (2)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    NEXT_VERSION <span style=color:#f92672>=</span> sh<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>                            script: <span style=color:#e6db74>&#34;./jenkins/ci-semver.sh&#34;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>                            returnStdout: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>).</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>                    echo <span style=color:#e6db74>&#34;NEXT_VERSION : ${NEXT_VERSION}&#34;</span>
</span></span><span style=display:flex><span>                    withCredentials<span style=color:#f92672>([</span>usernamePassword<span style=color:#f92672>(</span>credentialsId: <span style=color:#e6db74>&#39;jenkins-ci-user-at-github&#39;</span><span style=color:#f92672>,</span> usernameVariable: <span style=color:#e6db74>&#39;USERNAME&#39;</span><span style=color:#f92672>,</span> passwordVariable: <span style=color:#e6db74>&#39;TOKEN&#39;</span><span style=color:#f92672>)])</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        git<span style=color:#f92672>(</span>branches: <span style=color:#e6db74>&#34;$BRANCHES&#34;</span><span style=color:#f92672>,</span> changelog: <span style=color:#66d9ef>true</span><span style=color:#f92672>,</span> url: <span style=color:#e6db74>&#34;https://$TOKEN:x-oauth-basic@$REPOSITORY&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// Maven build and test (3)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    sh<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        echo next version will be $NEXT_VERSION
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        ./mvnw validate
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        ./mvnw validate -Djgitver.use-version=$NEXT_VERSION
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        ./mvnw package -DskipTests -Djgitver.use-version=$NEXT_VERSION
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        echo &#34;run tests&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        sh &#39;./mvnw test&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &#34;&#34;&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// Store Junit results (4)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    post <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                        always <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                            junit <span style=color:#e6db74>&#39;target/surefire-reports/*.xml&#39;</span>
</span></span><span style=display:flex><span>                        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// Tag Git Repository (5)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    echo <span style=color:#e6db74>&#34;Create tag with version: ${NEXT_VERSION}&#34;</span>
</span></span><span style=display:flex><span>                    sh<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        echo set git config for tagging
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        git config --global user.email &#39;${GIT_TAG_USER_EMAIL}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        git config --global user.name &#39;${GIT_TAG_USER_NAME}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        if [ \$(git tag -l $NEXT_VERSION) ]; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            echo tag exist already
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        else    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            git tag -a -m &#39;${GIT_TAG_MESSAGE}&#39; ${NEXT_VERSION}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                            git push --follow-tags
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                        fi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &#34;&#34;&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><blockquote><p><strong><em>References and inspiration:</em></strong><br><a href=https://github.com/openshift/jenkins-client-plugin target=_blank rel=noopener>Jenkins Client Plugin</a>
<a href="https://www.youtube.com/watch?v=MqsG9-HEcTw" target=_blank rel=noopener>Best Practices for Managing Docker Versions</a>
<a href=https://dzone.com/articles/continuous-delivery-with-openshift-and-jenkins-ab target=_blank rel=noopener>CI/CD - A/B - OpenShift - Jenkins</a>
<a href=https://cookbook.openshift.org/building-and-deploying-from-source/how-can-i-build-from-a-private-repository-on-gitlab.html target=_blank rel=noopener>GitLab Private Repository</a>
<a href=https://blog.openshift.com/private-git-repositories-part-3-personal-access-tokens/ target=_blank rel=noopener>Personal Access Tokens - Private Repository</a>
<a href=https://jenkins.io/blog/2018/05/16/pipelines-with-git-tags/ target=_blank rel=noopener>Pipelines with git tags</a>
<a href=https://jgitver.github.io/#_goal target=_blank rel=noopener>jgitver - goal</a>
<a href=https://github.com/jgitver/jgitver-maven-plugin target=_blank rel=noopener>jgitver-maven-plugin</a><br><a href=https://codito.in/semantic-commits-for-git target=_blank rel=noopener>Semantic commits for git</a>
<a href=https://github.com/marzelwidmer/git-semantic-commits target=_blank rel=noopener>git-semantic-commits</a>
<a href=https://wiki.jenkins.io/display/JENKINS/semantic-versioning-plugin target=_blank rel=noopener>Jenkins - semantic-versioning-plugin</a>
<a href=https://wiki.jenkins.io/display/JENKINS/Git+Parameter+Plugin target=_blank rel=noopener>Jenkins - Git+Parameter+Plugin</a>
<a href=https://wilsonmar.github.io/jenkins2-pipeline/ target=_blank rel=noopener>wilsonmar - jenkins2-pipeline</a>
<a href=https://gist.github.com/arehmandev/736daba40a3e1ef1fbe939c6674d7da8 target=_blank rel=noopener>Get Jenkins GDSL working with IntelliJ IDEA</a></p></blockquote></div><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on twitter" href="https://twitter.com/intent/tweet/?text=Semantic%20Release%20Delivery%20Pipeline&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f&hashtags=k8s%2cCI%2fCD"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f&title=Semantic%20Release%20Delivery%20Pipeline&summary=Semantic%20Release%20Delivery%20Pipeline&source=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f&title=Semantic%20Release%20Delivery%20Pipeline"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on whatsapp" href="https://api.whatsapp.com/send?text=Semantic%20Release%20Delivery%20Pipeline%20-%20https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Semantic Release Delivery Pipeline on telegram" href="https://telegram.me/share/url?text=Semantic%20Release%20Delivery%20Pipeline&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2019%2f2019-09-08-semantic-release-delivery-pipeline%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></div><aside><article><h3>See Also</h3><a href=/blog/2019/2019-09-01-jaeger/><hgroup><h4><i>Jaeger - Distributed Tracing System</i></h4><p><time datetime='2019-09-01 00:00:00 +0000 UTC'>September 1, 2019</time>&nbsp;¬∑&nbsp;3 min&nbsp;¬∑&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2019/2019-08-20-certbot-letsencrypt/><hgroup><h4><i>Certbot Let`s Encrypt</i></h4><p><time datetime='2019-01-13 00:00:00 +0000 UTC'>January 13, 2019</time>&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2019/2019-01-13-hetzner-okd/><hgroup><h4><i>Install OKD on Hetzner Cloud</i></h4><p><time datetime='2019-01-13 00:00:00 +0000 UTC'>January 13, 2019</time>&nbsp;¬∑&nbsp;9 min&nbsp;¬∑&nbsp;Marcel Widmer</p></hgroup></a></article></aside></div></div></main><footer class=text-center><span>&copy; 2022 <a href=https://blog.marcelwidmer.org>c3smonkey's blog</a></span><div><a href=https://blog.marcelwidmer.org/legal/privacy>Privacy Policy</a>
<span>&</span>
<a href=https://blog.marcelwidmer.org/legal/terms-and-conditions>Terms and Conditions</a></div></footer><article class=hidden id=cookie-banner><div><span></span></div><footer><a role=button id=consent-cookies>Close</a>
<a role=button class=secondary href=/></a></footer></article><script async src=https://blog.marcelwidmer.org/js/cookie.min.js layout=container></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("kbd");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=https://blog.marcelwidmer.org/plugins/js/feather.min.js layout=container></script>
<script src=https://blog.marcelwidmer.org/js/script.min.js layout=container></script></body></html>