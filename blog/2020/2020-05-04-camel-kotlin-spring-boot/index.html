<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Apache Camel with Kotlin and Spring Boot | c3smonkey's blog</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Apache Camel is an open source integration framework that empowers you to quickly and easily integrate various systems consuming or producing data.
Precondition on OSX Create Project Check Camel Context File Route FTP Route Choice Route Precondition on OSX We will also use command line ftp commands for this you need the ftp command line tool this can be installed with :
brew install inetutils Create Project Run the following commands :"><meta name=author content="Marcel Widmer"><link rel=canonical href=https://blog.marcelwidmer.org/blog/2020/2020-05-04-camel-kotlin-spring-boot/><link rel=stylesheet href=https://blog.marcelwidmer.org/sass/main.min.css><link rel=stylesheet href=https://blog.marcelwidmer.org/sass/nav.min.css><link rel=stylesheet href=https://blog.marcelwidmer.org/plugins/css/pico.min.css><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=apple-touch-icon href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=mask-icon href=https://blog.marcelwidmer.org/static/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.104.1"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.marcelwidmer.org/static"><meta name=twitter:title content="Apache Camel with Kotlin and Spring Boot"><meta name=twitter:description content="Apache Camel is an open source integration framework that empowers you to quickly and easily integrate various systems consuming or producing data.
Precondition on OSX Create Project Check Camel Context File Route FTP Route Choice Route Precondition on OSX We will also use command line ftp commands for this you need the ftp command line tool this can be installed with :
brew install inetutils Create Project Run the following commands :"><meta property="og:title" content="Apache Camel with Kotlin and Spring Boot"><meta property="og:description" content="Apache Camel is an open source integration framework that empowers you to quickly and easily integrate various systems consuming or producing data.
Precondition on OSX Create Project Check Camel Context File Route FTP Route Choice Route Precondition on OSX We will also use command line ftp commands for this you need the ftp command line tool this can be installed with :
brew install inetutils Create Project Run the following commands :"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.marcelwidmer.org/blog/2020/2020-05-04-camel-kotlin-spring-boot/"><meta property="og:image" content="https://blog.marcelwidmer.org/static"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-05-04T00:00:00+00:00"><meta property="article:modified_time" content="2020-05-04T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.marcelwidmer.org/static"><meta name=twitter:title content="Apache Camel with Kotlin and Spring Boot"><meta name=twitter:description content="Apache Camel is an open source integration framework that empowers you to quickly and easily integrate various systems consuming or producing data.
Precondition on OSX Create Project Check Camel Context File Route FTP Route Choice Route Precondition on OSX We will also use command line ftp commands for this you need the ftp command line tool this can be installed with :
brew install inetutils Create Project Run the following commands :"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blog","item":"https://blog.marcelwidmer.org/blog/"},{"@type":"ListItem","position":3,"name":"Apache Camel with Kotlin and Spring Boot","item":"https://blog.marcelwidmer.org/blog/2020/2020-05-04-camel-kotlin-spring-boot/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Apache Camel with Kotlin and Spring Boot","name":"Apache Camel with Kotlin and Spring Boot","description":"Apache Camel is an open source integration framework that empowers you to quickly and easily integrate various systems consuming or producing data.\nPrecondition on OSX Create Project Check Camel Context File Route FTP Route Choice Route Precondition on OSX We will also use command line ftp commands for this you need the ftp command line tool this can be installed with :\nbrew install inetutils Create Project Run the following commands :","keywords":["Spring Boot"],"articleBody":"Apache Camel is an open source integration framework that empowers you to quickly and easily integrate various systems consuming or producing data.\nPrecondition on OSX Create Project Check Camel Context File Route FTP Route Choice Route Precondition on OSX We will also use command line ftp commands for this you need the ftp command line tool this can be installed with :\nbrew install inetutils Create Project Run the following commands :\nexport KBOOT_NAME=kboot-camel export KBOOT_APPL_NAME=KbootCamel http https://start.spring.io/starter.tgz \\ dependencies==camel,actuator,webflux \\ description==\"Demo project Spring Boot\" \\ applicationName==$KBOOT_APPL_NAME \\ name==$KBOOT_NAME \\ groupId==ch.keepcalm \\ artifactId==$KBOOT_NAME \\ packageName==ch.keepcalm.demo \\ javaVersion==11 \\ language==kotlin \\ baseDir==$KBOOT_NAME| tar -xzvf - cd $KBOOT_NAME http https://raw.githubusercontent.com/marzelwidmer/marzelwidmer.github.io/master/img/banner.txt \\ \u003e src/main/resources/banner.txt rm src/main/resources/application.properties echo \"spring: application: name: $KBOOT_NAME\" | \u003e src/main/resources/application.yaml idea . Change Maven Dependencies When working with Camel best practice is to change the generated Maven pom.xml from the start.spring.io Like in the official description of Apache Camel camel-spring-boot So lets refactor our pom.xml\nWe take the version from the camel-spring-boot-starter move it up to the properties section with the property name camel.version. Add the Camel BOM dependencieManagement section to it.\nProperties Section ` 3.2.0 ... Dependency Section org.apache.camel.springboot camel-spring-boot-starter Dependency Management Section org.apache.camel.springboot camel-spring-boot-dependencies ${camel.version} pom import Check CamelContext Let’s check if Camel is loading in out Spring Boot application for this let`s start the application\nRun the following command :\nmvn spring-boot:run Verify the console output you should see something like AbstractCamelContext - Apache Camel 3.2.0 (CamelContext: camel-1) is starting\n_ ____ _ | | __ __ ) ___ ___ | |_ | |/ / _ \\ / _ \\ / _ \\| __| | \u003c| |_) | (_) | (_) | |_ |_|\\_\\____/ \\___/ \\___/ \\__| :: kboot-camel: :: Running Spring Boot: (v2.3.0.RC1) :: Active Profiles: default :: 2020-05-05 Tue 07:50:57.489 KbootCamelKt - Starting KbootCamelKt on MacBookPro with PID 20731 (/Users/morpheus/dev/kboot-camel/target/classes started by morpheus in /Users/morpheus/dev/kboot-camel) 2020-05-05 Tue 07:50:57.493 KbootCamelKt - No active profile set, falling back to default profiles: default 2020-05-05 Tue 07:50:58.261 trationDelegate$BeanPostProcessorChecker - Bean 'org.apache.camel.spring.boot.CamelAutoConfiguration' of type [org.apache.camel.spring.boot.CamelAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying) 2020-05-05 Tue 07:50:58.548 LRUCacheFactory - Detected and using LURCacheFactory: camel-caffeine-lrucache 2020-05-05 Tue 07:50:58.739 EndpointLinksResolver - Exposing 2 endpoint(s) beneath base path '/actuator' 2020-05-05 Tue 07:50:58.971 SpringBootRoutesCollector - Loading additional Camel XML routes from: classpath:camel/*.xml 2020-05-05 Tue 07:50:58.971 SpringBootRoutesCollector - Loading additional Camel XML rests from: classpath:camel-rest/*.xml 2020-05-05 Tue 07:50:58.985 DefaultManagementStrategy - JMX is enabled 2020-05-05 Tue 07:50:58.987 AbstractCamelContext - Apache Camel 3.2.0 (CamelContext: camel-1) is starting 2020-05-05 Tue 07:50:58.989 AbstractCamelContext - StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http://camel.apache.org/stream-caching.html 2020-05-05 Tue 07:50:58.989 AbstractCamelContext - Total 0 routes, of which 0 are started 2020-05-05 Tue 07:50:58.989 AbstractCamelContext - Apache Camel 3.2.0 (CamelContext: camel-1) started in 0.002 seconds 2020-05-05 Tue 07:50:59.139 NettyWebServer - Netty started on port(s): 8080 2020-05-05 Tue 07:50:59.142 KbootCamelKt - Started KbootCamelKt in 1.965 seconds (JVM running for 2.195) File Route File Builder Route @Component class FileRouteBuilder : RouteBuilder() { private val workDir =System.getenv(\"PWD\") private val input = \"$workDir/orders/in?include=order.xml\" private val output = \"$workDir/orders/out?fileExist=Fail\" @Throws(Exception::class) override fun configure() { from(\"file:$input\") .process(HeaderProcessor()) .to(\"file:$output\") .log(\"Camel body: \\${body.class} \\${body}\") } } To test the FileBuilderRoute you can copy the test XML files from my sample application on GitHub\n. ├── files │ ├── order-2.xml │ └── order.xml in the folder orders/in after application start. The proceeded files will be then in the hidden folder .camel\norders ├── in │ └── .camel │ ├── order-2.xml │ └── order.xml └── out ├── 2019-01-28-order-2.xml └── order.xml Processor Creat a HeaderProcessor that implement the function process from the interface org.apache.camel.Processor. there we parse the date with XPath.\nclass HeaderProcessor : Processor { private final val XPATH_DATE = \"/order/orderDate/text()\" override fun process(exchange: Exchange?) { val oderXml = exchange?.`in`?.body val orderDateTime = XPathBuilder.xpath(XPATH_DATE).evaluate(exchange?.context, oderXml) val formattedOrderDate = getFormattedData(orderDateTime = orderDateTime) exchange?.`in`?.setHeader(\"orderDate\", formattedOrderDate) exchange?.`in`?.setHeader(\"uuid\", UUID.randomUUID().toString().take(4)) } // TODO: 05.05.20 DirtyHarry Implementation private fun getFormattedData(orderDateTime: String) = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\") .format(LocalDateTime.ofInstant(Instant.parse(orderDateTime), ZoneOffset.UTC)) } Add HeaderProcessor class to our FileRouteBuilder with .process(HeaderProcessor()) We also change the filename in the to section with .to(\"file:$workDir/orders/out?fileName=\\${header.orderDate}-\\${header.CamelFileName}\")\n@Component class FileRouteBuilder : RouteBuilder() { private val workDir =System.getenv(\"PWD\") private val input = \"$workDir/orders/in?include=order.xml\" private val output = \"$workDir/orders/out?fileExist=Fail\" @Throws(Exception::class) override fun configure() { from(\"file:$input\") .to(\"file:$output\") .log(\"Camel body: \\${body.class} \\${body}\") from(\"file:$workDir/orders/in?include=order-.*xml\") .process(HeaderProcessor()) .to(\"file:$workDir/orders/out?fileName=\\${header.orderDate}-\\${header.uuid}-\\${header.CamelFileName}\") .log(\"Camel body: \\${body.class} \\${body}\") } } FTP Route FTP Route Builder Let’s update our pom file with the camel-ftp dependency.\norg.apache.camel camel-ftp @Component class FtpRouteBuilder : RouteBuilder() { private val ftpEndpoint =\"ftp.walkerit.ch\" private val username =\"public\" private val password =\"Public8852\" private val workDir =System.getenv(\"PWD\") private val output = \"$workDir/orders/out?fileExist=Fail\" @Throws(Exception::class) override fun configure() { from(\"ftp://$ftpEndpoint?username=$username\u0026password=$password\u0026delete=true\u0026include=order.*xml\") .log(\"New File \\${header.CamleFileName} picked up from \\${header.CamleFileHost}\") .process(ExchangePrinter()) .to(\"file://$output\") } } Processor class ExchangePrinter : Processor { private val log = LoggerFactory.getLogger(javaClass) @Throws(Exception::class) override fun process(exchange: Exchange?) { val body = exchange?.`in`?.body log.info(\"Body: $body\") } } FTP Server Upload test xml file to public FTP server https://www.walkerit.ch/public-ftp with the script ftp-upload.sh.\nRun the following command :\n./ftp-upload.sh Start Application When you start the Application mvn spring-boot:run check the console output for New File picked up from:\n2020-05-06 Wed 07:32:39.101 KbootCamelKt - Started KbootCamelKt in 2.055 seconds (JVM running for 2.265) 2020-05-06 Wed 07:32:40.099 route3 - New File picked up from 2020-05-06 Wed 07:32:40.099 ExchangePrinter - Body: RemoteFile[order-ftp.xml] and the files will be downloaded in the out folder.\ntree . ├── in └── out └── order-ftp.xml Choice Route Choice Route Builder Lets creat a choice route aka switch.\nThis route will put the files in a folder of the publisher name. We will do this with xPATH\nprivate final val XPATH_SEARCH_ORLY = \"order/orderItems/orderItem/orderItemPublisherName/text() = 'ORly'\" This will parse the xml file and deliver the files in the correct folder. For this you can put the sample files from the files folder in the in/publisher/ folder.\ntree . ├── in │ └── publisher │ ├── pub-foo.xml │ ├── pub-orly.xml │ └── pub-packt.xml └── out └── publisher ├── orly ├── others └── packt @Component class ChoiceRouteBuilder : RouteBuilder() { private val workDir = System.getenv(\"PWD\") private val input = \"$workDir/orders/in/publisher?include=pub-.*xml\" private val output = \"$workDir/orders/out/publisher\" private final val XPATH_SEARCH_ORLY = \"order/orderItems/orderItem/orderItemPublisherName/text() = 'ORly'\" private final val XPATH_SEARCH_PACKT = \"order/orderItems/orderItem/orderItemPublisherName/text() = 'Packt'\" @Throws(Exception::class) override fun configure() { from(\"file:$input\") .to(\"log:ordersReceived\") .choice() .`when`(xpath(XPATH_SEARCH_ORLY)) .log(\"ORly received\") .to(\"file:$output/orly\") .`when`(xpath(XPATH_SEARCH_PACKT)) .log(\"Packt received\") .to(\"file:$output/packt\") .otherwise() .log(\"Other received\") .to(\"file:$output/others\") .end() } } tree . ├── in │ └── publisher └── out └── publisher ├── orly │ └── pub-orly.xml ├── others │ └── pub-foo.xml └── packt └── pub-packt.xml References:\nGitHub Sample Project | Spring Tips Apache Camel | Camel Apache Spring Boot | Public FTP\n","wordCount":"1115","inLanguage":"en","datePublished":"2020-05-04T00:00:00Z","dateModified":"2020-05-04T00:00:00Z","author":{"@type":"Person","name":"Marcel Widmer"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.marcelwidmer.org/blog/2020/2020-05-04-camel-kotlin-spring-boot/"},"publisher":{"@type":"Organization","name":"c3smonkey's blog","logo":{"@type":"ImageObject","url":"https://blog.marcelwidmer.org/static/favicon.ico"}}}</script></head><body><nav class=desktop><ul><li><a class=logo href=https://blog.marcelwidmer.org accesskey=h title="Welcome to my blog (Alt + h)"><img src=/static/favicon.ico alt="Welcome to my blog" width=35 height=35></img><h3 style=margin-bottom:0><strong><em>c3smonkey&rsquo;s blog</em></strong></h3></a></li><li class=toggle-container><input type=checkbox id=switch>
<label for=switch><i id=darkIcon data-feather=moon></i>
<i id=lightIcon data-feather=sun></i></label></li></ul><ul class=desktop-navigation><li><a href=/blog title=Blog><i data-feather=pen-tool></i>
<span>Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><i data-feather=search></i>
<span>Search</span></a></li><li><a href=/contact title=Contact><i data-feather=mail></i>
<span>Contact</span></a></li><li><a href=https://github.com/marzelwidmer title=Github><i data-feather=github></i>
<span></span></a></li></ul><ul class=mobile-navigation><li><button id=menuOpen onclick=openMobile() aria-label="Menu closed">
<i data-feather=menu></i></button>
<button id=menuClose onclick=openMobile() aria-label="Menu opened">
<i data-feather=x></i></button></li></ul></nav><aside class=sidebar id=mobileNav style=display:none><nav><ul><li><a href=/blog title=Blog><span><i data-feather=pen-tool></i>
Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><span><i data-feather=search></i>
Search</span></a></li><li><a href=/contact title=Contact><span><i data-feather=mail></i>
Contact</span></a></li><li><a href=https://github.com/marzelwidmer title=Github><span><i data-feather=github></i></span></a></li></ul></nav></aside><main><div class=container><hgroup><div><a href=https://blog.marcelwidmer.org>Home</a>&nbsp;»&nbsp;<a href=https://blog.marcelwidmer.org/blog/>Blog</a></div><h1>Apache Camel with Kotlin and Spring Boot</h1><time datetime='2020-05-04 00:00:00 +0000 UTC'>May 4, 2020</time>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Marcel Widmer<p></p></hgroup><a href=https://blog.marcelwidmer.org/tags/spring-boot/><kbd>Spring Boot</kbd></a><div class="grid grid-main"><div><article class=toc><div><details open><summary accesskey=c title="(Alt + C)"><span>Table of Contents</span></summary><div><ul><ul><li><a href=#precondition aria-label="Precondition on OSX">Precondition on OSX</a></li></ul><li><a href=#createProject aria-label="Create Project">Create Project</a><ul><li><a href=#change-maven-dependencies aria-label="Change Maven Dependencies">Change Maven Dependencies</a><ul><li><a href=#properties-section aria-label="Properties Section">Properties Section</a></li><li><a href=#dependency-section aria-label="Dependency Section">Dependency Section</a></li><li><a href=#dependency-management-section aria-label="Dependency Management Section">Dependency Management Section</a></li></ul></li></ul></li><li><a href=#checkCamelContext aria-label="Check CamelContext">Check CamelContext</a></li><li><a href=#fileRoute aria-label="File Route">File Route</a><ul><li><a href=#file-builder-route aria-label="File Builder Route">File Builder Route</a></li><li><a href=#processor aria-label=Processor>Processor</a></li></ul></li><li><a href=#ftpRoute aria-label="FTP Route">FTP Route</a><ul><li><a href=#ftp-route-builder aria-label="FTP Route Builder">FTP Route Builder</a></li><li><a href=#processor-1 aria-label=Processor>Processor</a></li></ul></li><li><a href=#ftp-server aria-label="FTP Server">FTP Server</a></li><li><a href=#start-application aria-label="Start Application">Start Application</a></li><li><a href=#choiceRoute aria-label="Choice Route ">Choice Route</a><ul><li><a href=#choice-route-builder aria-label="Choice Route Builder">Choice Route Builder</a></li></ul></li></ul></div></details></div></article><div class=post><div class=share-buttons></div><p>Apache Camel is an open source integration framework that empowers you to quickly and easily integrate various systems consuming or producing data.</p><ul><li><a href=#precondition>Precondition on OSX</a></li><li><a href=#createProject>Create Project</a></li><li><a href=#checkCamelContext>Check Camel Context</a></li><li><a href=#fileRoute>File Route</a></li><li><a href=#ftpRoute>FTP Route</a></li><li><a href=#choiceRoute>Choice Route</a></li></ul><h3 id=precondition>Precondition on OSX<a class=anchor aria-hidden=true href=#precondition>#</a></h3><p>We will also use command line <code>ftp</code> commands for this you need the <code>ftp</code>
command line tool this can be installed with :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install inetutils
</span></span></code></pre></div><h2 id=createProject>Create Project<a class=anchor aria-hidden=true href=#createProject>#</a></h2><p>Run the following commands :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export KBOOT_NAME<span style=color:#f92672>=</span>kboot-camel
</span></span><span style=display:flex><span>export KBOOT_APPL_NAME<span style=color:#f92672>=</span>KbootCamel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>http https://start.spring.io/starter.tgz <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    dependencies<span style=color:#f92672>==</span>camel,actuator,webflux <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    description<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;Demo project Spring Boot&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    applicationName<span style=color:#f92672>==</span>$KBOOT_APPL_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    name<span style=color:#f92672>==</span>$KBOOT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    groupId<span style=color:#f92672>==</span>ch.keepcalm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    artifactId<span style=color:#f92672>==</span>$KBOOT_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    packageName<span style=color:#f92672>==</span>ch.keepcalm.demo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    javaVersion<span style=color:#f92672>==</span><span style=color:#ae81ff>11</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    language<span style=color:#f92672>==</span>kotlin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    baseDir<span style=color:#f92672>==</span>$KBOOT_NAME| tar -xzvf -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd $KBOOT_NAME
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>http https://raw.githubusercontent.com/marzelwidmer/marzelwidmer.github.io/master/img/banner.txt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    &gt; src/main/resources/banner.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rm src/main/resources/application.properties
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;spring:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  application:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: </span>$KBOOT_NAME<span style=color:#e6db74>&#34;</span> | &gt; src/main/resources/application.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>idea .
</span></span></code></pre></div><h3 id=change-maven-dependencies>Change Maven Dependencies<a class=anchor aria-hidden=true href=#change-maven-dependencies>#</a></h3><p>When working with <code>Camel</code> best practice is to change the generated Maven <code>pom.xml</code> from the <code>start.spring.io</code>
Like in the official description of <code>Apache Camel</code> <a href=https://camel.apache.org/camel-spring-boot/latest/ target=_blank rel=noopener>camel-spring-boot</a>
So lets refactor our <code>pom.xml</code></p><p>We take the version from the <code>camel-spring-boot-starter</code> move it up to the <code>properties</code> section with the property name <code>camel.version</code>.
Add the <code>Camel</code> <code>BOM</code> <code>dependencieManagement</code> section to it.</p><h4 id=properties-section>Properties Section<a class=anchor aria-hidden=true href=#properties-section>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;properties&gt;</span>`
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;camel.version&gt;</span>3.2.0<span style=color:#f92672>&lt;/camel.version&gt;</span>
</span></span><span style=display:flex><span>        ...
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/properties&gt;</span>
</span></span></code></pre></div><h4 id=dependency-section>Dependency Section<a class=anchor aria-hidden=true href=#dependency-section>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- Camel --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.camel.springboot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>camel-spring-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h4 id=dependency-management-section>Dependency Management Section<a class=anchor aria-hidden=true href=#dependency-management-section>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependencyManagement&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- Camel BOM --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.camel.springboot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>camel-spring-boot-dependencies<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>${camel.version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;type&gt;</span>pom<span style=color:#f92672>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;scope&gt;</span>import<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependencyManagement&gt;</span>
</span></span></code></pre></div><h2 id=checkCamelContext>Check CamelContext<a class=anchor aria-hidden=true href=#checkCamelContext>#</a></h2><p>Let&rsquo;s check if <code>Camel</code> is loading in out Spring Boot application for this let`s start the application</p><p>Run the following command :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mvn spring-boot:run
</span></span></code></pre></div><p>Verify the console output you should see something like <code>AbstractCamelContext - Apache Camel 3.2.0 (CamelContext: camel-1) is starting</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>   _    ____              _
</span></span><span style=display:flex><span>   | | __ __ <span style=color:#f92672>)</span>  ___   ___ | |_
</span></span><span style=display:flex><span>   | |/ /  _ <span style=color:#ae81ff>\ </span>/ _ <span style=color:#ae81ff>\ </span>/ _ <span style=color:#ae81ff>\|</span> __|
</span></span><span style=display:flex><span>   |   &lt;| |_<span style=color:#f92672>)</span> | <span style=color:#f92672>(</span>_<span style=color:#f92672>)</span> | <span style=color:#f92672>(</span>_<span style=color:#f92672>)</span> | |_
</span></span><span style=display:flex><span>   |_|<span style=color:#ae81ff>\_\_</span>___/ <span style=color:#ae81ff>\_</span>__/ <span style=color:#ae81ff>\_</span>__/ <span style=color:#ae81ff>\_</span>_|
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>:: kboot-camel: :: Running Spring Boot: <span style=color:#f92672>(</span>v2.3.0.RC1<span style=color:#f92672>)</span> :: Active Profiles: default ::
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:57.489 KbootCamelKt                             - Starting KbootCamelKt on MacBookPro with PID <span style=color:#ae81ff>20731</span> <span style=color:#f92672>(</span>/Users/morpheus/dev/kboot-camel/target/classes started by morpheus in /Users/morpheus/dev/kboot-camel<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:57.493 KbootCamelKt                             - No active profile set, falling back to default profiles: default
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:58.261 trationDelegate$BeanPostProcessorChecker - Bean <span style=color:#e6db74>&#39;org.apache.camel.spring.boot.CamelAutoConfiguration&#39;</span> of type <span style=color:#f92672>[</span>org.apache.camel.spring.boot.CamelAutoConfiguration<span style=color:#f92672>]</span> is not eligible <span style=color:#66d9ef>for</span> getting processed by all BeanPostProcessors <span style=color:#f92672>(</span><span style=color:#66d9ef>for</span> example: not eligible <span style=color:#66d9ef>for</span> auto-proxying<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:58.548 LRUCacheFactory                          - Detected and using LURCacheFactory: camel-caffeine-lrucache
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:58.739 EndpointLinksResolver                    - Exposing <span style=color:#ae81ff>2</span> endpoint<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> beneath base path <span style=color:#e6db74>&#39;/actuator&#39;</span>
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:58.971 SpringBootRoutesCollector                - Loading additional Camel XML routes from: classpath:camel/*.xml
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:58.971 SpringBootRoutesCollector                - Loading additional Camel XML rests from: classpath:camel-rest/*.xml
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:58.985 DefaultManagementStrategy                - JMX is enabled
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:58.987 AbstractCamelContext                     - Apache Camel 3.2.0 <span style=color:#f92672>(</span>CamelContext: camel-1<span style=color:#f92672>)</span> is starting
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:58.989 AbstractCamelContext                     - StreamCaching is not in use. If using streams <span style=color:#66d9ef>then</span> its recommended to enable stream caching. See more details at http://camel.apache.org/stream-caching.html
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:58.989 AbstractCamelContext                     - Total <span style=color:#ae81ff>0</span> routes, of which <span style=color:#ae81ff>0</span> are started
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:58.989 AbstractCamelContext                     - Apache Camel 3.2.0 <span style=color:#f92672>(</span>CamelContext: camel-1<span style=color:#f92672>)</span> started in 0.002 seconds
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:59.139 NettyWebServer                           - Netty started on port<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>2020-05-05 Tue 07:50:59.142 KbootCamelKt                             - Started KbootCamelKt in 1.965 seconds <span style=color:#f92672>(</span>JVM running <span style=color:#66d9ef>for</span> 2.195<span style=color:#f92672>)</span>
</span></span></code></pre></div><h2 id=fileRoute>File Route<a class=anchor aria-hidden=true href=#fileRoute>#</a></h2><h3 id=file-builder-route>File Builder Route<a class=anchor aria-hidden=true href=#file-builder-route>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FileRouteBuilder</span> : RouteBuilder() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> workDir =System.getenv(<span style=color:#e6db74>&#34;PWD&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> input = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$workDir</span><span style=color:#e6db74>/orders/in?include=order.xml&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> output = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$workDir</span><span style=color:#e6db74>/orders/out?fileExist=Fail&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Throws</span>(Exception<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>configure</span>() {
</span></span><span style=display:flex><span>        from(<span style=color:#e6db74>&#34;file:</span><span style=color:#e6db74>$input</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            .process(HeaderProcessor())
</span></span><span style=display:flex><span>            .to(<span style=color:#e6db74>&#34;file:</span><span style=color:#e6db74>$output</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            .log(<span style=color:#e6db74>&#34;Camel body: </span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{body.class} </span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{body}&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>To test the <code>FileBuilderRoute</code> you can copy the test <code>XML</code> files from my sample application on <a href=https://github.com/marzelwidmer/kboot-camel target=_blank rel=noopener>GitHub</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── files
</span></span><span style=display:flex><span>│   ├── order-2.xml
</span></span><span style=display:flex><span>│   └── order.xml
</span></span></code></pre></div><p>in the folder <code>orders/in</code> after application start. The proceeded files will be then in the hidden folder <code>.camel</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>orders
</span></span><span style=display:flex><span>├── in
</span></span><span style=display:flex><span>│   └── .camel
</span></span><span style=display:flex><span>│       ├── order-2.xml
</span></span><span style=display:flex><span>│       └── order.xml
</span></span><span style=display:flex><span>└── out
</span></span><span style=display:flex><span>    ├── 2019-01-28-order-2.xml
</span></span><span style=display:flex><span>    └── order.xml
</span></span></code></pre></div><h3 id=processor>Processor<a class=anchor aria-hidden=true href=#processor>#</a></h3><p>Creat a <code>HeaderProcessor</code> that implement the function <code>process</code> from the interface <code>org.apache.camel.Processor</code>.
there we parse the date with <code>XPath</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HeaderProcessor</span> : Processor {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>val</span> XPATH_DATE = <span style=color:#e6db74>&#34;/order/orderDate/text()&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>process</span>(exchange: Exchange?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> oderXml = exchange<span style=color:#f92672>?.</span>`in`<span style=color:#f92672>?.</span>body
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> orderDateTime = XPathBuilder.xpath(XPATH_DATE).evaluate(exchange<span style=color:#f92672>?.</span>context, oderXml)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> formattedOrderDate = getFormattedData(orderDateTime = orderDateTime)
</span></span><span style=display:flex><span>        exchange<span style=color:#f92672>?.</span>`in`<span style=color:#f92672>?.</span>setHeader(<span style=color:#e6db74>&#34;orderDate&#34;</span>, formattedOrderDate)
</span></span><span style=display:flex><span>        exchange<span style=color:#f92672>?.</span>`in`<span style=color:#f92672>?.</span>setHeader(<span style=color:#e6db74>&#34;uuid&#34;</span>, UUID.randomUUID().toString().take(<span style=color:#ae81ff>4</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// TODO: 05.05.20 DirtyHarry Implementation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getFormattedData</span>(orderDateTime: String) = DateTimeFormatter.ofPattern(<span style=color:#e6db74>&#34;yyyy-MM-dd&#34;</span>)
</span></span><span style=display:flex><span>        .format(LocalDateTime.ofInstant(Instant.parse(orderDateTime), ZoneOffset.UTC))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Add <code>HeaderProcessor</code> class to our <code>FileRouteBuilder</code> with <code>.process(HeaderProcessor())</code>
We also change the filename in the <code>to</code> section with <code>.to("file:$workDir/orders/out?fileName=\${header.orderDate}-\${header.CamelFileName}")</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FileRouteBuilder</span> : RouteBuilder() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> workDir =System.getenv(<span style=color:#e6db74>&#34;PWD&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> input = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$workDir</span><span style=color:#e6db74>/orders/in?include=order.xml&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> output = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$workDir</span><span style=color:#e6db74>/orders/out?fileExist=Fail&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Throws</span>(Exception<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>configure</span>() {
</span></span><span style=display:flex><span>        from(<span style=color:#e6db74>&#34;file:</span><span style=color:#e6db74>$input</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            .to(<span style=color:#e6db74>&#34;file:</span><span style=color:#e6db74>$output</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            .log(<span style=color:#e6db74>&#34;Camel body: </span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{body.class} </span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{body}&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        from(<span style=color:#e6db74>&#34;file:</span><span style=color:#e6db74>$workDir</span><span style=color:#e6db74>/orders/in?include=order-.*xml&#34;</span>)
</span></span><span style=display:flex><span>            .process(HeaderProcessor())
</span></span><span style=display:flex><span>            .to(<span style=color:#e6db74>&#34;file:</span><span style=color:#e6db74>$workDir</span><span style=color:#e6db74>/orders/out?fileName=</span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{header.orderDate}-</span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{header.uuid}-</span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{header.CamelFileName}&#34;</span>)
</span></span><span style=display:flex><span>            .log(<span style=color:#e6db74>&#34;Camel body: </span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{body.class} </span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{body}&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=ftpRoute>FTP Route<a class=anchor aria-hidden=true href=#ftpRoute>#</a></h2><h3 id=ftp-route-builder>FTP Route Builder<a class=anchor aria-hidden=true href=#ftp-route-builder>#</a></h3><p>Let&rsquo;s update our <code>pom</code> file with the <code>camel-ftp</code> dependency.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- camel-ftp  --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.camel<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>camel-ftp<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FtpRouteBuilder</span> : RouteBuilder() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> ftpEndpoint =<span style=color:#e6db74>&#34;ftp.walkerit.ch&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> username =<span style=color:#e6db74>&#34;public&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> password =<span style=color:#e6db74>&#34;Public8852&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> workDir =System.getenv(<span style=color:#e6db74>&#34;PWD&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> output = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$workDir</span><span style=color:#e6db74>/orders/out?fileExist=Fail&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Throws</span>(Exception<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>configure</span>() {
</span></span><span style=display:flex><span>         from(<span style=color:#e6db74>&#34;ftp://</span><span style=color:#e6db74>$ftpEndpoint</span><span style=color:#e6db74>?username=</span><span style=color:#e6db74>$username</span><span style=color:#e6db74>&amp;password=</span><span style=color:#e6db74>$password</span><span style=color:#e6db74>&amp;delete=true&amp;include=order.*xml&#34;</span>)
</span></span><span style=display:flex><span>             .log(<span style=color:#e6db74>&#34;New File </span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{header.CamleFileName} picked up from </span><span style=color:#ae81ff>\$</span><span style=color:#e6db74>{header.CamleFileHost}&#34;</span>)
</span></span><span style=display:flex><span>             .process(ExchangePrinter())
</span></span><span style=display:flex><span>             .to(<span style=color:#e6db74>&#34;file://</span><span style=color:#e6db74>$output</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=processor-1>Processor<a class=anchor aria-hidden=true href=#processor-1>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExchangePrinter</span> : Processor {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> log = LoggerFactory.getLogger(javaClass)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Throws</span>(Exception<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>process</span>(exchange: Exchange?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> body = exchange<span style=color:#f92672>?.</span>`in`<span style=color:#f92672>?.</span>body
</span></span><span style=display:flex><span>        log.info(<span style=color:#e6db74>&#34;Body: </span><span style=color:#e6db74>$body</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=ftp-server>FTP Server<a class=anchor aria-hidden=true href=#ftp-server>#</a></h2><p>Upload test <code>xml</code> file to public <code>FTP</code> server <a href=https://www.walkerit.ch/public-ftp target=_blank rel=noopener>https://www.walkerit.ch/public-ftp</a>
with the script <code>ftp-upload.sh</code>.</p><p>Run the following command :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./ftp-upload.sh
</span></span></code></pre></div><h2 id=start-application>Start Application<a class=anchor aria-hidden=true href=#start-application>#</a></h2><p>When you start the Application <code>mvn spring-boot:run</code> check the console output for <code>New File picked up from</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>2020-05-06 Wed 07:32:39.101 KbootCamelKt    - Started KbootCamelKt in 2.055 seconds <span style=color:#f92672>(</span>JVM running <span style=color:#66d9ef>for</span> 2.265<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2020-05-06 Wed 07:32:40.099 route3          - New File  picked up from
</span></span><span style=display:flex><span>2020-05-06 Wed 07:32:40.099 ExchangePrinter - Body: RemoteFile<span style=color:#f92672>[</span>order-ftp.xml<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>and the files will be downloaded in the <code>out</code> folder.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> tree
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── in
</span></span><span style=display:flex><span>└── out
</span></span><span style=display:flex><span>    └── order-ftp.xml
</span></span></code></pre></div><h2 id=choiceRoute>Choice Route <a class=anchor aria-hidden=true href=#choiceRoute>#</a></h2><h3 id=choice-route-builder>Choice Route Builder<a class=anchor aria-hidden=true href=#choice-route-builder>#</a></h3><p>Lets creat a choice route aka <code>switch</code>.</p><p>This route will put the files in a folder of the publisher name. We will do this with <code>xPATH</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>val</span> XPATH_SEARCH_ORLY = <span style=color:#e6db74>&#34;order/orderItems/orderItem/orderItemPublisherName/text() = &#39;ORly&#39;&#34;</span>
</span></span></code></pre></div><p>This will parse the xml file and deliver the files in the correct folder. For this you can put the sample files from the <code>files</code> folder in the <code>in/publisher/</code> folder.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> tree
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── in
</span></span><span style=display:flex><span>│   └── publisher
</span></span><span style=display:flex><span>│       ├── pub-foo.xml
</span></span><span style=display:flex><span>│       ├── pub-orly.xml
</span></span><span style=display:flex><span>│       └── pub-packt.xml
</span></span><span style=display:flex><span>└── out
</span></span><span style=display:flex><span>    └── publisher
</span></span><span style=display:flex><span>        ├── orly
</span></span><span style=display:flex><span>        ├── others
</span></span><span style=display:flex><span>        └── packt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ChoiceRouteBuilder</span> : RouteBuilder() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> workDir = System.getenv(<span style=color:#e6db74>&#34;PWD&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> input = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$workDir</span><span style=color:#e6db74>/orders/in/publisher?include=pub-.*xml&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> output = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>$workDir</span><span style=color:#e6db74>/orders/out/publisher&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>val</span> XPATH_SEARCH_ORLY = <span style=color:#e6db74>&#34;order/orderItems/orderItem/orderItemPublisherName/text() = &#39;ORly&#39;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>val</span> XPATH_SEARCH_PACKT = <span style=color:#e6db74>&#34;order/orderItems/orderItem/orderItemPublisherName/text() = &#39;Packt&#39;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Throws</span>(Exception<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>configure</span>() {
</span></span><span style=display:flex><span>        from(<span style=color:#e6db74>&#34;file:</span><span style=color:#e6db74>$input</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            .to(<span style=color:#e6db74>&#34;log:ordersReceived&#34;</span>)
</span></span><span style=display:flex><span>            .choice()
</span></span><span style=display:flex><span>                .`when`(xpath(XPATH_SEARCH_ORLY))
</span></span><span style=display:flex><span>                .log(<span style=color:#e6db74>&#34;ORly received&#34;</span>)
</span></span><span style=display:flex><span>                .to(<span style=color:#e6db74>&#34;file:</span><span style=color:#e6db74>$output</span><span style=color:#e6db74>/orly&#34;</span>)
</span></span><span style=display:flex><span>            .`when`(xpath(XPATH_SEARCH_PACKT))
</span></span><span style=display:flex><span>                .log(<span style=color:#e6db74>&#34;Packt received&#34;</span>)
</span></span><span style=display:flex><span>                .to(<span style=color:#e6db74>&#34;file:</span><span style=color:#e6db74>$output</span><span style=color:#e6db74>/packt&#34;</span>)
</span></span><span style=display:flex><span>            .otherwise()
</span></span><span style=display:flex><span>                .log(<span style=color:#e6db74>&#34;Other received&#34;</span>)
</span></span><span style=display:flex><span>                .to(<span style=color:#e6db74>&#34;file:</span><span style=color:#e6db74>$output</span><span style=color:#e6db74>/others&#34;</span>)
</span></span><span style=display:flex><span>            .end()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tree
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── in
</span></span><span style=display:flex><span>│   └── publisher
</span></span><span style=display:flex><span>└── out
</span></span><span style=display:flex><span>    └── publisher
</span></span><span style=display:flex><span>        ├── orly
</span></span><span style=display:flex><span>        │   └── pub-orly.xml
</span></span><span style=display:flex><span>        ├── others
</span></span><span style=display:flex><span>        │   └── pub-foo.xml
</span></span><span style=display:flex><span>        └── packt
</span></span><span style=display:flex><span>            └── pub-packt.xml
</span></span></code></pre></div><hr><p><em>References:</em></p><blockquote><p><a href=https://github.com/marzelwidmer/kboot-camel target=_blank rel=noopener>GitHub Sample Project</a>
| <a href=https://spring.io/blog/2018/05/23/spring-tips-apache-camel target=_blank rel=noopener>Spring Tips Apache Camel</a>
| <a href=https://camel.apache.org/camel-spring-boot/latest/ target=_blank rel=noopener>Camel Apache Spring Boot</a>
| <a href=https://www.walkerit.ch/public-ftp target=_blank rel=noopener>Public FTP</a></p></blockquote></div><div class=share-buttons></div></div><aside><article><h3>See Also</h3><a href=/blog/2020/2020-04-18-resilience4j-circuitbreaker/><hgroup><h4><i>Reactive Spring Boot with Resilience4j CircuitBreaker</i></h4><p><time datetime='2020-04-18 00:00:00 +0000 UTC'>April 18, 2020</time>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2020/2020-04-12-cloud-gateway-sidecar/><hgroup><h4><i>Spring Cloud Gateway</i></h4><p><time datetime='2020-04-16 00:00:00 +0000 UTC'>April 16, 2020</time>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2020/2020-04-12-spring-initializr/><hgroup><h4><i>Create Kotlin Project with Spring Initializr and HTTPie</i></h4><p><time datetime='2020-04-12 00:00:00 +0000 UTC'>April 12, 2020</time>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2019/2019-10-22-axon/><hgroup><h4><i>AxonIQ</i></h4><p><time datetime='2019-09-18 00:00:00 +0000 UTC'>September 18, 2019</time>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2019/2019-08-28-multiple-project-promoting/><hgroup><h4><i>Promoting Applications Across Environments</i></h4><p><time datetime='2019-09-18 00:00:00 +0000 UTC'>September 18, 2019</time>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a></article></aside></div></div></main><footer class=text-center><span>&copy; 2022 <a href=https://blog.marcelwidmer.org>c3smonkey's blog</a></span><div><a href=https://blog.marcelwidmer.org/legal/privacy>Privacy Policy</a>
<span>&</span>
<a href=https://blog.marcelwidmer.org/legal/terms-and-conditions>Terms and Conditions</a></div></footer><article class=hidden id=cookie-banner><div><span></span></div><footer><a role=button id=consent-cookies>Close</a>
<a role=button class=secondary href=/></a></footer></article><script async src=https://blog.marcelwidmer.org/js/cookie.min.js layout=container></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("kbd");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=https://blog.marcelwidmer.org/plugins/js/feather.min.js layout=container></script>
<script src=https://blog.marcelwidmer.org/js/script.min.js layout=container></script></body></html>