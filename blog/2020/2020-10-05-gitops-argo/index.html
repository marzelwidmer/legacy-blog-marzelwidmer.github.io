<!doctype html><html lang=en-us><head><meta charset=utf-8><title>GitOps with Argo CD | c3smonkey's blog</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. Application definitions, configurations, and environments should be declarative and version controlled. Application deployment and lifecycle management should be automated, auditable, and easy to understand.
Minikube Setup Monitoring - Grafana-Prometheus Install Argo CD Create App on Argo CD Minikube Setup Local Development Environment with minikube.
Brew Installation Packages brew install hyperkit brew install minikube brew install helm brew install httpie brew install stern brew install argocd brew install sops OSX Minikube Test Cluster Hyperkit Setup first minikube hyperkit driver."><meta name=author content="Marcel Widmer"><link rel=canonical href=https://blog.marcelwidmer.org/blog/2020/2020-10-05-gitops-argo/><link rel=stylesheet href=https://blog.marcelwidmer.org/sass/main.min.css><link rel=stylesheet href=https://blog.marcelwidmer.org/sass/nav.min.css><link rel=stylesheet href=https://blog.marcelwidmer.org/plugins/css/pico.min.css><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=apple-touch-icon href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=mask-icon href=https://blog.marcelwidmer.org/static/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.104.0"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.marcelwidmer.org/static"><meta name=twitter:title content="GitOps with Argo CD"><meta name=twitter:description content="Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. Application definitions, configurations, and environments should be declarative and version controlled. Application deployment and lifecycle management should be automated, auditable, and easy to understand.
Minikube Setup Monitoring - Grafana-Prometheus Install Argo CD Create App on Argo CD Minikube Setup Local Development Environment with minikube.
Brew Installation Packages brew install hyperkit brew install minikube brew install helm brew install httpie brew install stern brew install argocd brew install sops OSX Minikube Test Cluster Hyperkit Setup first minikube hyperkit driver."><meta property="og:title" content="GitOps with Argo CD"><meta property="og:description" content="Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. Application definitions, configurations, and environments should be declarative and version controlled. Application deployment and lifecycle management should be automated, auditable, and easy to understand.
Minikube Setup Monitoring - Grafana-Prometheus Install Argo CD Create App on Argo CD Minikube Setup Local Development Environment with minikube.
Brew Installation Packages brew install hyperkit brew install minikube brew install helm brew install httpie brew install stern brew install argocd brew install sops OSX Minikube Test Cluster Hyperkit Setup first minikube hyperkit driver."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.marcelwidmer.org/blog/2020/2020-10-05-gitops-argo/"><meta property="og:image" content="https://blog.marcelwidmer.org/static"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-10-25T00:00:00+00:00"><meta property="article:modified_time" content="2020-10-25T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.marcelwidmer.org/static"><meta name=twitter:title content="GitOps with Argo CD"><meta name=twitter:description content="Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. Application definitions, configurations, and environments should be declarative and version controlled. Application deployment and lifecycle management should be automated, auditable, and easy to understand.
Minikube Setup Monitoring - Grafana-Prometheus Install Argo CD Create App on Argo CD Minikube Setup Local Development Environment with minikube.
Brew Installation Packages brew install hyperkit brew install minikube brew install helm brew install httpie brew install stern brew install argocd brew install sops OSX Minikube Test Cluster Hyperkit Setup first minikube hyperkit driver."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blog","item":"https://blog.marcelwidmer.org/blog/"},{"@type":"ListItem","position":3,"name":"GitOps with Argo CD","item":"https://blog.marcelwidmer.org/blog/2020/2020-10-05-gitops-argo/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"GitOps with Argo CD","name":"GitOps with Argo CD","description":"Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. Application definitions, configurations, and environments should be declarative and version controlled. Application deployment and lifecycle management should be automated, auditable, and easy to understand.\nMinikube Setup Monitoring - Grafana-Prometheus Install Argo CD Create App on Argo CD Minikube Setup Local Development Environment with minikube.\nBrew Installation Packages brew install hyperkit brew install minikube brew install helm brew install httpie brew install stern brew install argocd brew install sops OSX Minikube Test Cluster Hyperkit Setup first minikube hyperkit driver.","keywords":["k8s","argocd","gitops"],"articleBody":"Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. Application definitions, configurations, and environments should be declarative and version controlled. Application deployment and lifecycle management should be automated, auditable, and easy to understand.\nMinikube Setup Monitoring - Grafana-Prometheus Install Argo CD Create App on Argo CD Minikube Setup Local Development Environment with minikube.\nBrew Installation Packages brew install hyperkit brew install minikube brew install helm brew install httpie brew install stern brew install argocd brew install sops OSX Minikube Test Cluster Hyperkit Setup first minikube hyperkit driver.\nminikube config set driver hyperkit Minikube Addons Configure some addons for the test cluster.\nminikube addons enable dashboard -p test minikube addons enable metrics-server -p test minikube addons enable ingress -p test minikube addons enable registry -p test Start Minikube Now start the minikube test cluster with some memory and cpu settings.\nminikube start --memory 6144 --cpus 4 -p test Install Monitoring Let’s install Prometheus and Grafana with Helm. Add Repository and install it on the monitoring namespace.\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts helm install --namespace monitoring --create-namespace prometheus prometheus-community/kube-prometheus-stack Forward Grafana Search for the Pod.\nkubectl get pod -n monitoring | grep prometheus-grafana prometheus-grafana-bd89cc787-snlk6 2/2 Running 0 9m34s Forward it port http://localhost:3000 log in with the admin username and prom-operator password and you’ll see a lot of ready for user graphs\nkubectl -n monitoring port-forward prometheus-grafana-bd89cc787-snlk6 3000:3000 Install ARGO CD Create a separate namespace argocd to install argo.\nkubectl create namespace argocd kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml Port Forwarding to ARGO Server kubectl port-forward svc/argocd-server -n argocd 8080:443 Change Argo Admin Password The default Password is the Argo Server name.\nkubectl get pod -n argocd | grep argocd-server argocd-server-5bc896856-xvt92 1/1 Running 0 71m Use the Argo CLI to login with user admin and change the password.\nargocd login localhost:8080 argocd account update-password Create App with directory-recurse argocd app create kboot --repo https://github.com/marzelwidmer/argo-demo.git \\ --path manifest \\ --directory-recurse \\ --dest-server https://kubernetes.default.svc \\ --dest-namespace default Synch App Argo will be sync every 5 min. You can force it via AdminUI https://localhost:8080 or with the following command :\nargocd app sync kboot Test Contracts inside K8s kubectl run -i --rm --restart=Never curl-client \\ --image=tutum/curl:alpine \\ --command -- curl -s 'http://contracts/api/persons' -H 'Content-Type: application/json' -w \"\\n\" [{\"firstName\":\"John\"}] pod \"curl-client\" deleted Test Contracts over Ingress You can edit the /etc/hosts file for details please check my other Blog Minikube Ingress Controller\nhttp -j http://test.minikube.me/api/persons HTTP/1.1 200 OK Connection: keep-alive Content-Encoding: gzip Content-Type: application/json Date: Sun, 25 Oct 2020 08:34:33 GMT Matched-Stub-Id: e6546194-eda5-4d86-b644-9694fd421ed6 Server: nginx/1.19.1 Transfer-Encoding: chunked Vary: Accept-Encoding, User-Agent [ { \"firstName\": \"John\" } ] Comming soon… Manage Secrets with SealedSecrets\nSee: https://github.com/bitnami-labs/sealed-secrets\nSealed Secrets Install Sealed Secrets with Helm to manage Secrets. see: https://hub.kubeapps.com/charts/stable/sealed-secrets\nhelm install sealed --namespace kube-system stable/sealed-secrets Install client-side tool into /usr/local/bin/ GOOS=$(go env GOOS) GOARCH=$(go env GOARCH) wget https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.12.4/kubeseal-$GOOS-$GOARCH sudo install -m 755 kubeseal-$GOOS-$GOARCH /usr/local/bin/kubeseal Create a sealed secret file for Redis kubectl create secret generic redis --dry-run=client --from-literal=database-password=verySecurePassword -o yaml | \\ kubeseal \\ --controller-name=sealed-sealed-secrets \\ --controller-namespace=kube-system \\ --format yaml \u003e sealed-redis-secret.yaml Apply the sealed secret kubectl create -f sealed-redis-secret.yaml Get Secret Running kubectl get secret redis -o yaml will show the decrypted secret that was generated from the sealed secret. Both the SealedSecret and generated Secret must have the same name and namespace.\nkubectl get secret redis -o yaml References:\nBlog Minikube Ingress Controller ingress-minikube\n","wordCount":"558","inLanguage":"en","datePublished":"2020-10-25T00:00:00Z","dateModified":"2020-10-25T00:00:00Z","author":{"@type":"Person","name":"Marcel Widmer"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.marcelwidmer.org/blog/2020/2020-10-05-gitops-argo/"},"publisher":{"@type":"Organization","name":"c3smonkey's blog","logo":{"@type":"ImageObject","url":"https://blog.marcelwidmer.org/static/favicon.ico"}}}</script></head><body><nav class=desktop><ul><li><a class=logo href=https://blog.marcelwidmer.org accesskey=h title="Welcome to my blog (Alt + h)"><img src=/static/favicon.ico alt="Welcome to my blog" width=35 height=35></img><h3 style=margin-bottom:0><strong><em>c3smonkey&rsquo;s blog</em></strong></h3></a></li><li class=toggle-container><input type=checkbox id=switch>
<label for=switch><i id=darkIcon data-feather=moon></i>
<i id=lightIcon data-feather=sun></i></label></li></ul><ul class=desktop-navigation><li><a href=/blog title=Blog><i data-feather=pen-tool></i>
<span>Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><i data-feather=search></i>
<span>Search</span></a></li><li><a href=/contact title=Contact><i data-feather=mail></i>
<span>Contact</span></a></li><li><a href=https://github.com/marzelwidmer title=Github><i data-feather=github></i>
<span></span></a></li></ul><ul class=mobile-navigation><li><button id=menuOpen onclick=openMobile() aria-label="Menu closed">
<i data-feather=menu></i></button>
<button id=menuClose onclick=openMobile() aria-label="Menu opened">
<i data-feather=x></i></button></li></ul></nav><aside class=sidebar id=mobileNav style=display:none><nav><ul><li><a href=/blog title=Blog><span><i data-feather=pen-tool></i>
Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><span><i data-feather=search></i>
Search</span></a></li><li><a href=/contact title=Contact><span><i data-feather=mail></i>
Contact</span></a></li><li><a href=https://github.com/marzelwidmer title=Github><span><i data-feather=github></i></span></a></li></ul></nav></aside><main><div class=container><hgroup><div><a href=https://blog.marcelwidmer.org>Home</a>&nbsp;»&nbsp;<a href=https://blog.marcelwidmer.org/blog/>Blog</a></div><h1>GitOps with Argo CD</h1><time datetime='2020-10-25 00:00:00 +0000 UTC'>October 25, 2020</time>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Marcel Widmer<p></p></hgroup><a href=https://blog.marcelwidmer.org/tags/k8s/><kbd>k8s</kbd></a>
<a href=https://blog.marcelwidmer.org/tags/argocd/><kbd>argocd</kbd></a>
<a href=https://blog.marcelwidmer.org/tags/gitops/><kbd>gitops</kbd></a><div class="grid grid-main"><div><div class=post><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on twitter" href="https://twitter.com/intent/tweet/?text=GitOps%20with%20Argo%20CD&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f&hashtags=k8s%2cargocd%2cgitops"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f&title=GitOps%20with%20Argo%20CD&summary=GitOps%20with%20Argo%20CD&source=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f&title=GitOps%20with%20Argo%20CD"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on whatsapp" href="https://api.whatsapp.com/send?text=GitOps%20with%20Argo%20CD%20-%20https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on telegram" href="https://telegram.me/share/url?text=GitOps%20with%20Argo%20CD&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><p><a href=https://argoproj.github.io/argo-cd/ target=_blank rel=noopener>Argo CD</a> is a declarative, GitOps continuous delivery tool for Kubernetes.
Application definitions, configurations, and environments should be declarative and version controlled.
Application deployment and lifecycle management should be automated, auditable, and easy to understand.</p><ul><li><a href=#minikube>Minikube Setup</a><ul><li><a href=#monitoring>Monitoring - Grafana-Prometheus</a></li></ul></li><li><a href=#argoCD>Install Argo CD</a></li><li><a href=#argoCreatApp>Create App on Argo CD</a></li></ul><h1 id=minikube>Minikube Setup<a class=anchor aria-hidden=true href=#minikube>#</a></h1><p>Local Development Environment with minikube.</p><h2 id=brew-installation-packages>Brew Installation Packages<a class=anchor aria-hidden=true href=#brew-installation-packages>#</a></h2><pre tabindex=0><code>brew install hyperkit
brew install minikube
brew install helm
brew install httpie
brew install stern
brew install argocd
brew install sops
</code></pre><h2 id=osx-minikube-test-cluster>OSX Minikube Test Cluster<a class=anchor aria-hidden=true href=#osx-minikube-test-cluster>#</a></h2><h3 id=hyperkit>Hyperkit<a class=anchor aria-hidden=true href=#hyperkit>#</a></h3><p>Setup first minikube hyperkit driver.</p><pre tabindex=0><code>minikube config set driver hyperkit
</code></pre><h3 id=minikube-addons>Minikube Addons<a class=anchor aria-hidden=true href=#minikube-addons>#</a></h3><p>Configure some addons for the test cluster.</p><pre tabindex=0><code>minikube addons enable dashboard -p test
minikube addons enable metrics-server -p test
minikube addons enable ingress -p test
minikube addons enable registry -p test
</code></pre><h3 id=start-minikube>Start Minikube<a class=anchor aria-hidden=true href=#start-minikube>#</a></h3><p>Now start the minikube test cluster with some memory and cpu settings.</p><pre tabindex=0><code>minikube start --memory 6144 --cpus 4 -p test
</code></pre><h2 id=monitoring>Install Monitoring <a class=anchor aria-hidden=true href=#monitoring>#</a></h2><p>Let&rsquo;s install Prometheus and Grafana with Helm. Add Repository and install it on the <code>monitoring</code> namespace.</p><pre tabindex=0><code>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm install --namespace monitoring --create-namespace prometheus prometheus-community/kube-prometheus-stack
</code></pre><h3 id=forward-grafana>Forward Grafana<a class=anchor aria-hidden=true href=#forward-grafana>#</a></h3><p>Search for the Pod.</p><pre tabindex=0><code>kubectl get pod -n monitoring  | grep prometheus-grafana
prometheus-grafana-bd89cc787-snlk6                       2/2     Running   0          9m34s
</code></pre><p>Forward it port <code>http://localhost:3000</code> log in with the <code>admin</code> username and <code>prom-operator</code> password and you’ll see a lot of ready for user graphs</p><pre tabindex=0><code>kubectl -n monitoring port-forward prometheus-grafana-bd89cc787-snlk6 3000:3000
</code></pre><h1 id=argoCD>Install ARGO CD<a class=anchor aria-hidden=true href=#argoCD>#</a></h1><p>Create a separate namespace <code>argocd</code> to install argo.</p><pre tabindex=0><code>kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
</code></pre><h2 id=port-forwarding-to-argo-server>Port Forwarding to ARGO Server<a class=anchor aria-hidden=true href=#port-forwarding-to-argo-server>#</a></h2><pre tabindex=0><code>kubectl port-forward svc/argocd-server -n argocd 8080:443
</code></pre><h2 id=change-argo-admin-password>Change Argo Admin Password<a class=anchor aria-hidden=true href=#change-argo-admin-password>#</a></h2><p>The default Password is the Argo Server name.</p><pre tabindex=0><code>kubectl get pod -n argocd | grep argocd-server
argocd-server-5bc896856-xvt92                    1/1     Running   0          71m
</code></pre><p>Use the Argo CLI to login with user <code>admin</code> and change the password.</p><pre tabindex=0><code>argocd login localhost:8080
argocd account update-password
</code></pre><p><img src=/static/gitops-argo/argo.png alt=Argo></p><h1 id=argoCreatApp>Create App with directory-recurse<a class=anchor aria-hidden=true href=#argoCreatApp>#</a></h1><pre tabindex=0><code>argocd app create kboot --repo https://github.com/marzelwidmer/argo-demo.git \
    --path manifest \
    --directory-recurse \
    --dest-server https://kubernetes.default.svc \
    --dest-namespace default
</code></pre><h2 id=synch-app>Synch App<a class=anchor aria-hidden=true href=#synch-app>#</a></h2><p>Argo will be sync every 5 min. You can force it via AdminUI <code>https://localhost:8080</code> or with the following command :</p><pre tabindex=0><code>argocd app sync kboot
</code></pre><h2 id=test-contracts-inside-k8s>Test Contracts inside K8s<a class=anchor aria-hidden=true href=#test-contracts-inside-k8s>#</a></h2><pre tabindex=0><code>kubectl run -i --rm --restart=Never curl-client \
    --image=tutum/curl:alpine \
    --command -- curl -s &#39;http://contracts/api/persons&#39; -H &#39;Content-Type: application/json&#39; -w &#34;\n&#34;

[{&#34;firstName&#34;:&#34;John&#34;}]
pod &#34;curl-client&#34; deleted
</code></pre><h2 id=test-contracts-over-ingress>Test Contracts over Ingress<a class=anchor aria-hidden=true href=#test-contracts-over-ingress>#</a></h2><p>You can edit the <code>/etc/hosts</code> file for details please check my other Blog <a href=https://blog.marcelwidmer.org/posts/2020-05-01-minikube-ingress-controller target=_blank rel=noopener>Minikube Ingress Controller</a></p><pre tabindex=0><code>http -j http://test.minikube.me/api/persons

HTTP/1.1 200 OK
Connection: keep-alive
Content-Encoding: gzip
Content-Type: application/json
Date: Sun, 25 Oct 2020 08:34:33 GMT
Matched-Stub-Id: e6546194-eda5-4d86-b644-9694fd421ed6
Server: nginx/1.19.1
Transfer-Encoding: chunked
Vary: Accept-Encoding, User-Agent

[
    {
        &#34;firstName&#34;: &#34;John&#34;
    }
]
</code></pre><h1 id=comming-soon>Comming soon&mldr;<a class=anchor aria-hidden=true href=#comming-soon>#</a></h1><p>Manage Secrets with <code>SealedSecrets</code></p><p>See:
<a href=https://github.com/bitnami-labs/sealed-secrets target=_blank rel=noopener>https://github.com/bitnami-labs/sealed-secrets</a></p><h2 id=sealed-secrets>Sealed Secrets<a class=anchor aria-hidden=true href=#sealed-secrets>#</a></h2><p>Install Sealed Secrets with Helm to manage Secrets.
see: <a href=https://hub.kubeapps.com/charts/stable/sealed-secrets target=_blank rel=noopener>https://hub.kubeapps.com/charts/stable/sealed-secrets</a></p><pre tabindex=0><code>helm install sealed --namespace kube-system stable/sealed-secrets
</code></pre><h3 id=install-client-side-tool-into-usrlocalbin>Install client-side tool into /usr/local/bin/<a class=anchor aria-hidden=true href=#install-client-side-tool-into-usrlocalbin>#</a></h3><pre tabindex=0><code>GOOS=$(go env GOOS)
GOARCH=$(go env GOARCH)
wget https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.12.4/kubeseal-$GOOS-$GOARCH
sudo install -m 755 kubeseal-$GOOS-$GOARCH /usr/local/bin/kubeseal
</code></pre><h3 id=create-a-sealed-secret-file-for-redis>Create a sealed secret file for Redis<a class=anchor aria-hidden=true href=#create-a-sealed-secret-file-for-redis>#</a></h3><pre tabindex=0><code>kubectl create secret generic redis --dry-run=client --from-literal=database-password=verySecurePassword -o yaml | \
 kubeseal \
 --controller-name=sealed-sealed-secrets \
 --controller-namespace=kube-system \
 --format yaml &gt; sealed-redis-secret.yaml
</code></pre><h3 id=apply-the-sealed-secret>Apply the sealed secret<a class=anchor aria-hidden=true href=#apply-the-sealed-secret>#</a></h3><pre tabindex=0><code>kubectl create -f sealed-redis-secret.yaml
</code></pre><h3 id=get-secret>Get Secret<a class=anchor aria-hidden=true href=#get-secret>#</a></h3><p>Running <code>kubectl get secret redis -o yaml</code> will show the decrypted secret that was generated from the sealed secret.
Both the SealedSecret and generated Secret must have the same name and namespace.</p><pre tabindex=0><code>kubectl get secret redis -o yaml
</code></pre><p><em>References:</em></p><blockquote><p><a href=https://blog.marcelwidmer.org/posts/2020-05-01-minikube-ingress-controller/ target=_blank rel=noopener>Blog Minikube Ingress Controller</a>
<a href=https://kubernetes.io/docs/tasks/access-application-cluster/ingress-minikube/ target=_blank rel=noopener>ingress-minikube</a></p></blockquote></div><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on twitter" href="https://twitter.com/intent/tweet/?text=GitOps%20with%20Argo%20CD&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f&hashtags=k8s%2cargocd%2cgitops"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f&title=GitOps%20with%20Argo%20CD&summary=GitOps%20with%20Argo%20CD&source=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f&title=GitOps%20with%20Argo%20CD"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on whatsapp" href="https://api.whatsapp.com/send?text=GitOps%20with%20Argo%20CD%20-%20https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GitOps with Argo CD on telegram" href="https://telegram.me/share/url?text=GitOps%20with%20Argo%20CD&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-10-05-gitops-argo%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></div><aside><article><h3>See Also</h3><a href=/blog/2020/2020-10-05-harbor/><hgroup><h4><i>Harbor</i></h4><p><time datetime='2020-10-25 00:00:00 +0000 UTC'>October 25, 2020</time>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2020/2020-10-04-hazelcast-k8s/><hgroup><h4><i>Kubernetes Hazelcast Distributed Caching</i></h4><p><time datetime='2020-10-04 00:00:00 +0000 UTC'>October 4, 2020</time>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2020/2020-05-01-minikube-ingress-controller/><hgroup><h4><i>Kubernetes Ingress with Ngnix Ingress Controller</i></h4><p><time datetime='2020-05-01 00:00:00 +0000 UTC'>May 1, 2020</time>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2019/2019-10-22-axon/><hgroup><h4><i>AxonIQ</i></h4><p><time datetime='2019-09-18 00:00:00 +0000 UTC'>September 18, 2019</time>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2019/2019-08-28-multiple-project-promoting/><hgroup><h4><i>Promoting Applications Across Environments</i></h4><p><time datetime='2019-09-18 00:00:00 +0000 UTC'>September 18, 2019</time>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a></article></aside></div></div></main><footer class=text-center><span>&copy; 2022 <a href=https://blog.marcelwidmer.org>c3smonkey's blog</a></span><div><a href=https://blog.marcelwidmer.org/legal/privacy>Privacy Policy</a>
<span>&</span>
<a href=https://blog.marcelwidmer.org/legal/terms-and-conditions>Terms and Conditions</a></div></footer><article class=hidden id=cookie-banner><div><span></span></div><footer><a role=button id=consent-cookies>Close</a>
<a role=button class=secondary href=/></a></footer></article><script async src=https://blog.marcelwidmer.org/js/cookie.min.js layout=container></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("kbd");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=https://blog.marcelwidmer.org/plugins/js/feather.min.js layout=container></script>
<script src=https://blog.marcelwidmer.org/js/script.min.js layout=container></script></body></html>