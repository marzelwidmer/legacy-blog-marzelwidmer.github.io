<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Reactive Spring Boot with Resilience4j CircuitBreaker | c3smonkey's blog</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Create Project Let&rsquo;s create a Sample Application with Kotlin and Reactive Spring Boot with the spring inializr Rest Endpoint. We will take the latest and greates Spring Boot version 2.3.0.M4 and language kotlin with the following dependencies:
actuator webflux cloud-resilience4j http https://start.spring.io/starter.tgz \ dependencies==actuator,webflux,cloud-resilience4j \ description==&#34;Demo project Kotlin Spring Boot with Resilience4j&#34; \ applicationName==Resilience4jApplication \ name==kboot-resilience4j \ groupId==ch.keepcalm \ artifactId==kboot-resilience4j \ packageName==ch.keepcalm.demo \ javaVersion==11 \ language==kotlin \ baseDir==kboot-resilience4j| tar -xzvf - Add Customer Banner"><meta name=author content="Marcel Widmer"><link rel=canonical href=https://blog.marcelwidmer.org/blog/2020/2020-04-18-resilience4j-circuitbreaker/><link rel=stylesheet href=https://blog.marcelwidmer.org/sass/main.min.css><link rel=stylesheet href=https://blog.marcelwidmer.org/sass/nav.min.css><link rel=stylesheet href=https://blog.marcelwidmer.org/plugins/css/pico.min.css><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=apple-touch-icon href=https://blog.marcelwidmer.org/static/favicon.ico><link rel=mask-icon href=https://blog.marcelwidmer.org/static/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.104.0"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.marcelwidmer.org/static"><meta name=twitter:title content="Reactive Spring Boot with Resilience4j CircuitBreaker"><meta name=twitter:description content="Create Project Let&rsquo;s create a Sample Application with Kotlin and Reactive Spring Boot with the spring inializr Rest Endpoint. We will take the latest and greates Spring Boot version 2.3.0.M4 and language kotlin with the following dependencies:
actuator webflux cloud-resilience4j http https://start.spring.io/starter.tgz \ dependencies==actuator,webflux,cloud-resilience4j \ description==&#34;Demo project Kotlin Spring Boot with Resilience4j&#34; \ applicationName==Resilience4jApplication \ name==kboot-resilience4j \ groupId==ch.keepcalm \ artifactId==kboot-resilience4j \ packageName==ch.keepcalm.demo \ javaVersion==11 \ language==kotlin \ baseDir==kboot-resilience4j| tar -xzvf - Add Customer Banner"><meta property="og:title" content="Reactive Spring Boot with Resilience4j CircuitBreaker"><meta property="og:description" content="Create Project Let&rsquo;s create a Sample Application with Kotlin and Reactive Spring Boot with the spring inializr Rest Endpoint. We will take the latest and greates Spring Boot version 2.3.0.M4 and language kotlin with the following dependencies:
actuator webflux cloud-resilience4j http https://start.spring.io/starter.tgz \ dependencies==actuator,webflux,cloud-resilience4j \ description==&#34;Demo project Kotlin Spring Boot with Resilience4j&#34; \ applicationName==Resilience4jApplication \ name==kboot-resilience4j \ groupId==ch.keepcalm \ artifactId==kboot-resilience4j \ packageName==ch.keepcalm.demo \ javaVersion==11 \ language==kotlin \ baseDir==kboot-resilience4j| tar -xzvf - Add Customer Banner"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.marcelwidmer.org/blog/2020/2020-04-18-resilience4j-circuitbreaker/"><meta property="og:image" content="https://blog.marcelwidmer.org/static"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-04-18T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-18T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.marcelwidmer.org/static"><meta name=twitter:title content="Reactive Spring Boot with Resilience4j CircuitBreaker"><meta name=twitter:description content="Create Project Let&rsquo;s create a Sample Application with Kotlin and Reactive Spring Boot with the spring inializr Rest Endpoint. We will take the latest and greates Spring Boot version 2.3.0.M4 and language kotlin with the following dependencies:
actuator webflux cloud-resilience4j http https://start.spring.io/starter.tgz \ dependencies==actuator,webflux,cloud-resilience4j \ description==&#34;Demo project Kotlin Spring Boot with Resilience4j&#34; \ applicationName==Resilience4jApplication \ name==kboot-resilience4j \ groupId==ch.keepcalm \ artifactId==kboot-resilience4j \ packageName==ch.keepcalm.demo \ javaVersion==11 \ language==kotlin \ baseDir==kboot-resilience4j| tar -xzvf - Add Customer Banner"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blog","item":"https://blog.marcelwidmer.org/blog/"},{"@type":"ListItem","position":3,"name":"Reactive Spring Boot with Resilience4j CircuitBreaker","item":"https://blog.marcelwidmer.org/blog/2020/2020-04-18-resilience4j-circuitbreaker/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Reactive Spring Boot with Resilience4j CircuitBreaker","name":"Reactive Spring Boot with Resilience4j CircuitBreaker","description":"Create Project Let\u0026rsquo;s create a Sample Application with Kotlin and Reactive Spring Boot with the spring inializr Rest Endpoint. We will take the latest and greates Spring Boot version 2.3.0.M4 and language kotlin with the following dependencies:\nactuator webflux cloud-resilience4j http https://start.spring.io/starter.tgz \\ dependencies==actuator,webflux,cloud-resilience4j \\ description==\u0026#34;Demo project Kotlin Spring Boot with Resilience4j\u0026#34; \\ applicationName==Resilience4jApplication \\ name==kboot-resilience4j \\ groupId==ch.keepcalm \\ artifactId==kboot-resilience4j \\ packageName==ch.keepcalm.demo \\ javaVersion==11 \\ language==kotlin \\ baseDir==kboot-resilience4j| tar -xzvf - Add Customer Banner","keywords":["Spring Boot"],"articleBody":"Create Project Let’s create a Sample Application with Kotlin and Reactive Spring Boot with the spring inializr Rest Endpoint. We will take the latest and greates Spring Boot version 2.3.0.M4 and language kotlin with the following dependencies:\nactuator webflux cloud-resilience4j http https://start.spring.io/starter.tgz \\ dependencies==actuator,webflux,cloud-resilience4j \\ description==\"Demo project Kotlin Spring Boot with Resilience4j\" \\ applicationName==Resilience4jApplication \\ name==kboot-resilience4j \\ groupId==ch.keepcalm \\ artifactId==kboot-resilience4j \\ packageName==ch.keepcalm.demo \\ javaVersion==11 \\ language==kotlin \\ baseDir==kboot-resilience4j| tar -xzvf - Add Customer Banner\nhttp https://raw.githubusercontent.com/marzelwidmer/marzelwidmer.github.io/master/img/banner.txt \\ \u003e kboot-resilience4j/src/main/resources/banner.txt Configure spring.applicatin.name\necho \"spring: application: name: kboot-resilience4j\" | \u003e kboot-resilience4j/src/main/resources/application.yaml Remove application.properties\nrm kboot-resilience4j/src/main/resources/application.properties See also my other post Spring Initializr and HTTPie\nDomain Model Let’s start with the Movie domain class with the following properties.\nname year description data class Movie(val id: String? = UUID.randomUUID().toString(), val name: String, val year: Year, val description: String) Service Now we create the service class MovieService who hold some hard coded movies in a list. The amazing functions:\nGet all Movies Get a random list of Movies Get a Movie by his name Get a Movie by his ID @Service class MovieService { private val movies = listOf( Movie(name = \"Matrix\", year = Year.of(1999), description = \"A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.\"), Movie(name = \"The Godfather\", year = Year.of(1972), description = \"The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.\"), Movie(name = \"Casablanca\", year = Year.of(1942), description = \"A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.\"), Movie(name = \"Rocky\", year = Year.of(1976), description = \"A small-time boxer gets a supremely rare chance to fight a heavy-weight champion in a bout in which he strives to go the distance for his self-respect.\") ) fun randomMovie() = Mono.just(movies[kotlin.random.Random.nextInt(movies.size)]) fun movies() = Flux.just(movies) fun movieById(id: String) = Mono.just(movies.first { it.id == id }) fun movieByName(name: String?): Mono { name?.map { movies.firstOrNull() { it.name.toLowerCase() == name.toLowerCase() }?.let { return Mono.just(it) } }.isNullOrEmpty().apply { return Mono.error(IllegalArgumentException(\"Movie was not found.\")) } } } Rest API I think now is time to create a REST API /movies/random with the Reactive router Kotlin DSL. A easy way to create a WebFlux.fn RouterFunction Because we have more then one endpoint under /movies we use the \"/movies\".nest router function.\nWe use also our service MovieService so we need a Bean Reference to it.\nval service = ref()\n💡: Take care of the order in the Route definiton “/” have to be at latest position.\nfun main(args: Array) { runApplication(*args) { addInitializers( beans { bean { router { \"movies\".nest { val service = ref() //http :8080/movies/random GET(\"/random\") { ok().body(service.randomMovie()) } //http :8080/movies/ name==\"Rocky\" -vv queryParam(\"name\", { true }) { ok().body(service.movieByName(name = it.queryParam(\"name\").get())) } //http :8080/movies/c7f399bc-ff4c-4a2f-bddf-d92d53a96df2 GET(\"/{id}\") { ok().body(service.movieById(id = it.pathVariable(\"id\"))) } //http :8080/movies/random GET(\"/\") { ok().body(service.movies()) } } } } } ) } } Test Rest API No is time to make some calls from the terminal with the HTTPie or in a Browser. First start the application e.g. with mvn spring-boot:run.\nThen lets call our amazing endpoints with the HTTPie or Browser.\nGet all Movies http://localhost:8080/movies\nhttp :8080/movies/ HTTP/1.1 200 OK Content-Type: application/json transfer-encoding: chunked [ [ { \"description\": \"A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.\", \"id\": \"c7f399bc-ff4c-4a2f-bddf-d92d53a96df2\", \"name\": \"Matrix\", \"year\": \"1999\" }, { \"description\": \"The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.\", \"id\": \"0c7a74fc-b735-41a3-a383-72b9dad7d608\", \"name\": \"The Godfather\", \"year\": \"1972\" }, { \"description\": \"A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.\", \"id\": \"15a9e15d-4a5e-4b8a-a7c5-d34b0d5d0879\", \"name\": \"Casablanca\", \"year\": \"1942\" }, { \"description\": \"A small-time boxer gets a supremely rare chance to fight a heavy-weight champion in a bout in which he strives to go the distance for his self-respect.\", \"id\": \"f6fb4a62-6d84-434e-8e2c-70e4c1e7ab2c\", \"name\": \"Rocky\", \"year\": \"1976\" } ] ] Get a random list of Movies http://localhost:8080/movies/random\nhttp :8080/movies/random HTTP/1.1 200 OK Content-Length: 240 Content-Type: application/json { \"description\": \"A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.\", \"id\": \"5dd310b8-8d51-4a1e-a20c-790fec00029f\", \"name\": \"Casablanca\", \"year\": \"1942\" } Get a Movie by his name http://localhost:8080/movies/?name=Rocky\nhttp :8080/movies name==\"Rocky\" -v GET /movies?name=Rocky HTTP/1.1 Accept: */* Accept-Encoding: gzip, deflate Connection: keep-alive Host: localhost:8080 User-Agent: HTTPie/2.0.0 HTTP/1.1 200 OK Content-Length: 242 Content-Type: application/json { \"description\": \"A small-time boxer gets a supremely rare chance to fight a heavy-weight champion in a bout in which he strives to go the distance for his self-respect.\", \"id\": \"5cae75c6-d18a-495b-a80f-60bdd0763eb1\", \"name\": \"Rocky\", \"year\": \"1976\" } Get a Movie by his ID http://localhost:8080/movies/5dd310b8-8d51-4a1e-a20c-790fec00029f\nhttp :8080/movies/5dd310b8-8d51-4a1e-a20c-790fec00029f HTTP/1.1 200 OK Content-Length: 240 Content-Type: application/json { \"description\": \"A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.\", \"id\": \"5dd310b8-8d51-4a1e-a20c-790fec00029f\", \"name\": \"Casablanca\", \"year\": \"1942\" } Search for a not existing Movie Now let’s also search for http://localhost:8080/movies/?name=Creed is also a great movie but this one is not yet in our MovieService included we will get the following exception.\nhttp :8080/movies name==\"Creed\" -v GET /movies?name=Creed HTTP/1.1 Accept: */* Accept-Encoding: gzip, deflate Connection: keep-alive Host: localhost:8080 User-Agent: HTTPie/2.0.0 HTTP/1.1 500 Internal Server Error Content-Length: 165 Content-Type: application/json { \"error\": \"Internal Server Error\", \"message\": \"Movie was not found.\", \"path\": \"/movies\", \"requestId\": \"61569a89-3\", \"status\": 500, \"timestamp\": \"2020-04-19T21:13:10.403+00:00\" } Configure CircuitBreaker 😎 Cool stuff 😎 let’s implement the CircuitBreaker with Resilinece4j. Let’s configure the ReactiveCircuitBreaker Bean from ReactiveResilience4JCircuitBreakerFactory with a name movie-service.\nbean { ReactiveResilience4JCircuitBreakerFactory() .create(\"movie-service\") } to be continued .. The example source code can be found here GitHub\n💡 Logger Configuration: logging.pattern.console: “%clr(%d{yyyy-MM-dd E HH:mm:ss.SSS}){blue} %clr(%-40.40logger{0}){magenta} - %clr(%m){green}%n”\nReferences:\nResilience4j docs\n","wordCount":"971","inLanguage":"en","datePublished":"2020-04-18T00:00:00Z","dateModified":"2020-04-18T00:00:00Z","author":{"@type":"Person","name":"Marcel Widmer"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.marcelwidmer.org/blog/2020/2020-04-18-resilience4j-circuitbreaker/"},"publisher":{"@type":"Organization","name":"c3smonkey's blog","logo":{"@type":"ImageObject","url":"https://blog.marcelwidmer.org/static/favicon.ico"}}}</script></head><body><nav class=desktop><ul><li><a class=logo href=https://blog.marcelwidmer.org accesskey=h title="Welcome to my blog (Alt + h)"><img src=/static/favicon.ico alt="Welcome to my blog" width=35 height=35></img><h3 style=margin-bottom:0><strong><em>c3smonkey&rsquo;s blog</em></strong></h3></a></li><li class=toggle-container><input type=checkbox id=switch>
<label for=switch><i id=darkIcon data-feather=moon></i>
<i id=lightIcon data-feather=sun></i></label></li></ul><ul class=desktop-navigation><li><a href=/blog title=Blog><i data-feather=pen-tool></i>
<span>Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><i data-feather=search></i>
<span>Search</span></a></li><li><a href=/contact title=Contact><i data-feather=mail></i>
<span>Contact</span></a></li><li><a href=https://github.com/marzelwidmer title=Github><i data-feather=github></i>
<span></span></a></li></ul><ul class=mobile-navigation><li><button id=menuOpen onclick=openMobile() aria-label="Menu closed">
<i data-feather=menu></i></button>
<button id=menuClose onclick=openMobile() aria-label="Menu opened">
<i data-feather=x></i></button></li></ul></nav><aside class=sidebar id=mobileNav style=display:none><nav><ul><li><a href=/blog title=Blog><span><i data-feather=pen-tool></i>
Blog</span></a></li><li><a href=/search title="Search (Alt + /)" accesskey=/><span><i data-feather=search></i>
Search</span></a></li><li><a href=/contact title=Contact><span><i data-feather=mail></i>
Contact</span></a></li><li><a href=https://github.com/marzelwidmer title=Github><span><i data-feather=github></i></span></a></li></ul></nav></aside><main><div class=container><hgroup><div><a href=https://blog.marcelwidmer.org>Home</a>&nbsp;»&nbsp;<a href=https://blog.marcelwidmer.org/blog/>Blog</a></div><h1>Reactive Spring Boot with Resilience4j CircuitBreaker</h1><time datetime='2020-04-18 00:00:00 +0000 UTC'>April 18, 2020</time>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Marcel Widmer<p></p></hgroup><a href=https://blog.marcelwidmer.org/tags/spring-boot/><kbd>Spring Boot</kbd></a><div class="grid grid-main"><div><div class=post><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on twitter" href="https://twitter.com/intent/tweet/?text=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f&hashtags=SpringBoot"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f&title=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker&summary=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker&source=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f&title=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on whatsapp" href="https://api.whatsapp.com/send?text=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker%20-%20https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on telegram" href="https://telegram.me/share/url?text=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><h2 id=create-project>Create Project<a class=anchor aria-hidden=true href=#create-project>#</a></h2><p>Let&rsquo;s create a Sample Application with Kotlin and Reactive Spring Boot with the <a href=https://start.spring.io/ target=_blank rel=noopener>spring inializr</a> Rest Endpoint. We will take the latest and greates Spring Boot version <code>2.3.0.M4</code> and language <code>kotlin</code> with the following dependencies:</p><ul><li>actuator</li><li>webflux</li><li>cloud-resilience4j</li></ul><pre tabindex=0><code>http https://start.spring.io/starter.tgz \
    dependencies==actuator,webflux,cloud-resilience4j \
    description==&#34;Demo project Kotlin Spring Boot with Resilience4j&#34; \
    applicationName==Resilience4jApplication \
    name==kboot-resilience4j \
    groupId==ch.keepcalm \
    artifactId==kboot-resilience4j \
    packageName==ch.keepcalm.demo \
    javaVersion==11 \
    language==kotlin \
    baseDir==kboot-resilience4j| tar -xzvf -
</code></pre><p>Add Customer Banner</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>http https://raw.githubusercontent.com/marzelwidmer/marzelwidmer.github.io/master/img/banner.txt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    &gt; kboot-resilience4j/src/main/resources/banner.txt
</span></span></code></pre></div><p>Configure <code>spring.applicatin.name</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;spring:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  application:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    name: kboot-resilience4j&#34;</span> | &gt; kboot-resilience4j/src/main/resources/application.yaml
</span></span></code></pre></div><p>Remove <code>application.properties</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rm kboot-resilience4j/src/main/resources/application.properties
</span></span></code></pre></div><p>See also my other post <a href=https://blog.marcelwidmer.org/spring-initializr/ target=_blank rel=noopener>Spring Initializr and HTTPie</a></p><h2 id=domain-model>Domain Model<a class=anchor aria-hidden=true href=#domain-model>#</a></h2><p>Let&rsquo;s start with the <code>Movie</code> domain class with the following properties.</p><ul><li>name</li><li>year</li><li>description</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Movie</span>(<span style=color:#66d9ef>val</span> id: String? = UUID.randomUUID().toString(), <span style=color:#66d9ef>val</span> name: String, <span style=color:#66d9ef>val</span> year: Year, <span style=color:#66d9ef>val</span> description: String)
</span></span></code></pre></div><h2 id=service>Service<a class=anchor aria-hidden=true href=#service>#</a></h2><p>Now we create the service class <code>MovieService</code> who hold some hard coded movies in a list.
The amazing functions:</p><ul><li>Get all Movies</li><li>Get a random list of Movies</li><li>Get a Movie by his name</li><li>Get a Movie by his ID</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MovieService</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> movies = listOf(
</span></span><span style=display:flex><span>        Movie(name = <span style=color:#e6db74>&#34;Matrix&#34;</span>,
</span></span><span style=display:flex><span>            year = Year.of(<span style=color:#ae81ff>1999</span>),
</span></span><span style=display:flex><span>            description = <span style=color:#e6db74>&#34;A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.&#34;</span>),
</span></span><span style=display:flex><span>        Movie(name = <span style=color:#e6db74>&#34;The Godfather&#34;</span>,
</span></span><span style=display:flex><span>            year = Year.of(<span style=color:#ae81ff>1972</span>),
</span></span><span style=display:flex><span>            description = <span style=color:#e6db74>&#34;The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.&#34;</span>),
</span></span><span style=display:flex><span>        Movie(name = <span style=color:#e6db74>&#34;Casablanca&#34;</span>,
</span></span><span style=display:flex><span>            year = Year.of(<span style=color:#ae81ff>1942</span>),
</span></span><span style=display:flex><span>            description = <span style=color:#e6db74>&#34;A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.&#34;</span>),
</span></span><span style=display:flex><span>        Movie(name = <span style=color:#e6db74>&#34;Rocky&#34;</span>,
</span></span><span style=display:flex><span>            year = Year.of(<span style=color:#ae81ff>1976</span>),
</span></span><span style=display:flex><span>            description = <span style=color:#e6db74>&#34;A small-time boxer gets a supremely rare chance to fight a heavy-weight champion in a bout in which he strives to go the distance for his self-respect.&#34;</span>)
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>randomMovie</span>() = Mono.just(movies[kotlin.random.Random.nextInt(movies.size)])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>movies</span>() = Flux.just(movies)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>movieById</span>(id: String) = Mono.just(movies.first { <span style=color:#66d9ef>it</span>.id <span style=color:#f92672>==</span> id })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>movieByName</span>(name: String?): Mono&lt;Movie&gt; {
</span></span><span style=display:flex><span>            name<span style=color:#f92672>?.</span>map {
</span></span><span style=display:flex><span>                movies.firstOrNull() { <span style=color:#66d9ef>it</span>.name.toLowerCase() <span style=color:#f92672>==</span> name.toLowerCase() }<span style=color:#f92672>?.</span>let {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> Mono.just(<span style=color:#66d9ef>it</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }.isNullOrEmpty().apply {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> Mono.error(IllegalArgumentException(<span style=color:#e6db74>&#34;Movie was not found.&#34;</span>))
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=rest-api>Rest API<a class=anchor aria-hidden=true href=#rest-api>#</a></h2><p>I think now is time to create a REST API <code>/movies/random</code> with the <a href=https://docs.spring.io/spring-framework/docs/current/kdoc-api/spring-framework/org.springframework.web.reactive.function.server/-router-function-dsl/index.html target=_blank rel=noopener>Reactive router Kotlin DSL</a>.
A easy way to create a <code>WebFlux.fn</code> <a href=https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/reactive/function/server/RouterFunctions.html target=_blank rel=noopener>RouterFunction</a>
Because we have more then one endpoint under <code>/movies</code> we use the <code>"/movies".nest</code> router function.</p><p>We use also our service <code>MovieService</code> so we need a <a href=https://docs.spring.io/spring/docs/current/kdoc-api/spring-framework/org.springframework.context.support/-bean-definition-dsl/-bean-supplier-context/ref.html target=_blank rel=noopener>Bean Reference</a> to it.</p><p><code>val service = ref&lt;MovieService>()</code></p><blockquote><p>💡: Take care of the order in the Route definiton &ldquo;/&rdquo; have to be at latest position.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>main</span>(args: Array&lt;String&gt;) {
</span></span><span style=display:flex><span>    runApplication&lt;Resilience4jApplication&gt;(*args) {
</span></span><span style=display:flex><span>        addInitializers(
</span></span><span style=display:flex><span>            beans {
</span></span><span style=display:flex><span>                bean {
</span></span><span style=display:flex><span>                    router {
</span></span><span style=display:flex><span>                         <span style=color:#e6db74>&#34;movies&#34;</span>.nest {
</span></span><span style=display:flex><span>                             <span style=color:#66d9ef>val</span> service = ref&lt;MovieService&gt;()
</span></span><span style=display:flex><span>                             <span style=color:#75715e>//http :8080/movies/random
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                             GET(<span style=color:#e6db74>&#34;/random&#34;</span>) {
</span></span><span style=display:flex><span>                                 ok().body(service.randomMovie())
</span></span><span style=display:flex><span>                             }
</span></span><span style=display:flex><span>                             <span style=color:#75715e>//http :8080/movies/ name==&#34;Rocky&#34; -vv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                             queryParam(<span style=color:#e6db74>&#34;name&#34;</span>, { <span style=color:#66d9ef>true</span> }) {
</span></span><span style=display:flex><span>                                 ok().body(service.movieByName(name = <span style=color:#66d9ef>it</span>.queryParam(<span style=color:#e6db74>&#34;name&#34;</span>).<span style=color:#66d9ef>get</span>()))
</span></span><span style=display:flex><span>                             }
</span></span><span style=display:flex><span>                             <span style=color:#75715e>//http :8080/movies/c7f399bc-ff4c-4a2f-bddf-d92d53a96df2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                             GET(<span style=color:#e6db74>&#34;/{id}&#34;</span>) {
</span></span><span style=display:flex><span>                                 ok().body(service.movieById(id = <span style=color:#66d9ef>it</span>.pathVariable(<span style=color:#e6db74>&#34;id&#34;</span>)))
</span></span><span style=display:flex><span>                             }
</span></span><span style=display:flex><span>                             <span style=color:#75715e>//http :8080/movies/random
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                             GET(<span style=color:#e6db74>&#34;/&#34;</span>) {
</span></span><span style=display:flex><span>                                 ok().body(service.movies())
</span></span><span style=display:flex><span>                             }
</span></span><span style=display:flex><span>                         }
</span></span><span style=display:flex><span>                     }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=test-rest-api>Test Rest API<a class=anchor aria-hidden=true href=#test-rest-api>#</a></h2><p>No is time to make some calls from the terminal with the <code>HTTPie</code> or in a Browser.
First start the application e.g. with <code>mvn spring-boot:run</code>.</p><p>Then lets call our amazing endpoints with the <code>HTTPie</code> or Browser.</p><h3 id=get-all-movies>Get all Movies<a class=anchor aria-hidden=true href=#get-all-movies>#</a></h3><p><a href=http://localhost:8080/movies target=_blank rel=noopener>http://localhost:8080/movies</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>http :8080/movies/
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Content-Type: application/json
</span></span><span style=display:flex><span>transfer-encoding: chunked
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;A computer hacker learns from mysterious rebels about the true nature of his reality and his role in the war against its controllers.&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;c7f399bc-ff4c-4a2f-bddf-d92d53a96df2&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Matrix&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;year&#34;</span>: <span style=color:#e6db74>&#34;1999&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;The aging patriarch of an organized crime dynasty transfers control of his clandestine empire to his reluctant son.&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;0c7a74fc-b735-41a3-a383-72b9dad7d608&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;The Godfather&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;year&#34;</span>: <span style=color:#e6db74>&#34;1972&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;15a9e15d-4a5e-4b8a-a7c5-d34b0d5d0879&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Casablanca&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;year&#34;</span>: <span style=color:#e6db74>&#34;1942&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;A small-time boxer gets a supremely rare chance to fight a heavy-weight champion in a bout in which he strives to go the distance for his self-respect.&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;f6fb4a62-6d84-434e-8e2c-70e4c1e7ab2c&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Rocky&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;year&#34;</span>: <span style=color:#e6db74>&#34;1976&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span></code></pre></div><h3 id=get-a-random-list-of-movies>Get a random list of Movies<a class=anchor aria-hidden=true href=#get-a-random-list-of-movies>#</a></h3><p><a href=http://localhost:8080/movies/random target=_blank rel=noopener>http://localhost:8080/movies/random</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> http :8080/movies/random
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>240</span>
</span></span><span style=display:flex><span>Content-Type: application/json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;5dd310b8-8d51-4a1e-a20c-790fec00029f&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Casablanca&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;year&#34;</span>: <span style=color:#e6db74>&#34;1942&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=get-a-movie-by-his-name>Get a Movie by his name<a class=anchor aria-hidden=true href=#get-a-movie-by-his-name>#</a></h3><p><a href="http://localhost:8080/movies/?name=Rocky" target=_blank rel=noopener>http://localhost:8080/movies/?name=Rocky</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>http :8080/movies name<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;Rocky&#34;</span> -v
</span></span><span style=display:flex><span>GET /movies?name<span style=color:#f92672>=</span>Rocky HTTP/1.1
</span></span><span style=display:flex><span>Accept: */*
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Host: localhost:8080
</span></span><span style=display:flex><span>User-Agent: HTTPie/2.0.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>242</span>
</span></span><span style=display:flex><span>Content-Type: application/json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;A small-time boxer gets a supremely rare chance to fight a heavy-weight champion in a bout in which he strives to go the distance for his self-respect.&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;5cae75c6-d18a-495b-a80f-60bdd0763eb1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Rocky&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;year&#34;</span>: <span style=color:#e6db74>&#34;1976&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=get-a-movie-by-his-id>Get a Movie by his ID<a class=anchor aria-hidden=true href=#get-a-movie-by-his-id>#</a></h3><p><a href=http://localhost:8080/movies/5dd310b8-8d51-4a1e-a20c-790fec00029f target=_blank rel=noopener>http://localhost:8080/movies/5dd310b8-8d51-4a1e-a20c-790fec00029f</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>http :8080/movies/5dd310b8-8d51-4a1e-a20c-790fec00029f
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>240</span>
</span></span><span style=display:flex><span>Content-Type: application/json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;A cynical American expatriate struggles to decide whether or not he should help his former lover and her fugitive husband escape French Morocco.&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;5dd310b8-8d51-4a1e-a20c-790fec00029f&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Casablanca&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;year&#34;</span>: <span style=color:#e6db74>&#34;1942&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=search-for-a-not-existing-movie>Search for a not existing Movie<a class=anchor aria-hidden=true href=#search-for-a-not-existing-movie>#</a></h3><p>Now let&rsquo;s also search for <code>http://localhost:8080/movies/?name=Creed</code> is also a great movie but this one is not yet in our <code>MovieService</code> included
we will get the following exception.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>http :8080/movies name<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;Creed&#34;</span> -v
</span></span><span style=display:flex><span>GET /movies?name<span style=color:#f92672>=</span>Creed HTTP/1.1
</span></span><span style=display:flex><span>Accept: */*
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Host: localhost:8080
</span></span><span style=display:flex><span>User-Agent: HTTPie/2.0.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>500</span> Internal Server Error
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>165</span>
</span></span><span style=display:flex><span>Content-Type: application/json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;error&#34;</span>: <span style=color:#e6db74>&#34;Internal Server Error&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;Movie was not found.&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;path&#34;</span>: <span style=color:#e6db74>&#34;/movies&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;requestId&#34;</span>: <span style=color:#e6db74>&#34;61569a89-3&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;status&#34;</span>: 500,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;timestamp&#34;</span>: <span style=color:#e6db74>&#34;2020-04-19T21:13:10.403+00:00&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=configure-circuitbreaker>Configure CircuitBreaker<a class=anchor aria-hidden=true href=#configure-circuitbreaker>#</a></h2><p>😎 Cool stuff 😎 let&rsquo;s implement the <code>CircuitBreaker</code> with <code>Resilinece4j</code>.
Let&rsquo;s configure the <code>ReactiveCircuitBreaker</code> Bean from <code>ReactiveResilience4JCircuitBreakerFactory</code> with a name <code>movie-service</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>bean {
</span></span><span style=display:flex><span>    ReactiveResilience4JCircuitBreakerFactory()
</span></span><span style=display:flex><span>        .create(<span style=color:#e6db74>&#34;movie-service&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=to-be-continued->to be continued ..<a class=anchor aria-hidden=true href=#to-be-continued->#</a></h3><p>The example source code can be found here <a href=https://github.com/marzelwidmer/kboot-resilience4j target=_blank rel=noopener>GitHub</a></p><blockquote><p>💡 <strong>Logger Configuration</strong>:
logging.pattern.console: &ldquo;%clr(%d{yyyy-MM-dd E HH:mm:ss.SSS}){blue} %clr(%-40.40logger{0}){magenta} - %clr(%m){green}%n&rdquo;</p></blockquote><hr><p><em>References:</em></p><blockquote><p><a href=https://resilience4j.readme.io/docs target=_blank rel=noopener>Resilience4j docs</a></p></blockquote></div><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on twitter" href="https://twitter.com/intent/tweet/?text=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f&hashtags=SpringBoot"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f&title=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker&summary=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker&source=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f&title=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on whatsapp" href="https://api.whatsapp.com/send?text=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker%20-%20https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Reactive Spring Boot with Resilience4j CircuitBreaker on telegram" href="https://telegram.me/share/url?text=Reactive%20Spring%20Boot%20with%20Resilience4j%20CircuitBreaker&url=https%3a%2f%2fblog.marcelwidmer.org%2fblog%2f2020%2f2020-04-18-resilience4j-circuitbreaker%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></div><aside><article><h3>See Also</h3><a href=/blog/2020/2020-04-12-cloud-gateway-sidecar/><hgroup><h4><i>Spring Cloud Gateway</i></h4><p><time datetime='2020-04-16 00:00:00 +0000 UTC'>April 16, 2020</time>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2020/2020-04-12-spring-initializr/><hgroup><h4><i>Create Kotlin Project with Spring Initializr and HTTPie</i></h4><p><time datetime='2020-04-12 00:00:00 +0000 UTC'>April 12, 2020</time>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2019/2019-10-22-axon/><hgroup><h4><i>AxonIQ</i></h4><p><time datetime='2019-09-18 00:00:00 +0000 UTC'>September 18, 2019</time>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2019/2019-08-28-multiple-project-promoting/><hgroup><h4><i>Promoting Applications Across Environments</i></h4><p><time datetime='2019-09-18 00:00:00 +0000 UTC'>September 18, 2019</time>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a><a href=/blog/2019/2019-09-18-spring-boot-k8s-configmap/><hgroup><h4><i>Spring Boot Kubernetes ConfigMap</i></h4><p><time datetime='2019-09-18 00:00:00 +0000 UTC'>September 18, 2019</time>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Marcel Widmer</p></hgroup></a></article></aside></div></div></main><footer class=text-center><span>&copy; 2022 <a href=https://blog.marcelwidmer.org>c3smonkey's blog</a></span><div><a href=https://blog.marcelwidmer.org/legal/privacy>Privacy Policy</a>
<span>&</span>
<a href=https://blog.marcelwidmer.org/legal/terms-and-conditions>Terms and Conditions</a></div></footer><article class=hidden id=cookie-banner><div><span></span></div><footer><a role=button id=consent-cookies>Close</a>
<a role=button class=secondary href=/></a></footer></article><script async src=https://blog.marcelwidmer.org/js/cookie.min.js layout=container></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("kbd");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=https://blog.marcelwidmer.org/plugins/js/feather.min.js layout=container></script>
<script src=https://blog.marcelwidmer.org/js/script.min.js layout=container></script></body></html>